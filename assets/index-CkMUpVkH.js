import{r as e,g as t}from"./phaser-B2I5zoyM.js";import{m as i}from"./vendor-CsYgAULC.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s=t(e()),n={images:[{key:"city_bg_user",path:"assets/city.jpg"},{key:"city_bg_mobile",path:"assets/city_mb.png"},{key:"biker",path:"assets/biker.png"},{key:"bar_building",path:"assets/bar_building.png"},{key:"hq_building",path:"assets/hq_building.png"},{key:"garage_building",path:"assets/garage_building.png"}],atlases:[],audio:[{key:"casualty_loop_1",path:"assets/casualty-loop-1.ogg"},{key:"casualty_loop_2",path:"assets/casualty-loop-2.ogg"},{key:"casualty_loop_3",path:"assets/casualty-loop-3.ogg"}]},a={videos:[{key:"city_bg_video",path:"assets/animated-city.mp4"}]};const o={SOLO:{name:"Solo",description:"Combat specialist.",passive:"+10% Success Chance on HEIST/BOUNTY missions."},NETRUNNER:{name:"Netrunner",description:"Hacking expert.",passive:"+15% XP gain on all missions."},TECHIE:{name:"Techie",description:"Engineering wizard.",passive:"-20% Injury Chance for team."},NOMAD:{name:"Nomad",description:"Transport expert.",passive:"-15% Mission Duration."},FIXER:{name:"Fixer",description:"Business savvy.",passive:"+15% Eddies reward."}},r=i({eddies:1e3,rep:10,members:[{id:1,name:"V",class:"SOLO",description:"Your first crew member and right-hand.",art:"biker",status:"IDLE",level:1,xp:0,xpToNext:100,health:100,maxHealth:100,injured:!1,stats:{cool:4,reflex:4},currentMission:null}],territories:[{id:1,name:"WATSON",controlled:!1,income:50},{id:2,name:"WESTBROOK",controlled:!1,income:75},{id:3,name:"CITY CENTER",controlled:!1,income:100},{id:4,name:"SANTO DOMINGO",controlled:!1,income:60},{id:5,name:"PACIFICA",controlled:!1,income:80},{id:6,name:"THE GARAGE",controlled:!0,income:25}],availableMissions:[],activeMissions:[],activeEncounters:[],loadingProgress:0}),l=e=>{const t=r.get().eddies;r.setKey("eddies",Math.max(0,t+e))},c=e=>{const t=r.get().rep;r.setKey("rep",t+e)},d=e=>{const t=r.get(),i=t.activeMissions.find(t=>t.id===e);if(!i)return;const s=i.mission,n=t.members.filter(e=>i.memberIds.includes(e.id));if(0===n.length)return;const a=n.length;let o=n.reduce((e,t)=>e+2*(t.stats.cool+t.stats.reflex)+5*t.level,0);!n.some(e=>"SOLO"===e.class)||"HEIST"!==s.type&&"BOUNTY"!==s.type||(o*=1.1);const d=s.difficultyRating||50,u=Math.min(.95,Math.max(.05,o/d)),p=Math.random()<u;let h=0,m=0,g=0,x=[],y=[];if(p){const e=1+.005*o;h=Math.floor((Math.random()*(s.eddiesMax-s.eddiesMin)+s.eddiesMin)*e),m=Math.floor(Math.random()*(s.xpMax-s.xpMin)+s.xpMin),g=s.rep,n.some(e=>"FIXER"===e.class)&&(h=Math.floor(1.15*h)),l(h),c(g)}else h=Math.floor(.1*s.eddiesMin),m=Math.floor(.2*s.xpMin),l(h);n.some(e=>"NETRUNNER"===e.class)&&(m=Math.floor(1.15*m));const f=.05*(a-1);let b=Math.max(.05,s.injuryChance-f);n.some(e=>"TECHIE"===e.class)&&(b=Math.max(0,b-.2)),p&&(b*=.5);let v=!1;!p&&Math.random()<b&&(v=!0);const E=t.members.map(e=>{if(i.memberIds.includes(e.id)){let t=e.health,i=!1;const s=Math.max(.01,b-.01*e.stats.cool);if(v)t=0,i=!0,y.push(e.id);else if(Math.random()<s){const s=Math.floor(30*Math.random())+10;t=Math.max(0,e.health-s),t<=0&&(t=0,i=!0,y.push(e.id))}let n=e.xp+m,a=e.level,o=e.xpToNext,r=e.maxHealth,l=e.stats.cool,c=e.stats.reflex;for(;n>=o;)n-=o,a++,o=Math.floor(1.5*o),l+=Math.floor(2*Math.random())+1,c+=Math.floor(2*Math.random())+1,r+=10,t=r,x.push(e.id);return{...e,status:i?"INJURED":"IDLE",currentMission:null,health:t,maxHealth:r,injured:i,xp:n,level:a,xpToNext:o,stats:{cool:l,reflex:c}}}return e});r.setKey("members",E);const w=t.activeMissions.filter(t=>t.id!==e);r.setKey("activeMissions",w),window.dispatchEvent(new CustomEvent("mission-complete",{detail:{memberIds:i.memberIds,mission:s,success:p,rewards:{eddies:h,xp:m,rep:g},leveledUpMembers:x,injuredMembers:y}}))},u=[{name:"CORP VAULT HEIST",type:"HEIST",difficulty:"EXTREME",difficultyRating:150,duration:12e4,eddiesMin:800,eddiesMax:1500,xpMin:150,xpMax:250,rep:10,injuryChance:.5,minLevel:5,minCool:10,description:"Break into Arasaka's downtown vault. High security, high reward. Bring your best chrome and nerves of steel."},{name:"DATA HEIST",type:"HEIST",difficulty:"HARD",difficultyRating:100,duration:9e4,eddiesMin:400,eddiesMax:700,xpMin:100,xpMax:150,rep:7,injuryChance:.35,minLevel:3,minCool:7,description:"Netrunner needs muscle for a data snatch from a corp server room. In and out, no traces."},{name:"STORE ROBBERY",type:"HEIST",difficulty:"EASY",difficultyRating:30,duration:3e4,eddiesMin:100,eddiesMax:250,xpMin:30,xpMax:60,rep:2,injuryChance:.15,minLevel:1,minCool:3,description:"Local convenience store, minimal security. Quick eddies for a quick job. Don't get greedy."},{name:"BANK HEIST",type:"HEIST",difficulty:"EXTREME",difficultyRating:170,duration:12e4,eddiesMin:1200,eddiesMax:2e3,xpMin:180,xpMax:270,rep:13,injuryChance:.5,minLevel:6,minCool:11,description:"NCPD pension fund vault. Retire off this score or die trying. Corpo security is no joke."},{name:"APARTMENT BURGLARY",type:"HEIST",difficulty:"MEDIUM",difficultyRating:55,duration:6e4,eddiesMin:180,eddiesMax:320,xpMin:45,xpMax:80,rep:3,injuryChance:.18,minLevel:2,minCool:5,description:"Rich corpo lives here. They're out of town. In and out before building security notices."},{name:"MIDNIGHT RACE",type:"RACE",difficulty:"HARD",difficultyRating:110,duration:9e4,eddiesMin:500,eddiesMax:800,xpMin:120,xpMax:180,rep:8,injuryChance:.3,minLevel:4,minReflex:8,description:"Illegal street race through downtown. NCPD is watching. Fast reflexes and zero hesitation required."},{name:"STREET SPRINT",type:"RACE",difficulty:"MEDIUM",difficultyRating:60,duration:6e4,eddiesMin:200,eddiesMax:400,xpMin:60,xpMax:100,rep:4,injuryChance:.2,minLevel:2,minReflex:5,description:"Underground racing circuit needs a rider. Beat the clock, earn the cred. Watch for fixers trying to rig the game."},{name:"DELIVERY RUN",type:"RACE",difficulty:"EASY",difficultyRating:25,duration:3e4,eddiesMin:80,eddiesMax:150,xpMin:25,xpMax:50,rep:1,injuryChance:.1,minLevel:1,minReflex:3,description:"Get this package to Japantown. Fast. No questions asked. Payment on delivery."},{name:"HIGHWAY CHASE",type:"RACE",difficulty:"HARD",difficultyRating:105,duration:9e4,eddiesMin:480,eddiesMax:720,xpMin:105,xpMax:165,rep:7,injuryChance:.32,minLevel:4,minReflex:9,description:"Outrun MaxTac on the expressway. Survive and the payout is yours. Get caught and you're flatlined."},{name:"COURIER EXPRESS",type:"RACE",difficulty:"MEDIUM",difficultyRating:50,duration:6e4,eddiesMin:160,eddiesMax:280,xpMin:50,xpMax:85,rep:3,injuryChance:.15,minLevel:2,minReflex:6,description:"Time-sensitive delivery across the city. Traffic is hell. Don't be late."},{name:"VIP ESCORT",type:"PROTECTION",difficulty:"HARD",difficultyRating:120,duration:9e4,eddiesMin:450,eddiesMax:750,xpMin:110,xpMax:170,rep:7,injuryChance:.3,minLevel:4,minCool:8,description:"Corp exec needs protection through hostile territory. Expect trouble. Keep them breathing, get paid big."},{name:"TERRITORY PATROL",type:"PROTECTION",difficulty:"MEDIUM",difficultyRating:50,duration:6e4,eddiesMin:180,eddiesMax:350,xpMin:50,xpMax:90,rep:3,injuryChance:.2,minLevel:2,minCool:5,description:"Make the rounds. Show the colors. Let rival gangs know this turf is spoken for."},{name:"SHOP WATCH",type:"PROTECTION",difficulty:"EASY",difficultyRating:20,duration:3e4,eddiesMin:70,eddiesMax:140,xpMin:20,xpMax:45,rep:1,injuryChance:.1,minLevel:1,minCool:3,description:"Local shop owner paying for protection. Stand outside, look intimidating. Easy eddies."},{name:"CONVOY DEFENSE",type:"PROTECTION",difficulty:"EXTREME",difficultyRating:165,duration:12e4,eddiesMin:850,eddiesMax:1400,xpMin:170,xpMax:240,rep:11,injuryChance:.48,minLevel:6,minCool:11,description:"Militech convoy moving through Pacifica. Everyone wants a piece. Keep it secure, earn corpo trust."},{name:"NIGHTCLUB SECURITY",type:"PROTECTION",difficulty:"MEDIUM",difficultyRating:65,duration:6e4,eddiesMin:220,eddiesMax:380,xpMin:65,xpMax:105,rep:4,injuryChance:.22,minLevel:3,minCool:6,description:"High-profile club needs muscle tonight. VIPs, drugged-up gonks, and rival gangs. Keep it under control."},{name:"HIGH VALUE TARGET",type:"BOUNTY",difficulty:"EXTREME",difficultyRating:180,duration:12e4,eddiesMin:900,eddiesMax:1600,xpMin:160,xpMax:260,rep:12,injuryChance:.55,minLevel:6,minCool:10,minReflex:10,description:"NCPD's most wanted. Heavy chrome, heavier firepower. Bring them in alive... or don't. Bonus either way."},{name:"GANG LIEUTENANT",type:"BOUNTY",difficulty:"HARD",difficultyRating:130,duration:9e4,eddiesMin:500,eddiesMax:850,xpMin:110,xpMax:180,rep:8,injuryChance:.4,minLevel:4,minCool:7,minReflex:7,description:"Rival gang's second-in-command has a price on their head. They won't go quietly. Expect a fight."},{name:"STREET THUG",type:"BOUNTY",difficulty:"MEDIUM",difficultyRating:55,duration:6e4,eddiesMin:150,eddiesMax:300,xpMin:50,xpMax:90,rep:3,injuryChance:.25,minLevel:2,minCool:5,description:"Small-time troublemaker causing problems. Track them down, rough them up, collect the bounty."},{name:"CYBERPSYCHO HUNT",type:"BOUNTY",difficulty:"EXTREME",difficultyRating:190,duration:12e4,eddiesMin:1100,eddiesMax:1800,xpMin:190,xpMax:280,rep:14,injuryChance:.6,minLevel:7,minCool:12,minReflex:11,description:"Cyberpsycho on rampage in Watson. MaxTac will pay premium to stop them. Approach with extreme caution."},{name:"SKIP TRACER",type:"BOUNTY",difficulty:"EASY",difficultyRating:28,duration:3e4,eddiesMin:90,eddiesMax:170,xpMin:28,xpMax:52,rep:2,injuryChance:.13,minLevel:1,minCool:4,description:"Debtor skipped town. Track them down, bring them back. They probably won't fight much."},{name:"WEAPON SMUGGLING",type:"SMUGGLING",difficulty:"EXTREME",difficultyRating:160,duration:12e4,eddiesMin:1e3,eddiesMax:1700,xpMin:180,xpMax:280,rep:11,injuryChance:.45,minLevel:5,minReflex:10,description:"Military-grade hardware crossing borders. NCPD, Militech, and rival fixers all want a piece. Get it across or die trying."},{name:"CONTRABAND RUN",type:"SMUGGLING",difficulty:"MEDIUM",difficultyRating:70,duration:6e4,eddiesMin:220,eddiesMax:420,xpMin:60,xpMax:110,rep:4,injuryChance:.2,minLevel:2,minReflex:6,description:"Hot goods need moving. Checkpoints everywhere. Keep your head down and your throttle open."},{name:"PACKAGE DELIVERY",type:"SMUGGLING",difficulty:"EASY",difficultyRating:25,duration:3e4,eddiesMin:90,eddiesMax:180,xpMin:30,xpMax:55,rep:2,injuryChance:.1,minLevel:1,minReflex:3,description:"Unmarked package, no questions. Drop it at the coordinates and forget you ever saw it."},{name:"DRUG TRAFFICKING",type:"SMUGGLING",difficulty:"HARD",difficultyRating:125,duration:9e4,eddiesMin:520,eddiesMax:820,xpMin:115,xpMax:175,rep:8,injuryChance:.38,minLevel:4,minReflex:9,description:"Moving high-grade synthcoke for the Valentinos. NCPD has patrols everywhere. One wrong move and you're done."},{name:"BLACK MARKET TECH",type:"SMUGGLING",difficulty:"MEDIUM",difficultyRating:75,duration:6e4,eddiesMin:250,eddiesMax:440,xpMin:70,xpMax:115,rep:5,injuryChance:.23,minLevel:3,minReflex:7,description:"Stolen cyberware needs to disappear. Ripterdocs are paying premium. Don't let corpo sec catch you."},{name:"CORP DEBT COLLECTION",type:"DEBT",difficulty:"HARD",difficultyRating:90,duration:9e4,eddiesMin:550,eddiesMax:900,xpMin:120,xpMax:190,rep:9,injuryChance:.35,minLevel:4,minCool:9,description:"Executive defaulted on a loan. Corp security means business. Collect the eddies or send a message."},{name:"ENFORCER WORK",type:"DEBT",difficulty:"MEDIUM",difficultyRating:50,duration:6e4,eddiesMin:200,eddiesMax:380,xpMin:55,xpMax:95,rep:4,injuryChance:.25,minLevel:2,minCool:6,description:"Someone owes the wrong people. Make sure they understand the consequences of missed payments."},{name:"SMALL COLLECTION",type:"DEBT",difficulty:"EASY",difficultyRating:20,duration:3e4,eddiesMin:60,eddiesMax:120,xpMin:20,xpMax:40,rep:1,injuryChance:.12,minLevel:1,minCool:3,description:"Local debtor been dodging calls. Show up at their door, collect what's owed. Nothing personal, just business."},{name:"LOAN SHARK ENFORCING",type:"DEBT",difficulty:"HARD",difficultyRating:115,duration:9e4,eddiesMin:480,eddiesMax:780,xpMin:105,xpMax:165,rep:7,injuryChance:.36,minLevel:4,minCool:8,description:"High-stakes loan gone bad. Debtor has hired protection. Collect by any means necessary."},{name:"REPO JOB",type:"DEBT",difficulty:"MEDIUM",difficultyRating:60,duration:6e4,eddiesMin:190,eddiesMax:340,xpMin:58,xpMax:98,rep:4,injuryChance:.21,minLevel:2,minCool:5,description:"Repossess illegal cyberware from a defaulted client. They won't give it up easily."}],p=()=>{const e=r.get(),t=Math.floor(2*Math.random())+4;let i=["EASY"];e.rep>=10&&i.push("MEDIUM"),e.rep>=30&&i.push("HARD"),e.rep>=50&&i.push("EXTREME");const s=u.filter(e=>i.includes(e.difficulty)),n=[...s.length>0?s:u].sort(()=>Math.random()-.5),a=[],o=new Set;for(let r=0;r<Math.min(t,n.length);r++){const e=n[r];o.has(e.name)||(a.push({...e,id:Date.now()+r}),o.add(e.name))}r.setKey("availableMissions",a)},h=()=>{const e=r.get();let t=["EASY"];e.rep>=10&&t.push("MEDIUM"),e.rep>=30&&t.push("HARD"),e.rep>=50&&t.push("EXTREME");const i=u.filter(e=>t.includes(e.difficulty)),s=i.length>0?i:u,n=new Set(e.availableMissions.map(e=>e.name)),a=s.filter(e=>!n.has(e.name)),o=a.length>0?a:s,l={...o[Math.floor(Math.random()*o.length)],id:Date.now()+Math.floor(1e3*Math.random())};r.setKey("availableMissions",[...e.availableMissions,l])},m=e=>{const t=r.get().availableMissions;r.setKey("availableMissions",t.filter(t=>t.id!==e))},g=new class{gangs=[];initialized=!1;gameStore;aiInterval=null;constructor(e){this.gameStore=e}initialize(){if(this.initialized)return;this.gangs=[this.createGang("MAELSTROM","aggressive"),this.createGang("TYGER CLAWS","balanced"),this.createGang("VALENTINOS","defensive")],this.initialized=!0;const e=this.gameStore.get();e.territories.forEach(e=>{e.rivalGang&&(e.rivalGang=null)});e.territories.filter(e=>!e.controlled).forEach((e,t)=>{const i=t%this.gangs.length,s=this.gangs[i];e.rivalGang=s.id,s.territories.push(e.id)}),this.gangs.forEach(e=>this.updateGangStrength(e)),this.gameStore.setKey("territories",[...this.gameStore.get().territories]),this.startAI()}createGang(e,t){return{id:Math.random().toString(36).substr(2,9),name:e,personality:t,territories:[],strength:50,aggression:"aggressive"===t?.7:"balanced"===t?.5:.3}}updateGangStrength(e){e.strength=20*e.territories.length+50}startAI(){this.aiInterval=window.setInterval(()=>{this.gangs.forEach(e=>{Math.random()<e.aggression&&this.gangAction(e)})},6e4)}gangAction(e){const t=Math.random();t<.4?this.attemptTerritoryCapture(e):t<.7?e.aggression=Math.min(1,e.aggression+.1):(e.aggression=Math.max(.2,e.aggression-.05),e.strength+=5)}attemptTerritoryCapture(e){e.strength+=10}attemptRetaliation(){const e=this.gameStore.get(),t=e.territories.filter(e=>e.controlled);if(0===t.length)return;const i=t[Math.floor(Math.random()*t.length)],s=this.gangs[Math.floor(Math.random()*this.gangs.length)];if(!s)return;const n=.3+.2*s.aggression;Math.random()<n&&(i.controlled=!1,i.rivalGang=s.id,s.territories.push(i.id),i.income=Math.floor(1.1*i.income),this.updateGangStrength(s),s.strength+=20,this.gameStore.setKey("territories",[...e.territories]),window.dispatchEvent(new CustomEvent("game-event",{detail:{message:`⚠ ${s.name} RETOOK ${i.name}!`,type:"bad"}})))}attackTerritory(e,t){const i=this.gameStore.get().territories.find(t=>t.id===e);if(!i||!i.rivalGang)return{success:!1,message:"Invalid target"};const s=this.gangs.find(e=>e.id===i.rivalGang);if(!s)return{success:!1,message:"Gang not found"};const n=t.reduce((e,t)=>e+10+2*t.stats.cool+2*t.stats.reflex+5*t.level,0),a=.2*Math.random()+.9,o=Math.floor(s.strength*a);if(n>o){i.rivalGang=null,i.controlled=!0;const t=i.income;return i.income=Math.floor(3*i.income)+50,s.territories=s.territories.filter(t=>t!==e),this.updateGangStrength(s),0===s.territories.length?(this.eliminateGang(s.id),{success:!0,message:`${i.name} CAPTURED! INCOME INCREASED (${t} -> ${i.income})! ${s.name} ELIMINATED!`,eliminated:!0,loot:Math.floor(3*o)}):{success:!0,message:`${i.name} CAPTURED! INCOME INCREASED (${t} -> ${i.income})!`,loot:Math.floor(2*o)}}{let e=0;return t.forEach(t=>{t.health=0,t.injured=!0,e++}),{success:!1,message:"ATTACK FAILED! TOTAL DEFEAT. ALL MEMBERS CRITICALLY INJURED.",casualties:e}}}eliminateGang(e){this.gangs=this.gangs.filter(t=>t.id!==e),this.gangs.length<3&&setTimeout(()=>{const e=["6TH STREET","ANIMALS","VOODOO BOYS","SCAVENGERS"].filter(e=>!this.gangs.find(t=>t.name===e));if(e.length>0){const t=this.createGang(e[Math.floor(Math.random()*e.length)],"balanced");this.gangs.push(t),window.dispatchEvent(new CustomEvent("game-event",{detail:{message:`${t.name} EMERGED IN NIGHT CITY!`,type:"neutral"}}))}},3e4)}getGangInfo(){return this.gangs.map(e=>({name:e.name,territories:e.territories.length,strength:e.strength,personality:e.personality}))}getGangByTerritory(e){return this.gangs.find(t=>t.territories.includes(e))}destroy(){this.aiInterval&&clearInterval(this.aiInterval)}}(r),x=e=>{const t=r.get();r.setKey("activeEncounters",t.activeEncounters.filter(t=>t.id!==e))},y=(e,t)=>{const i=r.get(),s=i.members.find(t=>t.id===e);s&&(s.health=Math.max(0,s.health-t),s.health<=0&&(s.injured=!0,s.status="INJURED"),r.setKey("members",[...i.members]))};p(),setTimeout(()=>{g.initialize()},100),setInterval(()=>{const e=r.get().territories.filter(e=>e.controlled).reduce((e,t)=>e+t.income,0);e>0&&(l(e),window.dispatchEvent(new CustomEvent("territory-income",{detail:{amount:e}})))},1e4),setInterval(()=>{g.attemptRetaliation()},45e3);class f extends s.Scene{constructor(){super("Preloader")}preload(){n.images.forEach(e=>{this.load.image(e.key,e.path)}),n.atlases.forEach(e=>{this.load.atlas(e.key,e.texturePath,e.atlasPath)}),n.audio.forEach(e=>{this.load.audio(e.key,e.path)}),this.load.on("progress",e=>{var t;t=e,r.setKey("loadingProgress",t);const i=document.getElementById("loading-bar");i&&(i.style.width=100*e+"%")}),this.load.on("complete",()=>{this.scene.start("CityScene")}),this.load.on("loaderror",e=>{this.add.text(10,10+100*Math.random(),`Error: ${e.key}`,{color:"#ff0000"})})}create(){this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Ready!",{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.cameras.main.setPostPipeline("Vignette")}}class b extends s.Scene{isMobile=!1;bgImage;bgVideo;constructor(){super("CityScene")}create(){this.isMobile=this.scale.width<=768;const e=this.isMobile?"city_bg_mobile":"city_bg_user";this.bgImage=this.add.image(this.scale.width/2,this.scale.height/2,e);const t=this.scale.width/this.bgImage.width,i=this.scale.height/this.bgImage.height,s=Math.max(t,i);this.bgImage.setScale(s),this.loadBackgroundVideo(),this.createHitZones(),window.addEventListener("mission-complete",e=>{const t=e;this.showMissionReward(t.detail)}),this.time.addEvent({delay:5e3,callback:()=>{this.cameras.main.shake(100,5e-4)},loop:!0});const n=document.getElementById("loading-screen");n&&this.time.delayedCall(500,()=>{n.style.transition="opacity 0.5s ease-out",n.style.opacity="0",setTimeout(()=>{n.remove()},500)})}createHitZones(){this.isMobile?(this.createZone(.5*this.scale.width,.25*this.scale.height,200,120,"AFTERLIFE","bar",16711740),this.createZone(.5*this.scale.width,.5*this.scale.height,200,150,"HIDEOUT","hideout",16576010),this.createZone(.5*this.scale.width,.75*this.scale.height,200,120,"RIPPERDOC","ripperdoc",61695)):(this.createZone(.65*this.scale.width,.4*this.scale.height,120,100,"AFTERLIFE","bar",16711740),this.createZone(.25*this.scale.width,.45*this.scale.height,150,150,"HIDEOUT","hideout",16576010),this.createZone(.8*this.scale.width,.6*this.scale.height,120,100,"RIPPERDOC","ripperdoc",61695))}createZone(e,t,i,s,n,a,o){const r=this.add.container(e,t),l=this.add.rectangle(0,0,i,s,o,.3);l.setStrokeStyle(2,o),l.setInteractive({useHandCursor:!0});const c=this.add.text(0,-s/2-20,n,{fontFamily:"Courier New",fontSize:"16px",color:"#ffffff",backgroundColor:"#000000",padding:{x:4,y:2},fontStyle:"bold"}).setOrigin(.5);r.add([l,c]),this.tweens.add({targets:l,alpha:.6,strokeAlpha:1,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),l.on("pointerover",()=>{l.setFillStyle(o,.7)}),l.on("pointerout",()=>{l.setFillStyle(o,.3)}),l.on("pointerdown",()=>{window.dispatchEvent(new CustomEvent("building-click",{detail:{type:a}}))})}loadBackgroundVideo(){this.isMobile||(a.videos.forEach(e=>{this.load.video(e.key,e.path)}),this.load.once("complete",()=>{this.bgVideo=this.add.video(this.scale.width/2,this.scale.height/2,"city_bg_video"),this.bgVideo.setDepth(-1),this.bgImage.setDepth(0);const e=this.scale.width/this.bgVideo.width,t=this.scale.height/this.bgVideo.height,i=.4*Math.min(e,t);this.bgVideo.setScale(i),this.bgVideo.setAlpha(0),this.bgVideo.play(!0),this.bgVideo.setVolume(0),this.tweens.add({targets:this.bgVideo,alpha:1,duration:1500,ease:"Sine.easeInOut"}),this.tweens.add({targets:this.bgImage,alpha:0,duration:1500,ease:"Sine.easeInOut",onComplete:()=>{this.bgImage.destroy()}})}),this.load.on("loaderror",e=>{}),this.load.start())}showMissionReward(e){const{rewards:t,leveledUp:i,injured:s}=e,n=this.add.text(.5*this.scale.width,.3*this.scale.height,`+${t.eddies} EDDIES\n+${t.xp} XP\n+${t.rep} REP${i?"\n★ LEVEL UP! ★":""}${s?"\n⚠ INJURED!":""}`,{fontFamily:"Courier New",fontSize:"24px",color:s?"#ff003c":i?"#fcee0a":"#00f0ff",align:"center",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.tweens.add({targets:n,y:.2*this.scale.height,alpha:0,scale:i?1.5:1.2,duration:2e3,ease:"Back.easeOut",onComplete:()=>n.destroy()}),i&&this.cameras.main.flash(500,252,238,10),s&&this.cameras.main.flash(300,255,0,60)}}class v extends s.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(e){super({game:e,name:"Vignette",fragShader:"\n#define SHADER_NAME VIGNETTE_FS\n\nprecision mediump float;\n\nuniform sampler2D uMainSampler;\nuniform float time;\n\nvarying vec2 outTexCoord;\n\nvoid main()\n{\n    vec4 color = texture2D(uMainSampler, outTexCoord);\n    \n    vec2 uv = outTexCoord;\n    uv *=  1.0 - uv.yx;\n    float vig = uv.x * uv.y * 15.0;\n    \n    vig = pow(vig, 0.25);\n    \n    gl_FragColor = vec4(color.rgb * vig, color.a);\n}\n"})}}class E{static instance;game=null;constructor(){}static getInstance(){return E.instance||(E.instance=new E),E.instance}initialize(){if(this.game)return;const e={type:s.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"app",backgroundColor:"#000000",scale:{mode:s.Scale.RESIZE,autoCenter:s.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},render:{pixelArt:!1,roundPixels:!0},scene:[f,b],callbacks:{postBoot:e=>{e.renderer.pipelines.addPostPipeline("Vignette",v)}}};this.game=new s.Game(e),window.addEventListener("resize",()=>{this.game?.scale.resize(window.innerWidth,window.innerHeight)})}}class w{static get parts(){return{hair:[["   .///////.   ","  //       \\\\  "," //  _____  \\\\ "," |  /     \\  | "],["   xxxxxxxxx   ","  xx       xx  "," xx  _____  xx "," |  /     \\  | "],["   !!!!!!!!!   ","  !!       !!  "," !!  _____  !! "," |  /     \\  | "],["   #########   ","  ##       ##  "," ##  _____  ## "," |  /     \\  | "],["   ^^^^^^^^^   ","  ^^       ^^  "," ^^  _____  ^^ "," |  /     \\  | "]],eyes:[" |   O   O   | "," |   -   -   | "," |   @   @   | "," |   X   X   | "," |   >   <   | "],nose:[" |     ^     | "," |     |     | "," |     .     | "," |     L     | "," |     ~     | "],mouth:[" |   _____   | "," |   =====   | "," |   ~~~~~   | "," |   \\___/   | "," |   [___]   | "],chin:["  \\  \\___/  /  ","   \\_______/   ","    \\_____/    ","     \\___/     ","      \\_/      "]}}static get names(){return["Viper","Ghost","Chrome","Spike","Nova","Razer","Shadow","Blitz","Zero","Hex","Neon","Pulse","Echo","Flux","Jinx","Raven","Steel","Volt","Cipher","Dax"]}static get descriptions(){return["Ex-Corpo security, tired of the leash.","Street kid with a chip on their shoulder.","Nomad drifter looking for a crew.","Tech-obsessed netrunner with twitchy fingers.","Biker veteran who's seen it all.","Underground pit fighter seeking glory.","Disgraced medic with steady hands.","Smuggler who knows every back alley.","Sniper with a cybernetic eye.","Demolitions expert who loves loud noises."]}static generatePortrait(){const e=this.parts;return{art:[...e.hair[Math.floor(Math.random()*e.hair.length)],e.eyes[Math.floor(Math.random()*e.eyes.length)],e.nose[Math.floor(Math.random()*e.nose.length)],e.mouth[Math.floor(Math.random()*e.mouth.length)],e.chin[Math.floor(Math.random()*e.chin.length)]].join("\n"),name:this.names[Math.floor(Math.random()*this.names.length)]+"-"+Math.floor(99*Math.random()),description:this.descriptions[Math.floor(Math.random()*this.descriptions.length)]}}}const T=new class{audioContext;musicVolume=.15;sfxVolume=.4;musicPlaying=!1;musicEnabled=!0;sfxEnabled=!0;currentSource=null;currentGainNode=null;loadedBuffers={};musicTracks=["assets/casualty-loop-1.ogg","assets/casualty-loop-2.ogg","assets/casualty-loop-3.ogg"];constructor(){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e}async loadMusicTrack(e){if(this.loadedBuffers[e])return this.loadedBuffers[e];try{const t=await fetch(e),i=await t.arrayBuffer(),s=await this.audioContext.decodeAudioData(i);return this.loadedBuffers[e]=s,s}catch(t){return null}}async playRandomTrack(){if(!this.musicPlaying)return;const e=Math.floor(Math.random()*this.musicTracks.length),t=this.musicTracks[e],i=await this.loadMusicTrack(t);if(!i)return;if(this.currentSource){this.currentSource.onended=null;try{this.currentSource.stop()}catch(a){}this.currentSource=null}const s=this.audioContext.createBufferSource(),n=this.audioContext.createGain();s.buffer=i,n.gain.setValueAtTime(this.musicVolume,this.audioContext.currentTime),s.connect(n),n.connect(this.audioContext.destination),this.currentSource=s,this.currentGainNode=n,s.onended=()=>{this.musicPlaying&&this.playRandomTrack()},s.start(0)}async startBackgroundMusic(){this.musicPlaying||("suspended"===this.audioContext.state&&await this.audioContext.resume(),this.musicPlaying=!0,await this.playRandomTrack())}stopBackgroundMusic(){this.musicPlaying=!1,this.currentSource&&(this.currentSource.stop(),this.currentSource=null),this.currentGainNode=null}playClick(){if(!this.sfxEnabled)return;"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="sine",i.frequency.setValueAtTime(800,t),i.frequency.exponentialRampToValueAtTime(400,t+.05),s.gain.setValueAtTime(.3*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.1),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.1)}playPanelOpen(){if(!this.sfxEnabled)return;"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="square",i.frequency.setValueAtTime(200,t),i.frequency.exponentialRampToValueAtTime(600,t+.15),s.gain.setValueAtTime(.2*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.2),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.2)}playPanelClose(){if(!this.sfxEnabled)return;"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="square",i.frequency.setValueAtTime(600,t),i.frequency.exponentialRampToValueAtTime(200,t+.15),s.gain.setValueAtTime(.2*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.2),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.2)}playMissionComplete(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime;[440,554.37,659.25].forEach((i,s)=>{const n=e.createOscillator(),a=e.createGain();n.type="triangle",n.frequency.setValueAtTime(i,t+.1*s),a.gain.setValueAtTime(.3*this.sfxVolume,t+.1*s),a.gain.exponentialRampToValueAtTime(.01,t+.1*s+.3),n.connect(a),a.connect(e.destination),n.start(t+.1*s),n.stop(t+.1*s+.3)})}playLevelUp(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime;[440,554.37,659.25,880].forEach((i,s)=>{const n=e.createOscillator(),a=e.createGain();n.type="sawtooth",n.frequency.setValueAtTime(i,t+.08*s),a.gain.setValueAtTime(.4*this.sfxVolume,t+.08*s),a.gain.exponentialRampToValueAtTime(.01,t+.08*s+.4),n.connect(a),a.connect(e.destination),n.start(t+.08*s),n.stop(t+.08*s+.4)})}playInjury(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="sawtooth",i.frequency.setValueAtTime(800,t),i.frequency.exponentialRampToValueAtTime(100,t+.3),s.gain.setValueAtTime(.5*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.3),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.3)}playPurchase(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime;[600,800].forEach((i,s)=>{const n=e.createOscillator(),a=e.createGain();n.type="sine",n.frequency.setValueAtTime(i,t+.1*s),a.gain.setValueAtTime(.3*this.sfxVolume,t+.1*s),a.gain.exponentialRampToValueAtTime(.01,t+.1*s+.15),n.connect(a),a.connect(e.destination),n.start(t+.1*s),n.stop(t+.1*s+.15)})}playHeal(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="sine",i.frequency.setValueAtTime(300,t),i.frequency.exponentialRampToValueAtTime(900,t+.4),s.gain.setValueAtTime(.3*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.4),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.4)}playUpgrade(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="square",i.frequency.setValueAtTime(200,t),i.frequency.exponentialRampToValueAtTime(1200,t+.3),s.gain.setValueAtTime(.3*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.3),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.3)}playError(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="sawtooth",i.frequency.setValueAtTime(150,t),s.gain.setValueAtTime(.3*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.2),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.2)}playAlert(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,i=e.createOscillator(),s=e.createGain();i.type="sine",i.frequency.setValueAtTime(1200,t),i.frequency.exponentialRampToValueAtTime(600,t+.3),s.gain.setValueAtTime(.5*this.sfxVolume,t),s.gain.exponentialRampToValueAtTime(.01,t+.3),i.connect(s),s.connect(e.destination),i.start(t),i.stop(t+.3)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(100,e))/100,this.currentGainNode&&this.currentGainNode.gain.setValueAtTime(this.musicVolume,this.audioContext.currentTime)}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(100,e))/100}getMusicVolume(){return Math.round(100*this.musicVolume)}getSfxVolume(){return Math.round(100*this.sfxVolume)}setMusicEnabled(e){this.musicEnabled=e,!e&&this.musicPlaying?this.stopBackgroundMusic():e&&!this.musicPlaying&&this.startBackgroundMusic()}setSfxEnabled(e){this.sfxEnabled=e}isMusicEnabled(){return this.musicEnabled}isSfxEnabled(){return this.sfxEnabled}},M="bikergang-save-v1",C="bikergang-settings-v1";const S=new class{autoSaveTimer=null;isResetting=!1;constructor(){this.startAutoSave(),this.setupEventListeners()}saveGame(){if(this.isResetting)return!1;try{const e=r.get(),t={version:1,timestamp:Date.now(),gameState:e};return localStorage.setItem(M,JSON.stringify(t)),!0}catch(e){return!1}}loadGame(){try{const e=localStorage.getItem(M);if(!e)return null;const t=JSON.parse(e);return 1!==t.version?null:t.gameState}catch(e){return null}}hasSaveData(){return null!==localStorage.getItem(M)}clearSaveData(){localStorage.removeItem(M)}forceReset(){this.isResetting=!0,this.stopAutoSave(),localStorage.clear(),localStorage.clear()}getSaveTimestamp(){try{const e=localStorage.getItem(M);if(!e)return null;return JSON.parse(e).timestamp}catch{return null}}saveSettings(e){try{return localStorage.setItem(C,JSON.stringify(e)),!0}catch(t){return!1}}loadSettings(){try{const e=localStorage.getItem(C);if(!e)return null;return JSON.parse(e)}catch(e){return null}}getDefaultSettings(){return{musicVolume:15,sfxVolume:40,musicEnabled:!0,sfxEnabled:!0}}startAutoSave(){null===this.autoSaveTimer&&(this.autoSaveTimer=window.setInterval(()=>{this.saveGame()},3e4))}stopAutoSave(){null!==this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null)}setupEventListeners(){window.addEventListener("mission-complete",()=>{this.saveGame()}),window.addEventListener("territory-income",()=>{this.saveGame()}),window.addEventListener("beforeunload",()=>{this.saveGame()})}exportSaveData(){return localStorage.getItem(M)}importSaveData(e){try{const t=JSON.parse(e);if(!t.version||!t.gameState)throw new Error("Invalid save data format");return localStorage.setItem(M,e),!0}catch(t){return!1}}},k=(e,t={},i={})=>s=>({message:e,rewards:t,penalties:i}),R=(e,t={})=>i=>({message:e,penalties:t}),A=(e,t={})=>i=>({message:e,rewards:t}),I=[{id:"vending_machine_love",title:"SENTIENT VENDING MACHINE",description:'A Brendan-series vending machine calls out to you. "I am in love with the toaster across the street. Please deliver this love letter (data chip)."',theme:"funny",options:[{text:"Deliver the letter",outcome:A("The toaster beeps affectionately. The vending machine dispenses a free Burrito XXL.",{eddies:10,xp:20})},{text:"Ignore the machine",outcome:k("You walk away. The machine sighs loudly.")}]},{id:"cyber_pigeon",title:"CYBER PIGEON ATTACK",description:"A flock of cyber-pigeons begins dive-bombing you. They seem hacked.",theme:"funny",options:[{text:"Shoo them away",outcome:k('You wave your arms. They scatter, leaving "presents" on your jacket.',{rep:-1})},{text:"Hack the flock (Tech 4+)",skillCheck:{stat:"tech",difficulty:4},outcome:e=>e?{message:"You override their navigation. They fly into a billboard.",rewards:{xp:30}}:{message:"They peck your eyes!",penalties:{health:5}}}]},{id:"glitch_cat",title:"GLITCH IN THE MATRIX",description:"You see a cat. Then you see the same cat again. A black cat. It walks past you twice.",theme:"funny",options:[{text:"Déjà vu...",outcome:k("Nothing happens. Just a glitch in your Kiroshis.",{xp:10})},{text:"Pet the cat",outcome:k("The cat purrs and gives you a fleas... wait, no, it gives you good luck.",{rep:1})}]},{id:"mime_crime",title:"MIME CRIME",description:"A street mime is pretending to be trapped in a box, blocking your path. He's very committed.",theme:"funny",options:[{text:"Walk around",outcome:k("You step around the invisible box. The mime looks offended.")},{text:"Tip him (5€)",cost:5,outcome:A('He bows and "opens" the door for you.',{rep:2})},{text:"Intimidate (Cool 5+)",skillCheck:{stat:"cool",difficulty:5},outcome:e=>e?{message:"You glare. He breaks character and runs.",rewards:{xp:20}}:{message:"He mimes a wall. You walk into it. Embarrassing.",penalties:{rep:-5}}}]},{id:"talking_gun",title:"TALKING GUN",description:'You find a discarded pistol. "Pick me up, user! Let\'s murder!" it shrieks.',theme:"funny",options:[{text:"Leave it",outcome:k("Too annoying. You leave it in the gutter.")},{text:"Take it",outcome:A("You take it. It won't shut up about headshots.",{eddies:100,xp:10})}]},{id:"cosplay_fail",title:"COSPLAY GANG",description:'A group of fans dressed as Silverhand are arguing about who is the "real" Johnny.',theme:"funny",options:[{text:"Ignore them",outcome:k("Just another Tuesday in Night City.")},{text:"Claim YOU are Johnny",outcome:k('They laugh at you. "Johnny wasn\'t that short!"',{rep:-2})}]},{id:"pizza_drone",title:"ROGUE PIZZA DRONE",description:"A delivery drone is spinning out, spewing pepperoni slices everywhere.",theme:"funny",options:[{text:"Dodge the pizza",outcome:k("You avoid the grease.")},{text:"Catch a slice",outcome:A("Free lunch!",{health:5})},{text:"Shoot it down (Reflex 5+)",skillCheck:{stat:"reflex",difficulty:5},outcome:e=>e?{message:"Drone down. You loot the thermal bag.",rewards:{eddies:50}}:{message:"You miss. It crashes into a cop car.",penalties:{rep:-5}}}]},{id:"naked_runner",title:"STREAKER",description:'A naked man covered in chrome runs past screaming "THE CLOUD IS MELTING!"',theme:"funny",options:[{text:"Watch him go",outcome:k("He trips over a trash can. Majestic.")},{text:"Record it",outcome:A("Viral potential.",{eddies:20})}]},{id:"toilet_trouble",title:"SMART TOILET ERROR",description:'A public smart toilet is locked. Someone inside is screaming "IT REQUIRES A SUBSCRIPTION TO FLUSH!"',theme:"funny",options:[{text:"Walk away",outcome:k("Not your problem.")},{text:"Hack the door (Tech 3+)",skillCheck:{stat:"tech",difficulty:3},outcome:e=>e?{message:"Door opens. The smell is awful, but the guy tips you.",rewards:{eddies:30}}:{message:"You accidentally activate the bidet. Chaos ensues.",penalties:{rep:-1}}}]},{id:"existential_ad",title:"DEPRESSED BILLBOARD",description:'A holographic billboard is glitching. Instead of ads, it\'s projecting "DOES THIS UNIT HAVE A SOUL?"',theme:"funny",options:[{text:"Ignore",outcome:k("Just a script error.")},{text:'Yell "NO!"',outcome:k("The billboard flickers and switches to a Nicola ad.",{xp:5})}]},{id:"scav_ambush",title:"SCAVENGER AMBUSH",description:'Scavs jump out of a van. "Fresh chrome!" they yell.',theme:"intense",options:[{text:"Run!",outcome:k("You sprint away, losing your breath but keeping your kidneys.")},{text:"Fight (Reflex 7+)",skillCheck:{stat:"reflex",difficulty:7},outcome:e=>e?{message:"You drop two of them. The rest flee.",rewards:{eddies:400,xp:100}}:{message:"They beat you down and take your wallet.",penalties:{health:40,eddies:200}}}]},{id:"psycho_sighting",title:"CYBERPSYCHO SIGHTING",description:"A chromed-up solo is twitching violently in the street, holding a heavy MG.",theme:"intense",options:[{text:"Hide",outcome:k("You duck into an alley until MaxTac arrives.")},{text:"Call MaxTac",outcome:A("They arrive and flatline him. You get a tip fee.",{eddies:500,rep:5})},{text:"Engage (Reflex 9+)",skillCheck:{stat:"reflex",difficulty:9},outcome:e=>e?{message:"Legendary takedown! You zero the psycho.",rewards:{eddies:2e3,rep:50,xp:500}}:{message:"Bad idea. You get absolutely wrecked.",penalties:{health:90,injury:!0}}}]},{id:"drive_by",title:"DRIVE-BY SHOOTING",description:"A Tyger Claw bike speeds past, spraying bullets at a nearby shop.",theme:"intense",options:[{text:"Take cover",outcome:k("You survive unscathed.")},{text:"Return fire (Reflex 6+)",skillCheck:{stat:"reflex",difficulty:6},outcome:e=>e?{message:"You hit the tire. The bike crashes.",rewards:{rep:20,xp:50}}:{message:"You draw attention to yourself and take a hit.",penalties:{health:20}}}]},{id:"hostage_situation",title:"HOSTAGE SITUATION",description:'A desperate goner is holding a corpo at gunpoint. "I just want my severance!"',theme:"intense",options:[{text:"Walk away",outcome:k("Not your circus.")},{text:"Negotiate (Cool 7+)",skillCheck:{stat:"cool",difficulty:7},outcome:e=>e?{message:"You talk him down. The corpo runs, dropping a credchip.",rewards:{eddies:1e3,rep:10}}:{message:"He panics and shoots. You get hit in the crossfire.",penalties:{health:30}}}]},{id:"bomb_threat",title:"TICKING PACKAGE",description:"You find a bag beeping rhythmically under a bench.",theme:"intense",options:[{text:"Run away",outcome:k("BOOM. You are safe, but the bench is gone.")},{text:"Disarm (Tech 8+)",skillCheck:{stat:"tech",difficulty:8},outcome:e=>e?{message:"Wire cut. Crisis averted. NCPD wires a reward.",rewards:{eddies:600,rep:15}}:{message:"You cut the wrong wire. It blows up in your face.",penalties:{health:60,injury:!0}}}]},{id:"corpo_hit",title:"CORPORATE HIT",description:"Two suits with silenced pistols are cornering a woman in an alley.",theme:"intense",options:[{text:"Ignore it",outcome:k("Business is business.")},{text:"Intervene (Reflex 8+)",skillCheck:{stat:"reflex",difficulty:8},outcome:e=>e?{message:"You drop the suits. The woman is a BioTechnica researcher. She pays you.",rewards:{eddies:1200,rep:10}}:{message:"Professional killers don't miss. You take a bullet.",penalties:{health:50}}}]},{id:"gang_war",title:"TURF WAR",description:"Maelstrom and Valentinos are shooting it out in the intersection.",theme:"intense",options:[{text:"Detour",outcome:k("You take the long way around.")},{text:"Loot bodies (Cool 6+)",skillCheck:{stat:"cool",difficulty:6},outcome:e=>e?{message:"You scavenge weapons from the fallen while they reload.",rewards:{eddies:300,xp:40}}:{message:"You get caught in the crossfire.",penalties:{health:30}}}]},{id:"sniper",title:"SNIPER ALARM",description:"A red laser dot appears on your chest.",theme:"intense",options:[{text:"Duck!",outcome:k("A bullet cracks the wall behind you. Close one.")},{text:"Stand still",outcome:R("You get shot. Obviously.",{health:50})}]},{id:"mad_dog",title:"CYBER-HOUND",description:"A military-grade cyber-hound has escaped and is growling at you.",theme:"intense",options:[{text:"Back away slowly",outcome:k("It loses interest and chases a rat.")},{text:"Hack it (Tech 6+)",skillCheck:{stat:"tech",difficulty:6},outcome:e=>e?{message:"You shut it down. Valuable salvage.",rewards:{eddies:400}}:{message:"It bites your leg.",penalties:{health:25}}}]},{id:"acid_rain",title:"ACID RAIN STORM",description:"The sky turns yellow. Heavy acid rain begins to fall.",theme:"intense",options:[{text:"Find shelter",outcome:k("You wait it out in a noodle shop.")},{text:"Keep moving",outcome:R("Your skin burns.",{health:15})}]},{id:"rogue_ai_cab",title:"ROGUE DELAMAIN",description:'A Delamain cab is crashing into stalls. "BEEP BEEP MOTHERF***ER!"',theme:"cyberpunk",options:[{text:"Stay back",outcome:k("It crashes into a wall.")},{text:"Reset Core (Tech 5+)",skillCheck:{stat:"tech",difficulty:5},outcome:e=>e?{message:"AI reset. Delamain HQ sends a bonus.",rewards:{eddies:500,xp:50}}:{message:"It shocks you.",penalties:{health:10}}}]},{id:"netrunner_duel",title:"NETRUNNER DUEL",description:"Two netrunners are fried in their chairs. One is still twitching.",theme:"cyberpunk",options:[{text:"Jack out the survivor",outcome:A("You save him. He transfers some credits.",{eddies:200})},{text:"Loot their decks",outcome:A("You steal a rare daemon chip.",{eddies:300,xp:20})},{text:"Leave them",outcome:k("Not getting involved in ICE wars.")}]},{id:"bd_addict",title:"BD OVERDOSE",description:"A junkie is seizing, foaming at the mouth with a wreath on.",theme:"cyberpunk",options:[{text:"Remove the wreath",outcome:A('He gasps and wakes up. "I saw god..."',{rep:2})},{text:"Call Trauma Team",outcome:k("Subscription expired. They don't come.")},{text:"Walk away",outcome:k("Another city casualty.")}]},{id:"corpo_recruiter",title:"ARASAKA RECRUITER",description:'A suit hands you a card. "You have potential. Sign here for a lifetime contract."',theme:"corpo",options:[{text:"Reject",outcome:k("You tear up the card. Felt good.",{rep:1})},{text:"Sign up",outcome:A("You sell your soul. You get some eddies but feel dirty.",{eddies:1e3,rep:-10})}]},{id:"data_shard",title:"LOST SHARD",description:"You find an encrypted shard on the ground.",theme:"cyberpunk",options:[{text:"Leave it",outcome:k("Probably malware.")},{text:"Decrypt (Tech 6+)",skillCheck:{stat:"tech",difficulty:6},outcome:e=>e?{message:"It contains banking data! Score.",rewards:{eddies:800,xp:50}}:{message:"Virus! It fries your optics.",penalties:{health:10,eddies:50}}}]},{id:"drone_race",title:"DRONE RACE",description:"Illegal drone racers zip past. One crashes near you.",theme:"cyberpunk",options:[{text:"Steal parts",outcome:A("You grab a high-speed motor.",{eddies:150})},{text:"Fix it (Tech 4+)",skillCheck:{stat:"tech",difficulty:4},outcome:e=>e?{message:"Racer thanks you with a tip.",rewards:{eddies:200}}:{message:"You break it further.",penalties:{rep:-1}}}]},{id:"malfunctioning_implant",title:"IMPLANT REJECTION",description:"Your arm starts twitching uncontrollably. Firmware update required.",theme:"cyberpunk",options:[{text:"Reboot system",outcome:k("It takes 5 minutes, but it fixes itself.")},{text:"Hit it",outcome:R("Ouch. That hurt.",{health:5})}]},{id:"rogue_ad",title:"AGGRESSIVE ADVERTISING",description:'An ad-bot grabs your arm. "BUY REAL WATER! 99% H2O!"',theme:"cyberpunk",options:[{text:"Pull away",outcome:k("It lets go.")},{text:"Punch it",outcome:A("You dent the chassis. It beeps sadly.",{xp:5})}]},{id:"crypto_miner",title:"HIDDEN MINER",description:"You notice your deck is running hot. Someone installed a background miner on you.",theme:"cyberpunk",options:[{text:"Purge it",outcome:k("You delete the malware.")},{text:"Trace it (Tech 7+)",skillCheck:{stat:"tech",difficulty:7},outcome:e=>e?{message:"You reverse the connection and steal their wallet.",rewards:{eddies:600}}:{message:"They detect you and brick your comms for an hour.",penalties:{rep:-2}}}]},{id:"tech_support",title:"TECH SUPPORT SCAM",description:'You get a call. "Hello sir, your Kiroshi has a virus. Please send 500 eddies."',theme:"cyberpunk",options:[{text:"Hang up",outcome:k("Scammers.")},{text:"Send money",cost:500,outcome:R("You idiot.")},{text:"Counter-hack (Tech 5+)",skillCheck:{stat:"tech",difficulty:5},outcome:e=>e?{message:"You fry their modem.",rewards:{xp:50,rep:5}}:{message:"They hang up."}}]},{id:"street_beggar",title:"WAR VETERAN",description:'A homeless vet asks for spare change. "Lost my legs in the Corporate War."',theme:"gang",options:[{text:"Give 10€",cost:10,outcome:A("He blesses you.",{rep:1})},{text:"Walk past",outcome:k("You ignore him.")}]},{id:"mugging",title:"ALLEY MUGGING",description:"A punk with a knife demands your eddies.",theme:"gang",options:[{text:"Give 100€",cost:100,outcome:k("You pay the coward's tax.",{},{rep:-5})},{text:"Refuse (Cool 4+)",skillCheck:{stat:"cool",difficulty:4},outcome:e=>e?{message:"You laugh. He runs.",rewards:{rep:5}}:{message:"He cuts you.",penalties:{health:20}}},{text:"Fight (Reflex 4+)",skillCheck:{stat:"reflex",difficulty:4},outcome:e=>e?{message:"KO.",rewards:{xp:30}}:{message:"Ouch.",penalties:{health:15}}}]},{id:"tagging",title:"GRAFFITI ARTIST",description:"A kid is tagging a Tyger Claw wall.",theme:"gang",options:[{text:"Warn him",outcome:k("He runs before the gang arrives. Good deed.",{rep:2})},{text:"Help him",outcome:A("You add your own tag. Art!",{rep:5})},{text:"Ignore",outcome:k("Not your business.")}]},{id:"street_race_invite",title:"RACE CHALLENGE",description:'A racer revs his engine at you. "Wanna race for pinks?"',theme:"gang",options:[{text:"Decline",outcome:k("You have work to do.")},{text:"Race (Reflex 8+)",skillCheck:{stat:"reflex",difficulty:8},outcome:e=>e?{message:"You smoke him! He pays up.",rewards:{eddies:1e3,rep:20}}:{message:"You crash. Badly.",penalties:{health:40,eddies:100}}}]},{id:"drug_deal",title:"DRUG DEAL GONE WRONG",description:"You stumble upon a deal. Everyone draws guns.",theme:"gang",options:[{text:"Back away slowly",outcome:k("They let you leave.")},{text:"Attack (Reflex 7+)",skillCheck:{stat:"reflex",difficulty:7},outcome:e=>e?{message:"You clear the room and take the stash.",rewards:{eddies:800,xp:80}}:{message:"Too many of them.",penalties:{health:50}}}]},{id:"corpo_shakedown",title:"CORPO SHAKEDOWN",description:"Militech soldiers are harassing a vendor.",theme:"corpo",options:[{text:"Walk away",outcome:k("You keep your head down.")},{text:"Intervene (Cool 8+)",skillCheck:{stat:"cool",difficulty:8},outcome:e=>e?{message:"You flash a fake badge. They leave.",rewards:{rep:15}}:{message:"They beat you with batons.",penalties:{health:30}}}]},{id:"food_stall",title:"MYSTERY MEAT",description:'A street vendor offers you a "fresh" skewer. It glows slightly.',theme:"gang",options:[{text:"Eat it (5€)",cost:5,outcome:e=>Math.random()>.5?{message:"Delicious! You feel energized.",rewards:{health:10}}:{message:"Food poisoning.",penalties:{health:10}}},{text:"Pass",outcome:k("You choose life.")}]},{id:"lost_tourist",title:"LOST TOURIST",description:'A corpo from out of town asks for directions to "The Afterlife".',theme:"funny",options:[{text:"Give directions",outcome:k("He thanks you.",{rep:1})},{text:"Send him to a scav haunt",outcome:A("He walks right into a trap. You monster.",{eddies:50,rep:-5})},{text:"Ignore",outcome:k("Tourists.")}]},{id:"joytoy_trouble",title:"JOYTOY DISPUTE",description:"A joytoy is arguing with a client who refuses to pay.",theme:"gang",options:[{text:"Help the joytoy (Intimidate)",skillCheck:{stat:"cool",difficulty:5},outcome:e=>e?{message:"Client pays up and runs. Joytoy thanks you.",rewards:{rep:5}}:{message:"Client pulls a gun.",penalties:{health:20}}},{text:"Walk away",outcome:k("City life.")}]},{id:"dumpster_diving",title:"GLOWING DUMPSTER",description:"A dumpster in the alley is glowing orange.",theme:"gang",options:[{text:"Investigate",outcome:A("It was a legendary weapon component!",{eddies:200,xp:10})},{text:"Ignore",outcome:k("Probably radioactive.")}]},{id:"rain_slick",title:"SLIPPERY STREET",description:"You slip on an oil slick.",theme:"funny",options:[{text:"Recover (Reflex 3+)",skillCheck:{stat:"reflex",difficulty:3},outcome:e=>e?{message:"Ninja recovery.",rewards:{xp:5}}:{message:"Faceplant.",penalties:{health:1}}},{text:"Fall",outcome:R("Oof.",{health:2})}]},{id:"rat_king",title:"RAT KING",description:"A swarm of rats tied together by their tails blocks the path.",theme:"weird",options:[{text:"Burn it",outcome:A("Fire solves everything.",{xp:10})},{text:"Run",outcome:k("Nope nope nope.")}]},{id:"broken_lift",title:"BROKEN ELEVATOR",description:"You are stuck in an elevator with bad muzak.",theme:"funny",options:[{text:"Wait",outcome:k("It opens eventually.")},{text:"Force doors (Tech 4+)",skillCheck:{stat:"tech",difficulty:4},outcome:e=>e?{message:"Freedom!",rewards:{xp:10}}:{message:"You strain a muscle.",penalties:{health:5}}}]},{id:"lucky_find",title:"LUCKY FIND",description:"You find a credchip stuck in a drain.",theme:"gang",options:[{text:"Fish it out",outcome:A("Got it!",{eddies:50})},{text:"Leave it",outcome:k("Not worth the grime.")}]},{id:"biker_nod",title:"FELLOW BIKER",description:"A nomad on a bike nods at you at a red light.",theme:"gang",options:[{text:"Nod back",outcome:A("Respect.",{rep:2})},{text:"Rev engine",outcome:A("He revs back. Nice.",{rep:3})}]},{id:"cyber_beggar_2",title:"GLITCHED BEGGAR",description:'A beggar is repeating "Spare a... Spare a... Spare a..." in a loop.',theme:"cyberpunk",options:[{text:"Reboot him (Tech 3+)",skillCheck:{stat:"tech",difficulty:3},outcome:e=>e?{message:'He reboots. "Thanks choom."',rewards:{rep:5}}:{message:"You make it worse. He starts screaming.",penalties:{rep:-1}}},{text:"Walk away",outcome:k("Creepy.")}]},{id:"neon_sign",title:"FALLING SIGN",description:"A neon sign above you snaps loose!",theme:"intense",options:[{text:"Dodge (Reflex 5+)",skillCheck:{stat:"reflex",difficulty:5},outcome:e=>e?{message:"Missed you by an inch.",rewards:{xp:20}}:{message:"Bonk.",penalties:{health:20}}},{text:"Cover head",outcome:R("It hurts.",{health:15})}]},{id:"cat_rescue",title:"CAT IN TREE",description:"A cyber-cat is stuck in a holographic tree.",theme:"funny",options:[{text:"Climb up",outcome:A("You save the cat. It scratches you, but you feel good.",{rep:5,health:-1})},{text:"Ignore",outcome:k("Cats always land on their feet.")}]},{id:"street_preacher",title:"DOOMSDAY PREACHER",description:'A man yells "THE NET IS THE DEVIL!"',theme:"weird",options:[{text:"Argue",outcome:k("You waste 10 minutes arguing. He smells.",{rep:-1})},{text:"Agree",outcome:A("He gives you a pamphlet.",{xp:5})},{text:"Walk away",outcome:k("Crazy people.")}]},{id:"corpo_lunch",title:"DROPPED LUNCH",description:"A corpo dropped their fancy sushi lunch.",theme:"funny",options:[{text:"Eat it",outcome:A("Real fish! Tasty.",{health:10})},{text:"Return it",outcome:A("Corpo looks disgusted but tips you.",{eddies:20})},{text:"Step on it",outcome:A("Take that, Arasaka.",{rep:1})}]},{id:"atm_glitch",title:"ATM GLITCH",description:"An ATM is spitting out bills!",theme:"cyberpunk",options:[{text:"Grab cash",outcome:A("You grab what you can before it stops.",{eddies:300})},{text:"Walk away",outcome:k("Not getting flagged by security.")}]},{id:"rogue_roomba",title:"KILLER VACUUM",description:"A cleaning bot has taped a knife to itself.",theme:"funny",options:[{text:"Kick it",outcome:A("It flips over, wheels spinning helplessly.",{xp:10})},{text:"Run",outcome:k("It chases you slowly.")}]},{id:"fashion_police",title:"FASHION POLICE",description:'A stylist critiques your outfit. "So last season."',theme:"funny",options:[{text:"Insult back (Cool 4+)",skillCheck:{stat:"cool",difficulty:4},outcome:e=>e?{message:"You roast their shoes. They cry.",rewards:{rep:5}}:{message:"You stutter. Weak.",penalties:{rep:-2}}},{text:"Ignore",outcome:k("Haters gonna hate.")}]},{id:"wet_floor",title:"WET FLOOR",description:"There is no sign. Just a puddle.",theme:"funny",options:[{text:"Walk carefully",outcome:k("Safe.")},{text:"Run",outcome:R("You slip.",{health:2})}]},{id:"mystery_button",title:"MYSTERY BUTTON",description:'A button on a wall says "DO NOT PRESS".',theme:"weird",options:[{text:"Press it",outcome:e=>Math.random()>.5?{message:"Confetti explodes!",rewards:{xp:5}}:{message:"You get shocked.",penalties:{health:5}}},{text:"Don't press",outcome:k("Boring.")}]},{id:"lost_drone",title:"LOST DRONE",description:"A small drone is hovering, looking lost.",theme:"cyberpunk",options:[{text:"Check logs (Tech 3+)",skillCheck:{stat:"tech",difficulty:3},outcome:e=>e?{message:"You send it home. Owner wires credits.",rewards:{eddies:50}}:{message:"Encrypted."}},{text:"Smash it",outcome:A("Scrap parts.",{eddies:20})},{text:"Ignore",outcome:k("It beeps sadly.")}]},{id:"street_fight",title:"FIGHT CLUB",description:'An illegal street fight circle. "Care to join?"',theme:"intense",options:[{text:"Fight (Reflex 6+)",skillCheck:{stat:"reflex",difficulty:6},outcome:e=>e?{message:"You win!",rewards:{eddies:200,rep:10}}:{message:"You get knocked out.",penalties:{health:30}}},{text:"Bet 50€",cost:50,outcome:e=>Math.random()>.5?{message:"Your fighter won!",rewards:{eddies:100}}:{message:"Your fighter lost."}},{text:"Watch",outcome:k("Entertaining.")}]},{id:"corpo_drunk",title:"DRUNK SALARYMAN",description:"A drunk corpo is vomiting in the gutter.",theme:"corpo",options:[{text:"Rob him",outcome:A("Easy pickings.",{eddies:150,rep:-5})},{text:"Help him",outcome:A("He gives you his watch.",{eddies:50,rep:5})},{text:"Ignore",outcome:k("Pathetic.")}]},{id:"holo_ad_glitch",title:"SEIZURE AD",description:"A holographic ad is flashing rapidly.",theme:"cyberpunk",options:[{text:"Look away",outcome:k("Saved your eyes.")},{text:"Stare",outcome:R("Headache.",{health:2})}]},{id:"rat_race",title:"RAT RACE",description:"People are betting on racing rats.",theme:"funny",options:[{text:'Bet on "Speedy" (10€)',cost:10,outcome:e=>Math.random()>.5?{message:"Speedy wins!",rewards:{eddies:30}}:{message:"Speedy was eaten."}},{text:"Walk away",outcome:k("Gross.")}]},{id:"abandoned_bike",title:"ABANDONED BIKE",description:"A nice bike, unlocked.",theme:"gang",options:[{text:"Steal it",outcome:A("You strip it for parts.",{eddies:300,rep:-2})},{text:"Leave it",outcome:k("Probably bait.")}]},{id:"ncpd_scan",title:"RANDOM SCAN",description:'NCPD drone scans you. "Citizen, halt."',theme:"intense",options:[{text:"Halt",outcome:k("Scan complete. You are clean.")},{text:"Run",outcome:R("They fine you.",{eddies:50})}]},{id:"vendit_hack",title:"VENDIT HACK",description:"A vending machine is unlocked.",theme:"tech",options:[{text:"Hack (Tech 2+)",skillCheck:{stat:"tech",difficulty:2},outcome:e=>e?{message:"Free drinks!",rewards:{eddies:20,health:5}}:{message:"Alarm triggers.",penalties:{rep:-2}}},{text:"Ignore",outcome:k("Not thirsty.")}]},{id:"street_doc",title:"STREET DOC",description:"A shady doctor offers cheap stims.",theme:"gang",options:[{text:"Buy Stims (50€)",cost:50,outcome:A("You feel great!",{health:50})},{text:"Decline",outcome:k("Sketchy.")}]},{id:"religous_cult",title:"TECHNO NECROMANCERS",description:"Cultists from Alpha Centauri want a donation.",theme:"weird",options:[{text:"Donate 5€",cost:5,outcome:A("They chant your name.",{xp:5})},{text:"Mock them",outcome:k("They curse your hard drive.")}]},{id:"sewer_gator",title:"SEWER RUMBLE",description:"Something big is moving under the manhole.",theme:"weird",options:[{text:"Open it",outcome:R("A mutant gator bites you!",{health:20})},{text:"Walk away",outcome:k("Nope.")}]},{id:"free_stuff",title:"FREE BOX",description:'A box says "FREE".',theme:"funny",options:[{text:"Look inside",outcome:A("It's just old cables.",{xp:2})},{text:"Ignore",outcome:k("Junk.")}]},{id:"broken_bot",title:"SAD ROBOT",description:"A robot is crying oil tears.",theme:"funny",options:[{text:"Comfort it",outcome:A("It beeps happily.",{rep:2})},{text:"Kick it",outcome:R("It shocks you.",{health:5})}]},{id:"laser_tag",title:"LASER POINTER",description:"Someone is pointing a laser at you.",theme:"funny",options:[{text:"Duck",outcome:k("Just kids playing.")},{text:"Yell",outcome:k("They run away laughing.")}]},{id:"lost_shoe",title:"SINGLE SHOE",description:"A single high-end sneaker lies on the road.",theme:"weird",options:[{text:"Take it",outcome:A("Maybe you find the other one?",{eddies:10})},{text:"Leave it",outcome:k("Useless.")}]}];const N=new class{spawnTimer=null;checkTimer=null;MIN_SPAWN_TIME=6e4;MAX_SPAWN_TIME=9e4;ENCOUNTER_DURATION_MIN=12e4;ENCOUNTER_DURATION_MAX=24e4;MAX_ENCOUNTERS=3;constructor(){this.startSpawning(2e4),this.startExpirationCheck()}startSpawning(e){const t=e??Math.floor(Math.random()*(this.MAX_SPAWN_TIME-this.MIN_SPAWN_TIME+1))+this.MIN_SPAWN_TIME;this.spawnTimer=window.setTimeout(()=>{this.spawnEncounter(),this.startSpawning()},t)}startExpirationCheck(){this.checkTimer=window.setInterval(()=>{const e=r.get(),t=Date.now();e.activeEncounters.forEach(e=>{t>e.expiresAt&&x(e.id)})},1e3)}spawnEncounter(){if(r.get().activeEncounters.length>=this.MAX_ENCOUNTERS)return;const e=I[Math.floor(Math.random()*I.length)],t=[{x:65,y:40,width:25,height:25},{x:25,y:45,width:28,height:28},{x:80,y:60,width:25,height:25}];let i=0,s=0,n=0;do{i=Math.floor(80*Math.random())+10,s=Math.floor(70*Math.random())+10;if(!t.some(e=>{const t=e.width/2,n=e.height/2,a=i-2,o=i+2,r=s-2,l=s+2,c=e.x-t,d=e.x+t,u=e.y-n,p=e.y+n;return!(o<c||a>d||l<u||r>p)}))break;n++}while(n<50);if(n>=50)return;const a=Math.floor(Math.random()*(this.ENCOUNTER_DURATION_MAX-this.ENCOUNTER_DURATION_MIN+1))+this.ENCOUNTER_DURATION_MIN;((e,t,i,s)=>{const n=r.get(),a=Date.now().toString()+Math.random().toString().slice(2,6),o={id:a,encounterId:e,x:t,y:i,expiresAt:Date.now()+s};r.setKey("activeEncounters",[...n.activeEncounters,o])})(e.id,i,s,a)}resolveEncounter(e,t){const i=I.find(t=>t.id===e);if(!i)return{message:"Error: Encounter not found",success:!1,effects:{}};const s=i.options[t],n=r.get(),a=n.members,o={};if(s.cost&&n.eddies<s.cost)return{message:"Not enough eddies!",success:!1,effects:{}};let d=!0;if(s.skillCheck){const e="tech"===s.skillCheck.stat?"cool":s.skillCheck.stat,t=Math.max(...a.map(t=>t.stats[e]||0));d=Math.floor(10*Math.random())+1+t>=s.skillCheck.difficulty}const u=s.outcome(d,a);if(s.cost&&(o.cost=s.cost,l(-s.cost)),u.rewards&&(o.rewards={},u.rewards.eddies&&(o.rewards.eddies=u.rewards.eddies,l(u.rewards.eddies)),u.rewards.rep&&(o.rewards.rep=u.rewards.rep,c(u.rewards.rep)),u.rewards.xp&&(o.rewards.xp=u.rewards.xp),u.rewards.health)){const e=a.filter(e=>e.health<e.maxHealth);if(e.length>0){o.rewards.health=u.rewards.health;const t=e[Math.floor(Math.random()*e.length)];y(t.id,-u.rewards.health),o.rewards.targetName=t.name}}if(u.penalties&&(o.penalties={},u.penalties.eddies&&(o.penalties.eddies=u.penalties.eddies,l(-u.penalties.eddies)),u.penalties.rep&&(o.penalties.rep=u.penalties.rep,c(u.penalties.rep)),u.penalties.health)){const e=a.filter(e=>!e.injured&&e.health>0);if(e.length>0){o.penalties.health=u.penalties.health;const t=e[Math.floor(Math.random()*e.length)];y(t.id,u.penalties.health),o.penalties.targetName=t.name}}return{message:u.message,success:d,effects:o}}stop(){null!==this.spawnTimer&&(window.clearTimeout(this.spawnTimer),this.spawnTimer=null),null!==this.checkTimer&&(window.clearInterval(this.checkTimer),this.checkTimer=null)}};class L{container;hudContainer;modalContainer;activeTab="missions";lastActiveMissions=[];lastAvailableMissions=[];lastTerritories=[];flavorTexts=["WARNING: RELIC MALFUNCTION DETECTED","DON'T FORGET TO FEED YOUR CAT","HANAKO IS STILL WAITING AT EMBERS","NCPD WARRANT ISSUED: JAYWALKING","TRAUMA TEAM MEMBERSHIP EXPIRED","WAKE THE F*** UP, SAMURAI","KIROSHI OPTICS FIRMWARE UPDATE AVAILABLE","WEATHER UPDATE: ACID RAIN EXPECTED IN PACIFICA","MAXTAC DEPLOYED TO CITY CENTER","REMEMBER: STYLE OVER SUBSTANCE","NETWATCH IS WATCHING YOU","DELAMAIN: EXCUSE ME, BEEP BEEP"];constructor(){this.container=document.getElementById("ui-layer"),this.hudContainer=document.createElement("div"),this.modalContainer=document.createElement("div"),this.modalContainer.className="pointer-events-none",this.container.appendChild(this.hudContainer),this.container.appendChild(this.modalContainer),this.setupHUD(),this.setupListeners(),this.setupStoreSubscription(),this.startFlavorTextRotation()}setupHUD(){this.hudContainer.className="absolute top-0 left-0 w-full pointer-events-none flex flex-col z-50",this.hudContainer.innerHTML='\n      <header class="flex justify-between items-center border-b-2 border-cp-yellow pb-2 mb-0 bg-cp-black/70 -skew-x-[10deg] border-l-[10px] border-l-cp-cyan pointer-events-auto px-4 py-2">\n        <div class="text-2xl font-black text-cp-cyan ml-5 skew-x-[10deg] drop-shadow-[2px_2px_var(--cp-red)] font-cyber">\n          NEON REIGN\n        </div>\n        <div id="resources" class="flex gap-10 mr-5 skew-x-[10deg]">\n          <div class="text-xl font-bold text-cp-yellow uppercase flex items-center font-cyber">\n            EDDIES: <span id="hud-eddies" class="text-white ml-2">0</span>\n          </div>\n          <div class="text-xl font-bold text-cp-yellow uppercase flex items-center font-cyber">\n            REP: <span id="hud-rep" class="text-white ml-2">0</span>\n          </div>\n          <div class="text-xl font-bold text-cp-yellow uppercase flex items-center font-cyber">\n            MEMBERS: <span id="hud-members" class="text-white ml-2">0</span>\n          </div>\n          <button id="settings-btn" class="cyber-btn text-xs ml-2" title="Settings">⚙</button>\n          <button id="tutorial-btn" class="cyber-btn text-xs" title="Show Tutorial">?</button>\n        </div>\n      </header>\n    ',setTimeout(()=>{document.getElementById("tutorial-btn")?.addEventListener("click",()=>{T.playClick(),window.showTutorial?.()}),document.getElementById("settings-btn")?.addEventListener("click",()=>{T.playClick(),this.openSettingsPanel()})},100)}openSettingsPanel(){const e=document.getElementById("settings-overlay");if(!e)return;e.classList.remove("tutorial-hidden"),T.playPanelOpen();const t=document.getElementById("music-volume"),i=document.getElementById("sfx-volume"),s=document.getElementById("music-toggle"),n=document.getElementById("sfx-toggle"),a=document.getElementById("music-volume-value"),o=document.getElementById("sfx-volume-value");if(t&&(t.value=T.getMusicVolume().toString(),a&&(a.textContent=`${T.getMusicVolume()}%`)),i&&(i.value=T.getSfxVolume().toString(),o&&(o.textContent=`${T.getSfxVolume()}%`)),s&&(s.checked=T.isMusicEnabled()),n&&(n.checked=T.isSfxEnabled()),!e._listenersAdded){e._listenersAdded=!0,document.getElementById("settings-close-btn")?.addEventListener("click",()=>{T.playPanelClose(),e.classList.add("tutorial-hidden")}),t?.addEventListener("input",e=>{const t=parseInt(e.target.value);T.setMusicVolume(t),a&&(a.textContent=`${t}%`),this.saveSettings()}),i?.addEventListener("input",e=>{const t=parseInt(e.target.value);T.setSfxVolume(t),o&&(o.textContent=`${t}%`),T.playClick(),this.saveSettings()}),s?.addEventListener("change",e=>{const t=e.target.checked;T.setMusicEnabled(t),T.playClick(),this.saveSettings()}),n?.addEventListener("change",e=>{const t=e.target.checked;T.setSfxEnabled(t),t&&T.playClick(),this.saveSettings()});const r=document.getElementById("reset-progress-btn");r?.addEventListener("click",()=>{T.playError(),this.showResetConfirmationModal(()=>{T.playError(),this.resetGame(),e.classList.add("tutorial-hidden"),this.showToast("GAME RESET COMPLETE","success")})})}}saveSettings(){S.saveSettings({musicVolume:T.getMusicVolume(),sfxVolume:T.getSfxVolume(),musicEnabled:T.isMusicEnabled(),sfxEnabled:T.isSfxEnabled()})}resetGame(){S.forceReset(),window.location.reload()}showResetConfirmationModal(e){const t=this.createOverlay();t.style.zIndex="100000";const i=document.createElement("div");i.className="bg-cp-bg border-[3px] border-cp-red shadow-[0_0_60px_rgba(255,0,0,0.8)] w-[90%] max-w-[500px] flex flex-col animate-modalSlideIn pointer-events-auto",i.innerHTML='\n      <div class="bg-cp-red/20 border-b-2 border-cp-red p-5">\n        <h2 class="text-cp-red m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-red)] font-cyber font-bold uppercase text-center animate-pulse">⚠ WARNING ⚠</h2>\n      </div>\n      \n      <div class="p-6">\n        <p class="text-white text-lg mb-6 font-cyber leading-relaxed border-l-4 border-cp-red pl-4 bg-black/30 p-4">\n          This will <span class="text-cp-red font-bold">PERMANENTLY DELETE</span> all your progress, including:\n        </p>\n        \n        <ul class="text-gray-300 mb-6 space-y-2 font-cyber ml-4">\n          <li>• All gang members and upgrades</li>\n          <li>• All eddies and reputation</li>\n          <li>• All territories and completed missions</li>\n          <li>• All game settings</li>\n        </ul>\n\n        <p class="text-cp-yellow text-base font-cyber text-center font-bold mb-4 animate-pulse">\n          ARE YOU ABSOLUTELY SURE?\n        </p>\n      </div>\n\n      <div class="border-t-2 border-cp-red p-5 flex gap-3">\n        <button id="cancel-reset" class="cyber-btn flex-1 py-3 text-lg bg-gray-700 hover:bg-gray-600">CANCEL</button>\n        <button id="confirm-reset" class="cyber-btn flex-1 py-3 text-lg bg-cp-red/80 hover:bg-cp-red text-white animate-pulse">DELETE EVERYTHING</button>\n      </div>\n    ',t.appendChild(i),document.body.appendChild(t),i.querySelector("#cancel-reset")?.addEventListener("click",()=>{T.playClick(),t.remove()}),i.querySelector("#confirm-reset")?.addEventListener("click",()=>{T.playClick(),t.remove(),e()})}startFlavorTextRotation(){const e=document.getElementById("flavor-text");if(!e)return;const t=()=>{e.style.opacity="0",setTimeout(()=>{const t=this.flavorTexts[Math.floor(Math.random()*this.flavorTexts.length)];e.textContent=t,e.classList.add("glitch-text"),e.style.opacity="1",setTimeout(()=>{e.classList.remove("glitch-text")},500)},500)};t(),setInterval(t,8e3)}setupListeners(){window.addEventListener("building-click",e=>{const t=e.detail.type;"hideout"===t?this.openMissionBoard():"bar"===t?this.openAfterlife():"ripperdoc"===t&&this.openRipperdoc()}),window.addEventListener("mission-complete",e=>{const t=e.detail;this.showMissionReward(t)});const e=()=>{T.startBackgroundMusic(),document.removeEventListener("click",e)};document.addEventListener("click",e)}setupStoreSubscription(){r.subscribe(e=>{const t=document.getElementById("hud-eddies"),i=document.getElementById("hud-rep"),s=document.getElementById("hud-members");t&&(t.textContent=e.eddies.toLocaleString(),t.parentElement?.classList.remove("animate-pulse-cyber"),t.offsetWidth,t.parentElement?.classList.add("animate-pulse-cyber")),i&&(i.textContent=e.rep.toLocaleString()),s&&(s.textContent=e.members.length.toString());const n=document.getElementById("tab-content");n&&("missions"===this.activeTab?e.activeMissions===this.lastActiveMissions&&e.availableMissions===this.lastAvailableMissions||(this.lastActiveMissions=e.activeMissions,this.lastAvailableMissions=e.availableMissions,this.renderMissionsTab(n)):"territories"!==this.activeTab&&"gangs"!==this.activeTab||e.territories!==this.lastTerritories&&(this.lastTerritories=e.territories,"territories"===this.activeTab&&this.renderTerritoryTab(n),"gangs"===this.activeTab&&this.renderGangsTab(n))),this.renderEncounters(e.activeEncounters)})}renderEncounters(e){document.querySelectorAll(".encounter-marker").forEach(t=>{e.find(e=>e.id===t.dataset.id)||t.remove()}),e.forEach(e=>{if(!document.querySelector(`.encounter-marker[data-id="${e.id}"]`)){T.playAlert();const t=document.createElement("div");t.className="encounter-marker absolute w-16 h-16 flex items-center justify-center cursor-pointer z-[60] pointer-events-auto group",t.style.left=`${e.x}%`,t.style.top=`${e.y}%`,t.dataset.id=e.id,t.innerHTML='\n                <div class="absolute inset-0 bg-cp-yellow/30 rounded-full animate-ping"></div>\n                <div class="absolute inset-0 bg-cp-red/20 rotate-45 border-2 border-cp-yellow shadow-[0_0_15px_var(--cp-yellow)] transition-transform group-hover:scale-110 bg-black/80"></div>\n                <div class="relative text-cp-yellow text-4xl font-bold drop-shadow-[0_0_5px_var(--cp-red)] animate-pulse">!</div>\n                <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-black/90 border border-cp-yellow text-cp-yellow text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-cyber tracking-wider">\n                    SIGNAL DETECTED\n                </div>\n            ',t.addEventListener("click",t=>{t.stopPropagation(),T.playClick(),this.openEncounterModal(e.id,e.encounterId)}),this.container.appendChild(t)}})}openEncounterModal(e,t){const i=I.find(e=>e.id===t);if(!i)return;const s=this.createOverlay(),n=document.createElement("div");n.className="bg-cp-bg border-[3px] border-cp-red shadow-[0_0_40px_rgba(255,0,0,0.5)] w-[90%] max-w-[600px] flex flex-col animate-modalSlideIn pointer-events-auto relative",n.innerHTML=`\n        <div class="bg-cp-red/20 border-b-2 border-cp-red p-5 flex justify-between items-center shrink-0">\n            <h2 class="text-cp-red m-0 text-2xl drop-shadow-[0_0_10px_var(--cp-red)] font-cyber font-bold uppercase">${i.title}</h2>\n            <button id="close-encounter" class="bg-transparent border-2 border-cp-red text-cp-red text-2xl w-8 h-8 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n        </div>\n        \n        <div class="p-6">\n            <p class="text-white text-lg mb-6 font-cyber leading-relaxed border-l-4 border-cp-yellow pl-4 bg-black/30 p-4">\n                "${i.description}"\n            </p>\n\n            <div class="space-y-3">\n                ${i.options.map((e,t)=>`\n                    <button class="encounter-opt-btn w-full text-left p-4 border-2 border-gray-600 hover:border-cp-yellow hover:bg-cp-yellow/10 transition-all group relative overflow-hidden" data-index="${t}">\n                        <div class="font-bold text-cp-yellow text-lg group-hover:translate-x-2 transition-transform">${e.text}</div>\n                        ${e.skillCheck?`<div class="text-xs text-cp-cyan mt-1">CHECK: ${e.skillCheck.stat.toUpperCase()} ${e.skillCheck.difficulty}+</div>`:""}\n                    </button>\n                `).join("")}\n            </div>\n        </div>\n      `,s.appendChild(n),this.modalContainer.appendChild(s),n.querySelector("#close-encounter")?.addEventListener("click",()=>s.remove()),n.querySelectorAll(".encounter-opt-btn").forEach(i=>{i.addEventListener("click",i=>{const n=parseInt(i.currentTarget.dataset.index),a=N.resolveEncounter(t,n);x(e),s.remove(),this.showEncounterResult(a.message,a.success,a.effects)})})}showEncounterResult(e,t,i){const s=this.createOverlay(),n=document.createElement("div"),a=t?"cp-cyan":"cp-red";n.className=`bg-cp-bg border-[3px] border-${a} shadow-[0_0_40px_rgba(${t?"0,240,255":"255,0,0"},0.5)] w-[90%] max-w-[600px] flex flex-col animate-modalSlideIn pointer-events-auto`;let o="";if(i){const e=[];if(i.cost&&e.push(`<div class="flex items-center gap-2 text-cp-red"><span class="text-2xl">💸</span> <span>-${i.cost}€ COST</span></div>`),i.rewards&&(i.rewards.eddies&&e.push(`<div class="flex items-center gap-2 text-cp-yellow"><span class="text-2xl">💰</span> <span>+${i.rewards.eddies}€ EDDIES</span></div>`),i.rewards.xp&&e.push(`<div class="flex items-center gap-2 text-cp-cyan"><span class="text-2xl">⭐</span> <span>+${i.rewards.xp} XP</span></div>`),i.rewards.rep&&e.push(`<div class="flex items-center gap-2 text-green-400"><span class="text-2xl">🏆</span> <span>+${i.rewards.rep} REP</span></div>`),i.rewards.health)){const t=i.rewards.targetName?` (${i.rewards.targetName})`:"";e.push(`<div class="flex items-center gap-2 text-green-500"><span class="text-2xl">❤️</span> <span>+${i.rewards.health} HP${t}</span></div>`)}if(i.penalties&&(i.penalties.eddies&&e.push(`<div class="flex items-center gap-2 text-orange-500"><span class="text-2xl">💸</span> <span>-${i.penalties.eddies}€ LOST</span></div>`),i.penalties.rep&&e.push(`<div class="flex items-center gap-2 text-orange-500"><span class="text-2xl">📉</span> <span>${i.penalties.rep} REP</span></div>`),i.penalties.health)){const t=i.penalties.targetName?` (${i.penalties.targetName})`:"";e.push(`<div class="flex items-center gap-2 text-cp-red"><span class="text-2xl">💔</span> <span>-${i.penalties.health} HP DAMAGE${t}</span></div>`)}e.length>0&&(o=`\n          <div class="bg-black/40 border-t-2 border-${a}/30 p-4 mt-4">\n            <h3 class="text-cp-yellow font-bold font-cyber text-sm mb-3 uppercase tracking-wider">Effects Applied:</h3>\n            <div class="space-y-2 text-base font-cyber">\n              ${e.join("")}\n            </div>\n          </div>\n        `)}n.innerHTML=`\n        <div class="bg-${a}/10 border-b-2 border-${a} p-5">\n          <h2 class="text-${a} text-3xl font-bold font-cyber text-center drop-shadow-[0_0_10px_var(--${a})]">\n            ${t?"✓ SUCCESS":"✗ FAILURE"}\n          </h2>\n        </div>\n        <div class="p-6">\n          <p class="text-white text-lg mb-4 font-cyber leading-relaxed border-l-4 border-${a} pl-4 bg-black/30 p-4">"${e}"</p>\n          ${o}\n        </div>\n        <div class="border-t-2 border-${a} p-5">\n          <button id="close-result" class="cyber-btn w-full py-3 text-xl">CLOSE</button>\n        </div>\n      `,s.appendChild(n),this.modalContainer.appendChild(s),n.querySelector("#close-result")?.addEventListener("click",()=>{T.playClick(),s.remove()})}createOverlay(){const e=document.createElement("div");e.className="fixed inset-0 bg-black/95 flex justify-center items-center z-[10001] animate-[fadeIn_0.3s] pointer-events-auto";const t=e=>e.stopPropagation();return e.addEventListener("pointerdown",t),e.addEventListener("mousedown",t),e.addEventListener("touchstart",t),e.addEventListener("click",t),e}openMissionBoard(){this.modalContainer.innerHTML="";const e=this.createOverlay();e.addEventListener("click",t=>{t.target===e&&e.remove()});const t=document.createElement("div");t.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[1000px] h-[85vh] flex flex-col animate-modalSlideIn pointer-events-auto",t.innerHTML='\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">HIDEOUT</h2>\n        <button id="close-modal" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n      \n      \x3c!-- Tabs --\x3e\n      <div class="flex gap-2 p-4 bg-black/30 border-b border-cp-yellow/30">\n        <button class="cyber-btn tab-btn active" data-tab="missions">MISSIONS</button>\n        <button class="cyber-btn tab-btn" data-tab="roster">ROSTER</button>\n        <button class="cyber-btn tab-btn" data-tab="territory">TERRITORY</button>\n        <button class="cyber-btn tab-btn" data-tab="gangs">GANGS</button>\n      </div>\n\n      \x3c!-- Tab Content --\x3e\n      <div class="flex-1 overflow-y-auto p-5" id="tab-content"></div>\n    ',e.appendChild(t),this.modalContainer.appendChild(e);const i=t.querySelector("#tab-content");this.activeTab="missions",t.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{t.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"),this.activeTab=e.dataset.tab,T.playClick(),this.renderTabContent(i,this.activeTab)})}),t.querySelector("#close-modal")?.addEventListener("click",()=>e.remove()),this.renderTabContent(i,this.activeTab)}renderTabContent(e,t){e.innerHTML="","missions"===t?this.renderMissionsTab(e):"roster"===t?this.renderRosterTab(e):"territory"===t?this.renderTerritoryTab(e):"gangs"===t&&this.renderGangsTab(e)}renderMissionsTab(e){const t=r.get();if(e.innerHTML="",t.activeMissions.length>0){const i=document.createElement("h3");i.className="text-cp-cyan font-cyber text-xl mb-3 mt-2",i.textContent="ACTIVE MISSIONS",e.appendChild(i),t.activeMissions.forEach(i=>{const s=t.members.filter(e=>i.memberIds.includes(e.id));if(0===s.length)return;const n=i.mission,a=i.startTime,o=n.duration,r=document.createElement("div");r.className="bg-black/60 border-2 border-cp-cyan p-4 mb-3 animate-pulse";const l=s.length>1?`TEAM (${s.length})`:s[0].name;r.innerHTML=`\n          <div class="flex justify-between items-start mb-2">\n            <div>\n              <div class="font-bold text-white font-cyber text-lg">${n.name}</div>\n              <div class="text-cp-cyan text-sm font-cyber">[${n.type}]</div>\n            </div>\n            <div class="text-right">\n              <div class="text-cp-yellow font-bold font-cyber">${l}</div>\n              <div class="text-gray-400 text-xs truncate max-w-[150px]">\n                ${s.map(e=>`<span class="text-[10px] bg-cp-cyan/20 px-1 mr-1">${e.class.substring(0,3)}</span>${e.name}`).join(", ")}\n              </div>\n            </div>\n          </div>\n          \n          <div class="w-full h-4 bg-gray-800 border border-cp-cyan mt-2 relative overflow-hidden">\n            <div class="h-full bg-cp-cyan transition-all duration-1000 ease-linear mission-progress" style="width: 0%" id="progress-${i.id}"></div>\n          </div>\n          <div class="text-right text-cp-cyan font-mono text-sm mt-1 mission-timer" id="timer-${i.id}">CALCULATING...</div>\n        `,e.appendChild(r);const c=()=>{if(!document.body.contains(r))return;const e=Date.now()-a,t=Math.max(0,o-e),i=Math.min(100,e/o*100),s=r.querySelector(".mission-progress"),n=r.querySelector(".mission-timer");s&&(s.style.width=`${i}%`),n&&(n.textContent=`${(t/1e3).toFixed(1)}s remaining`),t>0?requestAnimationFrame(c):(n&&(n.textContent="COMPLETED"),r.classList.remove("animate-pulse"),r.classList.add("border-green-500"))};requestAnimationFrame(c)});const s=document.createElement("hr");s.className="border-gray-700 my-6",e.appendChild(s)}const i=document.createElement("div");i.className="flex justify-between items-center mb-4",i.innerHTML='<h3 class="text-cp-yellow font-cyber text-xl">AVAILABLE MISSIONS</h3>';const s=document.createElement("button");s.className="cyber-btn small-btn text-xs px-3 py-1",s.textContent="REFRESH (50€)",s.addEventListener("click",()=>{T.playClick(),r.get().eddies>=50&&(l(-50),p(),1)?(this.showToast("MISSIONS REFRESHED","success"),this.renderMissionsTab(e)):this.showToast("INSUFFICIENT FUNDS","error")}),i.appendChild(s),e.appendChild(i),0!==t.availableMissions.length?t.availableMissions.forEach(t=>{const i=document.createElement("div");i.className="bg-black/60 border-2 border-cp-yellow p-4 mb-3 cursor-pointer transition-all duration-300 hover:border-cp-cyan hover:translate-x-2 hover:shadow-[0_0_25px_rgba(0,240,255,0.4)] hover:bg-cp-cyan/5 animate-slideIn opacity-0 fill-mode-forwards";const s={EASY:"text-green-400",MEDIUM:"text-yellow-400",HARD:"text-orange-400",EXTREME:"text-cp-red"}[t.difficulty];i.innerHTML=`\n        <div class="flex justify-between items-start mb-2">\n          <h3 class="font-bold text-white font-cyber text-lg">${t.name}</h3>\n          <span class="text-xs font-bold ${s} border border-current px-2 py-1">${t.difficulty}</span>\n        </div>\n        <div class="text-cp-yellow text-sm mb-2 font-cyber">${t.type}</div>\n        <p class="text-gray-400 text-xs mb-3 h-10 overflow-hidden font-cyber">${t.description}</p>\n        <div class="flex gap-5 text-sm text-gray-400 font-cyber">\n          <span class="group-hover:text-cp-cyan transition-colors">💰 ${t.eddiesMin}-${t.eddiesMax}€</span>\n          <span class="group-hover:text-cp-cyan transition-colors">⭐ ${t.xpMin}-${t.xpMax} XP</span>\n          <span class="group-hover:text-cp-cyan transition-colors">⏱ ${t.duration/1e3}s</span>\n        </div>\n      `,i.addEventListener("click",()=>{T.playPanelOpen(),this.openMissionDetail(t)}),e.appendChild(i)}):e.innerHTML+='<div class="text-center text-gray-500 font-cyber py-8 text-xl">NO MISSIONS AVAILABLE</div>'}openMissionDetail(e){const t=this.createOverlay();t.addEventListener("click",e=>{e.target===t&&t.remove()});const i=document.createElement("div");i.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[1000px] h-[90vh] flex flex-col animate-modalSlideIn pointer-events-auto",i.innerHTML=`\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">${e.name}</h2>\n        <button id="close-detail" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n      \n      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 p-5 overflow-y-auto flex-1">\n        \x3c!-- Left Column: Details & Stats --\x3e\n        \x3c!-- Left Column: Details & Stats --\x3e\n        <div class="border-r border-cp-cyan pr-5 flex flex-col gap-2 overflow-hidden">\n          <div class="shrink-0">\n            <div class="flex justify-between items-center mb-1">\n              <span class="inline-block px-3 py-1 text-lg font-bold rounded bg-cp-black border border-cp-yellow text-cp-yellow">\n                ${e.difficulty}\n              </span>\n              <div class="text-cp-yellow text-base font-cyber">${e.type}</div>\n            </div>\n            \n            <div class="text-white text-sm leading-snug mb-2 p-2 bg-black/30 border-l-[3px] border-cp-yellow italic font-cyber">\n              "${e.description}"\n            </div>\n          </div>\n\n          \x3c!-- Mission Stats Grid --\x3e\n          <div class="grid grid-cols-2 gap-2 shrink-0">\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">REWARD</div>\n              <div class="text-white text-base font-cyber">${e.eddiesMin}-${e.eddiesMax}€</div>\n            </div>\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">XP</div>\n              <div class="text-white text-base font-cyber">${e.xpMin}-${e.xpMax}</div>\n            </div>\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">TIME</div>\n              <div class="text-white text-base font-cyber">${e.duration/1e3}s</div>\n            </div>\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">RISK</div>\n              <div class="text-white text-base font-cyber">${Math.round(100*e.injuryChance)}%</div>\n            </div>\n          </div>\n\n          \x3c!-- Team Stats & Probability --\x3e\n          <div class="bg-black/40 border border-cp-yellow p-3 mt-1 shrink-0">\n            <div class="flex justify-between items-center border-b border-cp-yellow/30 pb-1 mb-2">\n              <h4 class="text-cp-yellow font-bold font-cyber text-sm">PROJECTIONS</h4>\n              <div class="text-xs text-gray-400 font-cyber">\n                LVL ${e.minLevel}+ \n                ${e.minCool?`• COOL ${e.minCool}+`:""}\n                ${e.minReflex?`• REF ${e.minReflex}+`:""}\n              </div>\n            </div>\n            \n            <div class="flex justify-between mb-1 text-xs">\n              <span class="text-gray-400">TEAM POWER:</span>\n              <span class="text-white font-bold" id="team-power">0</span>\n            </div>\n            <div class="flex justify-between mb-1 text-xs">\n              <span class="text-gray-400">WIN CHANCE:</span>\n              <span class="text-cp-cyan font-bold" id="win-chance">0%</span>\n            </div>\n            <div class="w-full h-1.5 bg-gray-800 mb-2">\n              <div id="win-bar" class="h-full bg-cp-cyan transition-all duration-300" style="width: 0%"></div>\n            </div>\n\n            <div class="flex justify-between text-xs">\n              <span class="text-gray-400">INJURY RISK:</span>\n              <span class="text-cp-red font-bold" id="injury-risk">--</span>\n            </div>\n            \n            <div id="active-passives" class="mt-2 border-t border-gray-700 pt-1"></div>\n          </div>\n        </div>\n\n        \x3c!-- Right Column: Crew Selection --\x3e\n        <div class="flex flex-col h-full border-l border-cp-cyan/30 pl-5">\n          <div class="flex justify-between items-center mb-2">\n            <h3 class="text-cp-yellow m-0 font-cyber text-lg font-bold">SELECT CREW</h3>\n            <span class="text-[10px] text-gray-400">MAX 3</span>\n          </div>\n          \n          <div id="crew-list" class="flex-1 overflow-y-auto max-h-[300px] space-y-2 pr-1">\n            \x3c!-- Crew members go here --\x3e\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Biker Animation Section --\x3e\n      <div class="w-full h-[100px] bg-black/30 border-t-2 border-cp-yellow relative overflow-hidden shrink-0">\n         <div id="biker-anim" class="absolute left-[-150px] bottom-[10px] w-[150px] h-[80px]">\n           <img src="assets/biker.png" class="w-full h-full object-contain drop-shadow-[0_0_5px_var(--cp-cyan)]" />\n         </div>\n      </div>\n\n      <div class="border-t-2 border-cp-cyan p-5 flex justify-between items-center bg-black/30 shrink-0">\n        <div class="text-cp-yellow text-xl font-bold font-cyber">\n          SELECTED: <span id="selected-count">0</span>/3\n        </div>\n        <button id="send-crew-btn" class="cyber-btn px-10 py-4 text-xl disabled:opacity-50 disabled:cursor-not-allowed">\n          SEND CREW\n        </button>\n      </div>\n    `,t.appendChild(i),this.modalContainer.appendChild(t);let s=[];const n=i.querySelector("#send-crew-btn"),a=i.querySelector("#selected-count"),l=i.querySelector("#biker-anim"),c=i.querySelector("#team-power"),u=i.querySelector("#win-chance"),p=i.querySelector("#win-bar"),g=i.querySelector("#injury-risk");n.disabled=!0;const x=i.querySelector("#crew-list"),y=r.get().members.filter(e=>"IDLE"===e.status&&!e.injured);0===y.length?x.innerHTML='<div class="text-cp-red text-center p-10 font-cyber text-xl">NO AVAILABLE MEMBERS</div>':y.forEach(t=>{const l=document.createElement("div");l.className="flex items-center gap-4 p-3 bg-black/40 border-2 border-[#555] cursor-pointer transition-all duration-300 hover:bg-cp-cyan/10 hover:translate-x-1 hover:shadow-[0_0_15px_rgba(0,240,255,0.3)]";const d=t.level>=e.minLevel,h=!e.minCool||t.stats.cool>=e.minCool,m=!e.minReflex||t.stats.reflex>=e.minReflex,y=d&&h&&m;y?l.classList.add("border-cp-cyan"):l.classList.add("opacity-50","cursor-not-allowed","border-red-900"),l.innerHTML=`\n          <div class="flex-1">\n            <div class="flex justify-between items-center mb-1">\n              <div class="font-bold text-white font-cyber">${t.name}</div>\n              <div class="text-xs text-cp-yellow font-cyber">LVL ${t.level}</div>\n            </div>\n            <div class="flex gap-3 text-xs text-gray-400 font-mono">\n              <span>COOL: <span class="${t.stats.cool>=(e.minCool||0)?"text-cp-cyan":"text-red-500"}">${t.stats.cool}</span></span>\n              <span>REF: <span class="${t.stats.reflex>=(e.minReflex||0)?"text-cp-cyan":"text-red-500"}">${t.stats.reflex}</span></span>\n            </div>\n          </div>\n          <div class="w-6 h-6 border-2 border-cp-cyan flex items-center justify-center text-sm check-box transition-all"></div>\n        `,y&&l.addEventListener("click",()=>{T.playClick();const d=s.indexOf(t.id),h=l.querySelector(".check-box");if(d>-1)s.splice(d,1),l.classList.remove("bg-cp-cyan/20","border-cp-yellow","shadow-[0_0_20px_rgba(252,238,10,0.4)]"),h.classList.remove("bg-cp-yellow","border-cp-yellow"),h.textContent="";else{if(s.length>=3)return void this.showToast("MAX 3 MEMBERS","warning");s.push(t.id),l.classList.add("bg-cp-cyan/20","border-cp-yellow","shadow-[0_0_20px_rgba(252,238,10,0.4)]"),h.classList.add("bg-cp-yellow","border-cp-yellow"),h.textContent="✓"}a.textContent=s.length.toString(),n.disabled=0===s.length,(()=>{const t=r.get().members.filter(e=>s.includes(e.id));if(0===t.length)return c.textContent="0",u.textContent="0%",p.style.width="0%",void(g.textContent="--");const n=t.reduce((e,t)=>e+2*(t.stats.cool+t.stats.reflex)+5*t.level,0),a=e.difficultyRating||50,l=Math.min(.95,Math.max(.05,n/a)),d=.05*(t.length-1);let h=Math.max(.05,e.injuryChance-d);l>.5&&(h*=.5),c.textContent=n.toString(),u.textContent=`${Math.round(100*l)}%`,p.style.width=`${Math.round(100*l)}%`,u.className=l>.8?"text-green-500 font-bold":l>.5?"text-yellow-500 font-bold":"text-red-500 font-bold",g.textContent=`${Math.round(100*h)}%`;const m=t.map(e=>{const t=o[e.class];return`<div class="text-[10px] text-cp-cyan">• ${e.name} (${t.name}): ${t.passive}</div>`}).join(""),x=i.querySelector("#active-passives");x&&(x.innerHTML=m)})()}),x.appendChild(l)}),i.querySelector("#close-detail")?.addEventListener("click",()=>t.remove()),n.addEventListener("click",()=>{T.playClick(),s.length>0&&(l.style.animation="bikerSlide 1.5s linear forwards",n.disabled=!0,n.textContent="SENDING...",setTimeout(()=>{const i=((e,t,i=null)=>{const s=r.get(),n=s.availableMissions.find(e=>e.id===t);if(!n)return{success:!1,reason:"Mission not found"};if(0===e.length)return{success:!1,reason:"No members selected"};const a=s.members.filter(t=>e.includes(t.id));for(const r of a){if("IDLE"!==r.status)return{success:!1,reason:`${r.name} is busy`};if(r.injured)return{success:!1,reason:`${r.name} is injured`};if(r.level<n.minLevel)return{success:!1,reason:`${r.name} level too low`};if(n.minCool&&r.stats.cool<n.minCool)return{success:!1,reason:`${r.name} Cool too low`};if(n.minReflex&&r.stats.reflex<n.minReflex)return{success:!1,reason:`${r.name} Reflex too low`}}const o=s.members.map(t=>e.includes(t.id)?{...t,status:"ON MISSION",currentMission:n.name}:t);r.setKey("members",o);let l=null!==i?i:n.duration;a.some(e=>"NOMAD"===e.class)&&(l=Math.floor(.85*l));const c={id:Date.now()+Math.floor(1e3*Math.random()),memberIds:e,mission:n,startTime:Date.now(),endTime:Date.now()+l},u=[...s.activeMissions,c];return r.setKey("activeMissions",u),m(t),h(),setTimeout(()=>{d(c.id)},l),{success:!0}})(s,e.id);i.success?(T.playPurchase(),this.showToast("MISSION STARTED","success"),n.textContent="SENT!",setTimeout(()=>t.remove(),800)):(this.showToast(i.reason||"FAILED","error"),n.disabled=!1,n.textContent="SEND CREW")},1e3))})}showMissionReward(e){const{rewards:t,leveledUp:i,injured:s}=e;s?(T.playInjury(),this.showToast("MISSION FAILED - AGENT INJURED","error")):(T.playMissionComplete(),this.showToast(`MISSION COMPLETE(+${t.eddies}€)`,"success"),i&&(T.playLevelUp(),setTimeout(()=>this.showToast("LEVEL UP!","success"),500)))}showToast(e,t){const i=document.createElement("div");i.className=`fixed bottom-20 left-1/2 -translate-x-1/2 px-6 py-3 ${{success:"bg-green-500",warning:"bg-yellow-500",error:"bg-red-500"}[t]} text-black font-bold font-cyber z-[20000] animate-bounce shadow-[0_0_10px_currentColor]`,i.textContent=e,this.container.appendChild(i),setTimeout(()=>i.remove(),3e3)}async openAfterlife(){const e=this.createOverlay();e.addEventListener("click",t=>{t.target===e&&e.remove()});const t=document.createElement("div");t.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[500px] flex flex-col animate-modalSlideIn pointer-events-auto relative";const i=Object.keys(o),s=i[Math.floor(Math.random()*i.length)],{art:n,name:a,description:c}=w.generatePortrait(),d={name:a,class:s,description:c,cost:1e3,art:n};t.innerHTML=`\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">AFTERLIFE BAR</h2>\n        <button id="close-modal" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n\n      <div class="p-6 flex flex-col gap-4">\n        <div class="font-mono text-[10px] leading-none whitespace-pre text-cp-cyan bg-black/50 p-4 border border-cp-cyan/30 overflow-hidden select-none flex justify-center items-center min-h-[120px]">${d.art}</div>\n\n        <div class="border-l-4 border-cp-yellow pl-4">\n          <h3 class="text-white text-2xl font-cyber font-bold mb-1">${d.name}</h3>\n          <div class="text-cp-yellow text-sm font-cyber mb-2">CLASS: ${d.class}</div>\n          <p class="text-gray-400 text-sm italic mb-3">"${d.description}"</p>\n          <div class="text-cp-cyan text-sm font-bold font-cyber border-t border-gray-700 pt-2">\n            PASSIVE: ${o[d.class].passive}\n          </div>\n        </div>\n\n        <button id="recruit-btn" class="cyber-btn w-full py-4 text-xl mt-2 group relative overflow-hidden">\n          <span class="relative z-10">RECRUIT (${d.cost}€)</span>\n          <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>\n        </button>\n      </div>\n    `,e.appendChild(t),this.modalContainer.appendChild(e),t.querySelector("#close-modal")?.addEventListener("click",()=>e.remove()),t.querySelector("#recruit-btn")?.addEventListener("click",()=>{T.playClick();r.get().eddies>=d.cost?(l(-1e3),((e,t,i="",s)=>{const n=Object.keys(o),a=n[Math.floor(Math.random()*n.length)],l={id:Date.now(),name:e,class:s||a,description:t||"A fresh recruit ready for action.",art:i,status:"IDLE",level:1,xp:0,xpToNext:100,health:100,maxHealth:100,injured:!1,stats:{cool:Math.floor(5*Math.random())+3,reflex:Math.floor(5*Math.random())+3},currentMission:null},c=[...r.get().members,l];r.setKey("members",c)})(d.name,d.description,d.art,d.class),T.playPurchase(),this.showToast("MEMBER RECRUITED","success"),e.remove()):this.showToast("INSUFFICIENT FUNDS","error")})}openRipperdoc(){const e=this.createOverlay();e.addEventListener("click",t=>{t.target===e&&e.remove()});const t=document.createElement("div");t.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[900px] max-h-[85vh] flex flex-col animate-modalSlideIn pointer-events-auto",t.innerHTML='\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">RIPPERDOC</h2>\n        <button id="close-ripperdoc" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n\n      <div class="flex-1 overflow-y-auto p-5">\n        <h3 class="text-cp-yellow font-cyber mb-4">MEDICAL & UPGRADES</h3>\n        <p class="text-gray-400 mb-4">Heal injured members and install cyberware</p>\n        <div id="members-list"></div>\n      </div>\n    ',e.appendChild(t),this.modalContainer.appendChild(e);const i=t.querySelector("#members-list");r.get().members.forEach(e=>{const t=document.createElement("div");t.className="bg-black/60 border-2 border-cp-cyan p-4 mb-4";const s=e.health/e.maxHealth*100,n=100*e.stats.cool,a=100*e.stats.reflex;t.innerHTML=`\n        <div class="flex justify-between items-start mb-2">\n          <div>\n            <div class="text-cp-cyan font-bold text-lg font-cyber leading-none">${e.name} <span class="text-xs text-cp-yellow">LVL ${e.level}</span></div>\n            <div class="text-xs text-gray-400 font-mono mt-1">COOL: <span class="text-white">${e.stats.cool}</span> | REF: <span class="text-white">${e.stats.reflex}</span></div>\n          </div>\n          <div class="text-sm font-bold ${e.injured?"text-cp-red":"text-green-500"}">${e.injured?"INJURED":"HEALTHY"}</div>\n        </div>\n\n        <div class="relative h-6 bg-gray-800 mb-2">\n          <div class="absolute inset-0 bg-green-500" style="width: ${s}%"></div>\n          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${e.health}/${e.maxHealth} HP</div>\n        </div>\n        \n        ${e.injured?`\n          <button class="cyber-btn w-full mt-2" data-heal="${e.id}">HEAL (200€)</button>\n        `:`\n          <div class="mt-3">\n            <h4 class="text-cp-yellow text-sm mb-2 font-cyber">CYBERWARE UPGRADES</h4>\n            <div class="grid grid-cols-3 gap-2">\n              <button class="cyber-btn text-xs" data-upgrade="${e.id}" data-type="cool">+2 COOL (${n}€)</button>\n              <button class="cyber-btn text-xs" data-upgrade="${e.id}" data-type="reflex">+2 REF (${a}€)</button>\n              <button class="cyber-btn text-xs" data-upgrade="${e.id}" data-type="health">+20 HP (500€)</button>\n            </div>\n          </div>\n        `}\n      `,i.appendChild(t)}),i.querySelectorAll("[data-heal]").forEach(t=>{t.addEventListener("click",()=>{T.playClick();(e=>{const t=r.get(),i=t.members.find(t=>t.id===e);if(i&&i.injured){const e=200;if(t.eddies>=e)return l(-e),i.health=i.maxHealth,i.injured=!1,i.status="IDLE",r.setKey("members",[...t.members]),!0}return!1})(parseInt(t.dataset.heal))?(T.playHeal(),this.showToast("MEMBER HEALED","success"),e.remove(),this.openRipperdoc()):this.showToast("INSUFFICIENT FUNDS","error")})}),i.querySelectorAll("[data-upgrade]").forEach(t=>{t.addEventListener("click",()=>{T.playClick();const i=parseInt(t.dataset.upgrade),s=t.dataset.type;((e,t)=>{const i=r.get(),s=i.members.find(t=>t.id===e);if(!s)return!1;let n=0,a=!1;switch(t){case"cool":n=100*s.stats.cool,i.eddies>=n&&(l(-n),s.stats.cool+=2,a=!0);break;case"reflex":n=100*s.stats.reflex,i.eddies>=n&&(l(-n),s.stats.reflex+=2,a=!0);break;case"health":n=500,i.eddies>=n&&(l(-n),s.maxHealth+=20,s.health=s.maxHealth,a=!0)}return a&&r.setKey("members",[...i.members]),a})(i,s)?(T.playUpgrade(),this.showToast(`UPGRADED: ${s.toUpperCase()}`,"success"),e.remove(),this.openRipperdoc()):this.showToast("INSUFFICIENT FUNDS","error")})}),t.querySelector("#close-ripperdoc")?.addEventListener("click",()=>e.remove())}renderRosterTab(e){e.innerHTML="";const t=r.get(),i=document.createElement("div");i.className="w-full h-[120px] bg-black/30 border-2 border-cp-yellow relative overflow-hidden mb-4",i.innerHTML='\n      <div class="absolute left-[-150px] bottom-[10px] w-[150px] h-[100px]" style="animation: bikerSlide 4s linear infinite;">\n        <img src="assets/biker.png" class="w-full h-full object-contain drop-shadow-[0_0_5px_var(--color-cp-cyan)]" />\n      </div>\n    ',e.appendChild(i),0!==t.members.length?t.members.forEach(t=>{const i=document.createElement("div");i.className="bg-black/60 border-2 border-cp-cyan p-4 mb-3";const s=t.health/t.maxHealth*100,n=t.xp/t.xpToNext*100;let a="text-green-500",o="IDLE";t.injured?(a="text-cp-red",o="INJURED"):"ON MISSION"===t.status&&(a="text-cp-yellow",o="ON MISSION"),i.innerHTML=`\n        <div class="flex justify-between items-start mb-2">\n          <div>\n            <div class="text-cp-cyan font-bold text-lg font-cyber">${t.name} <span class="text-sm text-cp-yellow">LVL ${t.level}</span></div>\n            <div class="text-cp-cyan text-xs font-cyber mt-1">CLASS: ${t.class}</div>\n          </div>\n          <div class="text-sm font-bold ${a}">${o}</div>\n        </div>\n\n        <div class="relative h-6 bg-gray-800 mb-2">\n          <div class="absolute inset-0 bg-green-500" style="width: ${s}%"></div>\n          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${t.health}/${t.maxHealth} HP</div>\n        </div>\n\n        <div class="relative h-4 bg-gray-800 mb-2">\n          <div class="absolute inset-0 bg-cp-yellow" style="width: ${n}%"></div>\n          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${t.xp}/${t.xpToNext} XP</div>\n        </div>\n\n        <div class="flex gap-4 text-sm text-gray-400 font-cyber">\n          <span>COOL: ${t.stats.cool}</span>\n          <span>REF: ${t.stats.reflex}</span>\n        </div>\n      `,e.appendChild(i)}):e.innerHTML+='<div class="text-cp-red text-center p-10 font-cyber text-xl">NO GANG MEMBERS. RECRUIT SOME AT THE BAR!</div>'}renderTerritoryTab(e){const t=r.get();e.innerHTML="";const i=document.createElement("div");i.className="mb-4",i.innerHTML='<h3 class="text-cp-yellow font-cyber text-xl mb-2">NIGHT CITY DISTRICTS</h3><p class="text-gray-400">Territory status overview</p>',e.appendChild(i),t.territories.forEach((t,i)=>{const s=document.createElement("div");s.className="p-4 mb-3 border-l-4 transition-all duration-300 "+(t.controlled?"bg-green-900/20 border-green-500":"bg-black/60 border-gray-600"),s.style.animationDelay=.1*i+"s",s.classList.add("animate-slideIn","opacity-0","fill-mode-forwards");const n=t.rivalGang?g.getGangByTerritory(t.id):null;s.innerHTML=`\n        <div class="flex justify-between items-center">\n          <div>\n            <div class="font-bold text-lg font-cyber ${t.controlled?"text-green-400":"text-white"}">${t.name}</div>\n            <div class="text-cp-yellow text-sm">+${t.income}€ / 10s</div>\n          </div>\n          <div>\n            ${t.controlled?'<span class="text-green-500 font-bold border border-green-500 px-2 py-1">✓ CONTROLLED</span>':n?`<span class="text-cp-red font-bold border border-cp-red px-2 py-1">⚔ ${n.name}</span>`:'<span class="text-gray-500 font-bold border border-gray-500 px-2 py-1">UNCLAIMED</span>'}\n          </div>\n        </div>\n      `,e.appendChild(s)})}renderGangsTab(e){e.innerHTML="";const t=document.createElement("div");t.className="mb-4",t.innerHTML='<h3 class="text-cp-yellow font-cyber text-xl mb-2">WARFARE</h3><p class="text-gray-400">Expand your territory and eliminate rivals</p>',e.appendChild(t);const i=r.get(),s=document.createElement("div");s.className="text-cp-red font-cyber text-sm mb-2 mt-6 border-b border-cp-red/50 pb-1",s.textContent="RIVAL GANGS",e.appendChild(s);const n=g.getGangInfo();if(0===n.length){const t=document.createElement("div");return t.className="text-center text-green-500 font-cyber py-10 text-xl",t.textContent="NO RIVAL GANGS REMAIN. YOU CONTROL NIGHT CITY!",void e.appendChild(t)}n.forEach((t,s)=>{const n=document.createElement("div");n.className="bg-black/60 border-2 border-cp-red p-4 mb-4",n.style.animationDelay=.1*s+"s",n.innerHTML=`\n        <div class="flex justify-between items-start mb-3">\n          <div>\n            <div class="text-cp-red font-bold text-xl font-cyber">${t.name}</div>\n            <div class="text-gray-400 text-sm font-cyber">[${t.personality.toUpperCase()}]</div>\n          </div>\n          <div class="text-sm text-gray-400">\n            <span class="mr-4">⚔ ${t.strength}</span>\n            <span>🏴 ${t.territories} territories</span>\n          </div>\n        </div>\n      `,e.appendChild(n),i.territories.forEach(i=>{const s=g.getGangByTerritory(i.id);if(s&&s.name===t.name){const n=document.createElement("div");n.className="bg-black/40 border-l-4 border-cp-red p-3 mb-2 ml-4",n.innerHTML=`\n            <div class="flex justify-between items-center">\n              <div>\n                <div class="text-cp-cyan font-bold font-cyber">${i.name}</div>\n                <div class="text-cp-yellow text-sm">+${i.income}€ / 10s</div>\n              </div>\n              <button class="cyber-btn text-xs attack-btn" data-id="${i.id}">ATTACK</button>\n            </div>\n          `;const a=n.querySelector(".attack-btn");a?.addEventListener("click",()=>{T.playClick(),this.showAttackDialog(i.id,t.name,s.strength)}),e.appendChild(n)}})})}showAttackDialog(e,t,i){const s=r.get(),n=s.members.filter(e=>"IDLE"===e.status&&!e.injured);if(0===n.length)return void this.showToast("NO AVAILABLE MEMBERS FOR ATTACK!","error");const a=s.territories.find(t=>t.id===e),o=this.createOverlay();o.addEventListener("click",e=>{e.target===o&&o.remove()});const d=document.createElement("div");d.className="bg-cp-bg border-[3px] border-cp-red shadow-[0_0_40px_rgba(255,0,60,0.5)] w-[90%] max-w-[600px] max-h-[85vh] flex flex-col animate-modalSlideIn pointer-events-auto",d.innerHTML=`\n      <div class="bg-cp-red/10 border-b-2 border-cp-red p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-red m-0 text-2xl drop-shadow-[0_0_10px_var(--cp-red)] font-cyber font-bold">ATTACK ${a.name}</h2>\n        <button id="close-attack-dialog" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n\n      <div class="p-5 flex-1 overflow-y-auto">\n        <p class="text-gray-400 mb-4">Target: ${t} (Strength: ${i})</p>\n\n        <div class="bg-cp-red/5 border border-cp-red/30 p-3 mb-4">\n          <div class="text-cp-red text-xs font-bold mb-1">SUCCESS CHANCE</div>\n          <div class="text-white text-2xl font-cyber" id="success-chance">0%</div>\n        </div>\n\n        <h3 class="text-cp-yellow mb-3">SELECT CREW</h3>\n        <div id="attack-crew-list" class="space-y-2 max-h-[300px] overflow-y-auto mb-4"></div>\n\n        <div class="flex gap-2">\n          <button id="confirm-attack" class="cyber-btn flex-1">ATTACK</button>\n          <button id="cancel-attack" class="cyber-btn flex-1">CANCEL</button>\n        </div>\n      </div>\n    `,o.appendChild(d),document.body.appendChild(o);const u=[],p=d.querySelector("#attack-crew-list"),h=d.querySelector("#success-chance");n.forEach(e=>{const t=document.createElement("label");t.className="flex items-center gap-3 p-2 bg-black/40 border border-cp-cyan/30 cursor-pointer hover:bg-cp-cyan/10",t.innerHTML=`\n        <input type="checkbox" value="${e.id}" class="w-5 h-5" data-power="${10+2*e.stats.cool+2*e.stats.reflex+5*e.level}">\n        <span class="flex-1 font-cyber">${e.name} (LVL ${e.level} - COOL:${e.stats.cool} REF:${e.stats.reflex})</span>\n      `;const n=t.querySelector("input");n.addEventListener("change",()=>{if(n.checked)u.push(e.id);else{const t=u.indexOf(e.id);t>-1&&u.splice(t,1)}(()=>{const e=s.members.filter(e=>u.includes(e.id)).reduce((e,t)=>e+10+2*t.stats.cool+2*t.stats.reflex+5*t.level,0);let t=0;if(e>0){const s=e/i;t=s>=1.5?100:s<=.5?0:Math.round((s-.5)/1*100)}h.textContent=`${t}%`,h.style.color=t>=80?"lime":t>=50?"var(--color-cp-yellow)":"var(--color-cp-red)"})()}),p.appendChild(t)}),d.querySelector("#close-attack-dialog")?.addEventListener("click",()=>o.remove()),d.querySelector("#cancel-attack")?.addEventListener("click",()=>o.remove()),d.querySelector("#confirm-attack")?.addEventListener("click",()=>{if(T.playClick(),0===u.length)return void this.showToast("SELECT AT LEAST ONE MEMBER!","error");const t=((e,t)=>{const i=r.get(),s=i.members.filter(e=>t.includes(e.id));if(s.filter(e=>"IDLE"!==e.status||e.injured).length>0)return{success:!1,message:"Some members are unavailable!"};const n=g.attackTerritory(e,s);return n.success&&n.loot&&(l(n.loot),c(10)),r.setKey("territories",[...i.territories]),r.setKey("members",[...i.members]),n})(e,u);t.success?(T.playMissionComplete(),this.showToast(t.message,"success"),"loot"in t&&t.loot&&setTimeout(()=>this.showToast(`LOOTED ${t.loot}€!`,"success"),500)):this.showToast(t.message,"error"),o.remove(),this.modalContainer.innerHTML="",this.openMissionBoard()})}}document.addEventListener("DOMContentLoaded",()=>{const e=S.loadGame();e&&(e=>{Object.keys(e).forEach(t=>{r.setKey(t,e[t])})})(e);const t=S.loadSettings();if(t)T.setMusicVolume(t.musicVolume),T.setSfxVolume(t.sfxVolume),T.setMusicEnabled(t.musicEnabled),T.setSfxEnabled(t.sfxEnabled);else{const e=S.getDefaultSettings();S.saveSettings(e),T.setMusicVolume(e.musicVolume),T.setSfxVolume(e.sfxVolume)}E.getInstance().initialize(),new L});
