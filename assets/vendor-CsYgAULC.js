let e=[],l=0;const t=(t={})=>{let u=(t=>{let u=[],n={get:()=>(n.lc||n.listen(()=>{})(),n.value),lc:0,listen:t=>(n.lc=u.push(t),()=>{for(let u=l+4;u<e.length;)e[u]===t?e.splice(u,4):u+=4;let a=u.indexOf(t);~a&&(u.splice(a,1),--n.lc||n.off())}),notify(t,a){let f=!e.length;for(let l of u)e.push(l,n.value,t,a);if(f){for(l=0;l<e.length;l+=4)e[l](e[l+1],e[l+2],e[l+3]);e.length=0}},off(){},set(e){let l=n.value;l!==e&&(n.value=e,n.notify(l))},subscribe(e){let l=n.listen(e);return e(n.value),l},value:t};return n})(t);return u.setKey=function(e,l){let t=u.value;void 0===l&&e in u.value?(u.value={...u.value},delete u.value[e],u.notify(t,e)):u.value[e]!==l&&(u.value={...u.value,[e]:l},u.notify(t,e))},u};export{t as m};
