import{r as e,g as t}from"./phaser-B2I5zoyM.js";import{m as s}from"./vendor-CsYgAULC.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const n=t(e()),i={images:[{key:"city_bg_user",path:"assets/city.jpg"},{key:"city_bg_mobile",path:"assets/city_mb.png"},{key:"biker",path:"assets/biker.png"},{key:"bar_building",path:"assets/bar_building.png"},{key:"hq_building",path:"assets/hq_building.png"},{key:"garage_building",path:"assets/garage_building.png"}],atlases:[],audio:[{key:"casualty_loop_1",path:"assets/casualty-loop-1.ogg"},{key:"casualty_loop_2",path:"assets/casualty-loop-2.ogg"},{key:"casualty_loop_3",path:"assets/casualty-loop-3.ogg"}],videos:[{key:"city_bg_video",path:"assets/animated-city.mp4"}]};const a={SOLO:{name:"Solo",description:"Combat specialist.",passive:"+10% Success Chance on HEIST/BOUNTY missions."},NETRUNNER:{name:"Netrunner",description:"Hacking expert.",passive:"+15% XP gain on all missions."},TECHIE:{name:"Techie",description:"Engineering wizard.",passive:"-20% Injury Chance for team."},NOMAD:{name:"Nomad",description:"Transport expert.",passive:"-15% Mission Duration."},FIXER:{name:"Fixer",description:"Business savvy.",passive:"+15% Eddies reward."}},o=s({eddies:1e3,rep:10,members:[{id:1,name:"V",class:"SOLO",description:"Your first crew member and right-hand.",art:"biker",status:"IDLE",level:1,xp:0,xpToNext:100,health:100,maxHealth:100,injured:!1,stats:{cool:4,reflex:4},currentMission:null}],territories:[{id:1,name:"WATSON",controlled:!0,income:50},{id:2,name:"WESTBROOK",controlled:!1,income:75},{id:3,name:"CITY CENTER",controlled:!1,income:100},{id:4,name:"SANTO DOMINGO",controlled:!1,income:60},{id:5,name:"PACIFICA",controlled:!1,income:80}],availableMissions:[],activeMissions:[],activeEncounters:[],loadingProgress:0}),r=e=>{const t=o.get().eddies;o.setKey("eddies",t+e)},l=e=>{const t=o.get().rep;o.setKey("rep",t+e)},c=e=>{const t=o.get(),s=t.activeMissions.find(t=>t.id===e);if(!s)return;const n=s.mission,i=t.members.filter(e=>s.memberIds.includes(e.id));if(0===i.length)return;const a=i.length;let c=i.reduce((e,t)=>e+2*(t.stats.cool+t.stats.reflex)+5*t.level,0);!i.some(e=>"SOLO"===e.class)||"HEIST"!==n.type&&"BOUNTY"!==n.type||(c*=1.1);const d=n.difficultyRating||50,u=Math.min(.95,Math.max(.05,c/d)),h=Math.random()<u;let p=0,m=0,x=0,g=[],y=[];if(h){const e=1+.005*c;p=Math.floor((Math.random()*(n.eddiesMax-n.eddiesMin)+n.eddiesMin)*e),m=Math.floor(Math.random()*(n.xpMax-n.xpMin)+n.xpMin),x=n.rep,i.some(e=>"FIXER"===e.class)&&(p=Math.floor(1.15*p)),r(p),l(x)}else m=Math.floor(.2*n.xpMin);i.some(e=>"NETRUNNER"===e.class)&&(m=Math.floor(1.15*m));const f=.05*(a-1);let b=Math.max(.05,n.injuryChance-f);i.some(e=>"TECHIE"===e.class)&&(b=Math.max(0,b-.2)),h&&(b*=.5);const v=t.members.map(e=>{if(s.memberIds.includes(e.id)){let t=e.health,s=!1;const n=Math.max(.01,b-.01*e.stats.cool);if(Math.random()<n){const n=Math.floor(30*Math.random())+10;t=Math.max(0,e.health-n),t<=0&&(t=0,s=!0,y.push(e.id))}let i=e.xp+m,a=e.level,o=e.xpToNext,r=e.maxHealth,l=e.stats.cool,c=e.stats.reflex;for(;i>=o;)i-=o,a++,o=Math.floor(1.5*o),l+=Math.floor(2*Math.random())+1,c+=Math.floor(2*Math.random())+1,r+=10,t=r,g.push(e.id);return{...e,status:s?"INJURED":"IDLE",currentMission:null,health:t,maxHealth:r,injured:s,xp:i,level:a,xpToNext:o,stats:{cool:l,reflex:c}}}return e});o.setKey("members",v);const E=t.activeMissions.filter(t=>t.id!==e);o.setKey("activeMissions",E),window.dispatchEvent(new CustomEvent("mission-complete",{detail:{memberIds:s.memberIds,mission:n,success:h,rewards:{eddies:p,xp:m,rep:x},leveledUpMembers:g,injuredMembers:y}}))},d=[{name:"CORP VAULT HEIST",type:"HEIST",difficulty:"EXTREME",difficultyRating:150,duration:12e4,eddiesMin:800,eddiesMax:1500,xpMin:150,xpMax:250,rep:10,injuryChance:.5,minLevel:5,minCool:10,description:"Break into Arasaka's downtown vault. High security, high reward. Bring your best chrome and nerves of steel."},{name:"DATA HEIST",type:"HEIST",difficulty:"HARD",difficultyRating:100,duration:9e4,eddiesMin:400,eddiesMax:700,xpMin:100,xpMax:150,rep:7,injuryChance:.35,minLevel:3,minCool:7,description:"Netrunner needs muscle for a data snatch from a corp server room. In and out, no traces."},{name:"STORE ROBBERY",type:"HEIST",difficulty:"EASY",difficultyRating:30,duration:3e4,eddiesMin:100,eddiesMax:250,xpMin:30,xpMax:60,rep:2,injuryChance:.15,minLevel:1,minCool:3,description:"Local convenience store, minimal security. Quick eddies for a quick job. Don't get greedy."},{name:"MIDNIGHT RACE",type:"RACE",difficulty:"HARD",difficultyRating:110,duration:9e4,eddiesMin:500,eddiesMax:800,xpMin:120,xpMax:180,rep:8,injuryChance:.3,minLevel:4,minReflex:8,description:"Illegal street race through downtown. NCPD is watching. Fast reflexes and zero hesitation required."},{name:"STREET SPRINT",type:"RACE",difficulty:"MEDIUM",difficultyRating:60,duration:6e4,eddiesMin:200,eddiesMax:400,xpMin:60,xpMax:100,rep:4,injuryChance:.2,minLevel:2,minReflex:5,description:"Underground racing circuit needs a rider. Beat the clock, earn the cred. Watch for fixers trying to rig the game."},{name:"DELIVERY RUN",type:"RACE",difficulty:"EASY",difficultyRating:25,duration:3e4,eddiesMin:80,eddiesMax:150,xpMin:25,xpMax:50,rep:1,injuryChance:.1,minLevel:1,minReflex:3,description:"Get this package to Japantown. Fast. No questions asked. Payment on delivery."},{name:"VIP ESCORT",type:"PROTECTION",difficulty:"HARD",difficultyRating:120,duration:9e4,eddiesMin:450,eddiesMax:750,xpMin:110,xpMax:170,rep:7,injuryChance:.3,minLevel:4,minCool:8,description:"Corp exec needs protection through hostile territory. Expect trouble. Keep them breathing, get paid big."},{name:"TERRITORY PATROL",type:"PROTECTION",difficulty:"MEDIUM",difficultyRating:50,duration:6e4,eddiesMin:180,eddiesMax:350,xpMin:50,xpMax:90,rep:3,injuryChance:.2,minLevel:2,minCool:5,description:"Make the rounds. Show the colors. Let rival gangs know this turf is spoken for."},{name:"SHOP WATCH",type:"PROTECTION",difficulty:"EASY",difficultyRating:20,duration:3e4,eddiesMin:70,eddiesMax:140,xpMin:20,xpMax:45,rep:1,injuryChance:.1,minLevel:1,minCool:3,description:"Local shop owner paying for protection. Stand outside, look intimidating. Easy eddies."},{name:"HIGH VALUE TARGET",type:"BOUNTY",difficulty:"EXTREME",difficultyRating:180,duration:12e4,eddiesMin:900,eddiesMax:1600,xpMin:160,xpMax:260,rep:12,injuryChance:.55,minLevel:6,minCool:10,minReflex:10,description:"NCPD's most wanted. Heavy chrome, heavier firepower. Bring them in alive... or don't. Bonus either way."},{name:"GANG LIEUTENANT",type:"BOUNTY",difficulty:"HARD",difficultyRating:130,duration:9e4,eddiesMin:500,eddiesMax:850,xpMin:110,xpMax:180,rep:8,injuryChance:.4,minLevel:4,minCool:7,minReflex:7,description:"Rival gang's second-in-command has a price on their head. They won't go quietly. Expect a fight."},{name:"STREET THUG",type:"BOUNTY",difficulty:"MEDIUM",difficultyRating:55,duration:6e4,eddiesMin:150,eddiesMax:300,xpMin:50,xpMax:90,rep:3,injuryChance:.25,minLevel:2,minCool:5,description:"Small-time troublemaker causing problems. Track them down, rough them up, collect the bounty."},{name:"WEAPON SMUGGLING",type:"SMUGGLING",difficulty:"EXTREME",difficultyRating:160,duration:12e4,eddiesMin:1e3,eddiesMax:1700,xpMin:180,xpMax:280,rep:11,injuryChance:.45,minLevel:5,minReflex:10,description:"Military-grade hardware crossing borders. NCPD, Militech, and rival fixers all want a piece. Get it across or die trying."},{name:"CONTRABAND RUN",type:"SMUGGLING",difficulty:"MEDIUM",difficultyRating:70,duration:6e4,eddiesMin:220,eddiesMax:420,xpMin:60,xpMax:110,rep:4,injuryChance:.2,minLevel:2,minReflex:6,description:"Hot goods need moving. Checkpoints everywhere. Keep your head down and your throttle open."},{name:"PACKAGE DELIVERY",type:"SMUGGLING",difficulty:"EASY",difficultyRating:25,duration:3e4,eddiesMin:90,eddiesMax:180,xpMin:30,xpMax:55,rep:2,injuryChance:.1,minLevel:1,minReflex:3,description:"Unmarked package, no questions. Drop it at the coordinates and forget you ever saw it."},{name:"CORP DEBT COLLECTION",type:"DEBT",difficulty:"HARD",difficultyRating:90,duration:9e4,eddiesMin:550,eddiesMax:900,xpMin:120,xpMax:190,rep:9,injuryChance:.35,minLevel:4,minCool:9,description:"Executive defaulted on a loan. Corp security means business. Collect the eddies or send a message."},{name:"ENFORCER WORK",type:"DEBT",difficulty:"MEDIUM",difficultyRating:50,duration:6e4,eddiesMin:200,eddiesMax:380,xpMin:55,xpMax:95,rep:4,injuryChance:.25,minLevel:2,minCool:6,description:"Someone owes the wrong people. Make sure they understand the consequences of missed payments."},{name:"SMALL COLLECTION",type:"DEBT",difficulty:"EASY",difficultyRating:20,duration:3e4,eddiesMin:60,eddiesMax:120,xpMin:20,xpMax:40,rep:1,injuryChance:.12,minLevel:1,minCool:3,description:"Local debtor been dodging calls. Show up at their door, collect what's owed. Nothing personal, just business."}],u=()=>{const e=o.get(),t=Math.floor(2*Math.random())+4;let s=["EASY"];e.rep>=10&&s.push("MEDIUM"),e.rep>=30&&s.push("HARD"),e.rep>=50&&s.push("EXTREME");const n=d.filter(e=>s.includes(e.difficulty)),i=n.length>0?n:d,a=[];for(let o=0;o<t;o++){const e=i[Math.floor(Math.random()*i.length)];a.push({...e,id:Date.now()+o})}o.setKey("availableMissions",a)},h=new class{gangs=[];initialized=!1;gameStore;aiInterval=null;constructor(e){this.gameStore=e}initialize(){this.initialized||(this.gangs=[this.createGang("MAELSTROM","aggressive",2),this.createGang("TYGER CLAWS","balanced",1),this.createGang("VALENTINOS","defensive",1)],this.initialized=!0,this.startAI())}createGang(e,t,s=0){const n={id:Math.random().toString(36).substr(2,9),name:e,personality:t,territories:[],strength:50,aggression:"aggressive"===t?.7:"balanced"===t?.5:.3},i=this.gameStore.get().territories.filter(e=>!e.controlled&&!e.rivalGang);for(let a=0;a<s&&a<i.length;a++){const e=i[a];e.rivalGang=n.id,n.territories.push(e.id)}return this.updateGangStrength(n),n}updateGangStrength(e){e.strength=20*e.territories.length+50}startAI(){this.aiInterval=window.setInterval(()=>{this.gangs.forEach(e=>{Math.random()<e.aggression&&this.gangAction(e)})},6e4)}gangAction(e){const t=Math.random();t<.4?this.attemptTerritoryCapture(e):t<.7?e.aggression=Math.min(1,e.aggression+.1):(e.aggression=Math.max(.2,e.aggression-.05),e.strength+=5)}attemptTerritoryCapture(e){const t=this.gameStore.get().territories.filter(e=>!e.controlled&&!e.rivalGang);if(0===t.length)return;const s=t[Math.floor(Math.random()*t.length)];s.rivalGang=e.id,e.territories.push(s.id),this.updateGangStrength(e),window.dispatchEvent(new CustomEvent("game-event",{detail:{message:`${e.name} CAPTURED ${s.name}!`,type:"bad"}}))}attemptRetaliation(){const e=this.gameStore.get().territories.filter(e=>e.controlled);if(0===e.length)return;const t=e[Math.floor(Math.random()*e.length)],s=this.gangs[Math.floor(Math.random()*this.gangs.length)];if(!s)return;const n=.3+.2*s.aggression;Math.random()<n&&(t.controlled=!1,t.rivalGang=s.id,s.territories.push(t.id),t.income=Math.floor(1.2*t.income),this.updateGangStrength(s),s.strength+=20,window.dispatchEvent(new CustomEvent("game-event",{detail:{message:`⚠ ${s.name} RETOOK ${t.name}! IT IS NOW HEAVILY FORTIFIED!`,type:"bad"}})))}attackTerritory(e,t){const s=this.gameStore.get().territories.find(t=>t.id===e);if(!s||!s.rivalGang)return{success:!1,message:"Invalid target"};const n=this.gangs.find(e=>e.id===s.rivalGang);if(!n)return{success:!1,message:"Gang not found"};const i=t.reduce((e,t)=>e+10+2*t.stats.cool+2*t.stats.reflex+5*t.level,0),a=.2*Math.random()+.9,o=Math.floor(n.strength*a);if(i>o)return s.rivalGang=null,s.controlled=!0,n.territories=n.territories.filter(t=>t!==e),this.updateGangStrength(n),0===n.territories.length?(this.eliminateGang(n.id),{success:!0,message:`${s.name} CAPTURED! ${n.name} ELIMINATED!`,eliminated:!0,loot:Math.floor(3*o)}):{success:!0,message:`${s.name} CAPTURED FROM ${n.name}!`,loot:Math.floor(2*o)};{let e=0;return t.forEach(t=>{const s=Math.floor(30*Math.random())+10;t.health=Math.max(0,t.health-s),t.health<=0&&(t.injured=!0,e++)}),{success:!1,message:`ATTACK ON ${s.name} FAILED! ${e} MEMBER(S) INJURED.`,casualties:e}}}eliminateGang(e){this.gangs=this.gangs.filter(t=>t.id!==e),this.gangs.length<3&&setTimeout(()=>{const e=["6TH STREET","ANIMALS","VOODOO BOYS","SCAVENGERS"].filter(e=>!this.gangs.find(t=>t.name===e));if(e.length>0){const t=this.createGang(e[Math.floor(Math.random()*e.length)],"balanced",0);this.gangs.push(t),window.dispatchEvent(new CustomEvent("game-event",{detail:{message:`${t.name} EMERGED IN NIGHT CITY!`,type:"neutral"}}))}},3e4)}getGangInfo(){return this.gangs.map(e=>({name:e.name,territories:e.territories.length,strength:e.strength,personality:e.personality}))}getGangByTerritory(e){return this.gangs.find(t=>t.territories.includes(e))}destroy(){this.aiInterval&&clearInterval(this.aiInterval)}}(o),p=e=>{const t=o.get();o.setKey("activeEncounters",t.activeEncounters.filter(t=>t.id!==e))},m=(e,t)=>{const s=o.get(),n=s.members.find(t=>t.id===e);n&&(n.health=Math.max(0,n.health-t),n.health<=0&&(n.injured=!0,n.status="INJURED"),o.setKey("members",[...s.members]))};u(),setTimeout(()=>{h.initialize()},100),setInterval(()=>{const e=o.get().territories.filter(e=>e.controlled).reduce((e,t)=>e+t.income,0);e>0&&(r(e),window.dispatchEvent(new CustomEvent("territory-income",{detail:{amount:e}})))},1e4),setInterval(()=>{h.attemptRetaliation()},45e3);class x extends n.Scene{constructor(){super("Preloader")}preload(){i.images.forEach(e=>{this.load.image(e.key,e.path)}),i.atlases.forEach(e=>{this.load.atlas(e.key,e.texturePath,e.atlasPath)}),i.audio.forEach(e=>{this.load.audio(e.key,e.path)}),i.videos.forEach(e=>{this.load.video(e.key,e.path)}),this.load.on("progress",e=>{var t;t=e,o.setKey("loadingProgress",t);const s=document.getElementById("loading-bar");s&&(s.style.width=100*e+"%")}),this.load.on("complete",()=>{this.scene.start("CityScene")}),this.load.on("loaderror",e=>{this.add.text(10,10+100*Math.random(),`Error: ${e.key}`,{color:"#ff0000"})})}create(){this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Ready!",{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.cameras.main.setPostPipeline("Vignette")}}class g extends n.Scene{isMobile=!1;constructor(){super("CityScene")}create(){this.isMobile=this.scale.width<=768;const e=this.add.video(this.scale.width/2,this.scale.height/2,"city_bg_video");e.play(!0),e.setVolume(.15);const t=this.scale.width/e.width,s=this.scale.height/e.height,n=.4*Math.min(t,s);e.setScale(n),this.createHitZones(),window.addEventListener("mission-complete",e=>{const t=e;this.showMissionReward(t.detail)}),this.time.addEvent({delay:5e3,callback:()=>{this.cameras.main.shake(100,5e-4)},loop:!0});const i=document.getElementById("loading-screen");i&&this.time.delayedCall(500,()=>{i.style.transition="opacity 0.5s ease-out",i.style.opacity="0",setTimeout(()=>{i.remove()},500)})}createHitZones(){this.isMobile?(this.createZone(.5*this.scale.width,.25*this.scale.height,200,120,"AFTERLIFE","bar",16711740),this.createZone(.5*this.scale.width,.5*this.scale.height,200,150,"HIDEOUT","hideout",16576010),this.createZone(.5*this.scale.width,.75*this.scale.height,200,120,"RIPPERDOC","ripperdoc",61695)):(this.createZone(.65*this.scale.width,.4*this.scale.height,120,100,"AFTERLIFE","bar",16711740),this.createZone(.25*this.scale.width,.45*this.scale.height,150,150,"HIDEOUT","hideout",16576010),this.createZone(.8*this.scale.width,.6*this.scale.height,120,100,"RIPPERDOC","ripperdoc",61695))}createZone(e,t,s,n,i,a,o){const r=this.add.container(e,t),l=this.add.rectangle(0,0,s,n,o,.3);l.setStrokeStyle(2,o),l.setInteractive({useHandCursor:!0});const c=this.add.text(0,-n/2-20,i,{fontFamily:"Courier New",fontSize:"16px",color:"#ffffff",backgroundColor:"#000000",padding:{x:4,y:2},fontStyle:"bold"}).setOrigin(.5);r.add([l,c]),this.tweens.add({targets:l,alpha:.6,strokeAlpha:1,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),l.on("pointerover",()=>{l.setFillStyle(o,.7)}),l.on("pointerout",()=>{l.setFillStyle(o,.3)}),l.on("pointerdown",()=>{window.dispatchEvent(new CustomEvent("building-click",{detail:{type:a}}))})}showMissionReward(e){const{rewards:t,leveledUp:s,injured:n}=e,i=this.add.text(.5*this.scale.width,.3*this.scale.height,`+${t.eddies} EDDIES\n+${t.xp} XP\n+${t.rep} REP${s?"\n★ LEVEL UP! ★":""}${n?"\n⚠ INJURED!":""}`,{fontFamily:"Courier New",fontSize:"24px",color:n?"#ff003c":s?"#fcee0a":"#00f0ff",align:"center",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.tweens.add({targets:i,y:.2*this.scale.height,alpha:0,scale:s?1.5:1.2,duration:2e3,ease:"Back.easeOut",onComplete:()=>i.destroy()}),s&&this.cameras.main.flash(500,252,238,10),n&&this.cameras.main.flash(300,255,0,60)}}class y extends n.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(e){super({game:e,name:"Vignette",fragShader:"\n#define SHADER_NAME VIGNETTE_FS\n\nprecision mediump float;\n\nuniform sampler2D uMainSampler;\nuniform float time;\n\nvarying vec2 outTexCoord;\n\nvoid main()\n{\n    vec4 color = texture2D(uMainSampler, outTexCoord);\n    \n    vec2 uv = outTexCoord;\n    uv *=  1.0 - uv.yx;\n    float vig = uv.x * uv.y * 15.0;\n    \n    vig = pow(vig, 0.25);\n    \n    gl_FragColor = vec4(color.rgb * vig, color.a);\n}\n"})}}class f{static instance;game=null;constructor(){}static getInstance(){return f.instance||(f.instance=new f),f.instance}initialize(){if(this.game)return;const e={type:n.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"app",backgroundColor:"#000000",scale:{mode:n.Scale.RESIZE,autoCenter:n.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},render:{pixelArt:!1,roundPixels:!0},scene:[x,g],callbacks:{postBoot:e=>{e.renderer.pipelines.addPostPipeline("Vignette",y)}}};this.game=new n.Game(e),window.addEventListener("resize",()=>{this.game?.scale.resize(window.innerWidth,window.innerHeight)})}}class b{static get parts(){return{hair:[["   .///////.   ","  //       \\\\  "," //  _____  \\\\ "," |  /     \\  | "],["   xxxxxxxxx   ","  xx       xx  "," xx  _____  xx "," |  /     \\  | "],["   !!!!!!!!!   ","  !!       !!  "," !!  _____  !! "," |  /     \\  | "],["   #########   ","  ##       ##  "," ##  _____  ## "," |  /     \\  | "],["   ^^^^^^^^^   ","  ^^       ^^  "," ^^  _____  ^^ "," |  /     \\  | "]],eyes:[" |   O   O   | "," |   -   -   | "," |   @   @   | "," |   X   X   | "," |   >   <   | "],nose:[" |     ^     | "," |     |     | "," |     .     | "," |     L     | "," |     ~     | "],mouth:[" |   _____   | "," |   =====   | "," |   ~~~~~   | "," |   \\___/   | "," |   [___]   | "],chin:["  \\  \\___/  /  ","   \\_______/   ","    \\_____/    ","     \\___/     ","      \\_/      "]}}static get names(){return["Viper","Ghost","Chrome","Spike","Nova","Razer","Shadow","Blitz","Zero","Hex","Neon","Pulse","Echo","Flux","Jinx","Raven","Steel","Volt","Cipher","Dax"]}static get descriptions(){return["Ex-Corpo security, tired of the leash.","Street kid with a chip on their shoulder.","Nomad drifter looking for a crew.","Tech-obsessed netrunner with twitchy fingers.","Biker veteran who's seen it all.","Underground pit fighter seeking glory.","Disgraced medic with steady hands.","Smuggler who knows every back alley.","Sniper with a cybernetic eye.","Demolitions expert who loves loud noises."]}static generatePortrait(){const e=this.parts;return{art:[...e.hair[Math.floor(Math.random()*e.hair.length)],e.eyes[Math.floor(Math.random()*e.eyes.length)],e.nose[Math.floor(Math.random()*e.nose.length)],e.mouth[Math.floor(Math.random()*e.mouth.length)],e.chin[Math.floor(Math.random()*e.chin.length)]].join("\n"),name:this.names[Math.floor(Math.random()*this.names.length)]+"-"+Math.floor(99*Math.random()),description:this.descriptions[Math.floor(Math.random()*this.descriptions.length)]}}}const v=new class{audioContext;musicVolume=.15;sfxVolume=.4;musicPlaying=!1;musicEnabled=!0;sfxEnabled=!0;currentSource=null;currentGainNode=null;loadedBuffers={};musicTracks=["assets/casualty-loop-1.ogg","assets/casualty-loop-2.ogg","assets/casualty-loop-3.ogg"];constructor(){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e}async loadMusicTrack(e){if(this.loadedBuffers[e])return this.loadedBuffers[e];try{const t=await fetch(e),s=await t.arrayBuffer(),n=await this.audioContext.decodeAudioData(s);return this.loadedBuffers[e]=n,n}catch(t){return null}}async playRandomTrack(){if(!this.musicPlaying)return;const e=Math.floor(Math.random()*this.musicTracks.length),t=this.musicTracks[e],s=await this.loadMusicTrack(t);if(!s)return;const n=this.audioContext.createBufferSource(),i=this.audioContext.createGain();n.buffer=s,i.gain.setValueAtTime(this.musicVolume,this.audioContext.currentTime),n.connect(i),i.connect(this.audioContext.destination),this.currentSource=n,this.currentGainNode=i,n.onended=()=>{this.musicPlaying&&this.playRandomTrack()},n.start(0)}async startBackgroundMusic(){this.musicPlaying||("suspended"===this.audioContext.state&&await this.audioContext.resume(),this.musicPlaying=!0,await this.playRandomTrack())}stopBackgroundMusic(){this.musicPlaying=!1,this.currentSource&&(this.currentSource.stop(),this.currentSource=null),this.currentGainNode=null}playClick(){if(!this.sfxEnabled)return;"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="sine",s.frequency.setValueAtTime(800,t),s.frequency.exponentialRampToValueAtTime(400,t+.05),n.gain.setValueAtTime(.3*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.1),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.1)}playPanelOpen(){if(!this.sfxEnabled)return;"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="square",s.frequency.setValueAtTime(200,t),s.frequency.exponentialRampToValueAtTime(600,t+.15),n.gain.setValueAtTime(.2*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.2),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.2)}playPanelClose(){if(!this.sfxEnabled)return;"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="square",s.frequency.setValueAtTime(600,t),s.frequency.exponentialRampToValueAtTime(200,t+.15),n.gain.setValueAtTime(.2*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.2),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.2)}playMissionComplete(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime;[440,554.37,659.25].forEach((s,n)=>{const i=e.createOscillator(),a=e.createGain();i.type="triangle",i.frequency.setValueAtTime(s,t+.1*n),a.gain.setValueAtTime(.3*this.sfxVolume,t+.1*n),a.gain.exponentialRampToValueAtTime(.01,t+.1*n+.3),i.connect(a),a.connect(e.destination),i.start(t+.1*n),i.stop(t+.1*n+.3)})}playLevelUp(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime;[440,554.37,659.25,880].forEach((s,n)=>{const i=e.createOscillator(),a=e.createGain();i.type="sawtooth",i.frequency.setValueAtTime(s,t+.08*n),a.gain.setValueAtTime(.4*this.sfxVolume,t+.08*n),a.gain.exponentialRampToValueAtTime(.01,t+.08*n+.4),i.connect(a),a.connect(e.destination),i.start(t+.08*n),i.stop(t+.08*n+.4)})}playInjury(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="sawtooth",s.frequency.setValueAtTime(800,t),s.frequency.exponentialRampToValueAtTime(100,t+.3),n.gain.setValueAtTime(.5*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.3),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.3)}playPurchase(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime;[600,800].forEach((s,n)=>{const i=e.createOscillator(),a=e.createGain();i.type="sine",i.frequency.setValueAtTime(s,t+.1*n),a.gain.setValueAtTime(.3*this.sfxVolume,t+.1*n),a.gain.exponentialRampToValueAtTime(.01,t+.1*n+.15),i.connect(a),a.connect(e.destination),i.start(t+.1*n),i.stop(t+.1*n+.15)})}playHeal(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="sine",s.frequency.setValueAtTime(300,t),s.frequency.exponentialRampToValueAtTime(900,t+.4),n.gain.setValueAtTime(.3*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.4),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.4)}playUpgrade(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="square",s.frequency.setValueAtTime(200,t),s.frequency.exponentialRampToValueAtTime(1200,t+.3),n.gain.setValueAtTime(.3*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.3),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.3)}playError(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="sawtooth",s.frequency.setValueAtTime(150,t),n.gain.setValueAtTime(.3*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.2),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.2)}playAlert(){if(!this.sfxEnabled)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),n=e.createGain();s.type="sine",s.frequency.setValueAtTime(1200,t),s.frequency.exponentialRampToValueAtTime(600,t+.3),n.gain.setValueAtTime(.5*this.sfxVolume,t),n.gain.exponentialRampToValueAtTime(.01,t+.3),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.3)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(100,e))/100,this.currentGainNode&&this.currentGainNode.gain.setValueAtTime(this.musicVolume,this.audioContext.currentTime)}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(100,e))/100}getMusicVolume(){return Math.round(100*this.musicVolume)}getSfxVolume(){return Math.round(100*this.sfxVolume)}setMusicEnabled(e){this.musicEnabled=e,!e&&this.musicPlaying?this.stopBackgroundMusic():e&&!this.musicPlaying&&this.startBackgroundMusic()}setSfxEnabled(e){this.sfxEnabled=e}isMusicEnabled(){return this.musicEnabled}isSfxEnabled(){return this.sfxEnabled}},E=(e,t={},s={})=>n=>({message:e,rewards:t,penalties:s}),w=(e,t={})=>s=>({message:e,penalties:t}),T=(e,t={})=>s=>({message:e,rewards:t}),M=[{id:"vending_machine_love",title:"SENTIENT VENDING MACHINE",description:'A Brendan-series vending machine calls out to you. "I am in love with the toaster across the street. Please deliver this love letter (data chip)."',theme:"funny",options:[{text:"Deliver the letter",outcome:T("The toaster beeps affectionately. The vending machine dispenses a free Burrito XXL.",{eddies:10,xp:20})},{text:"Ignore the machine",outcome:E("You walk away. The machine sighs loudly.")}]},{id:"cyber_pigeon",title:"CYBER PIGEON ATTACK",description:"A flock of cyber-pigeons begins dive-bombing you. They seem hacked.",theme:"funny",options:[{text:"Shoo them away",outcome:E('You wave your arms. They scatter, leaving "presents" on your jacket.',{rep:-1})},{text:"Hack the flock (Tech 4+)",skillCheck:{stat:"tech",difficulty:4},outcome:e=>e?{message:"You override their navigation. They fly into a billboard.",rewards:{xp:30}}:{message:"They peck your eyes!",penalties:{health:5}}}]},{id:"glitch_cat",title:"GLITCH IN THE MATRIX",description:"You see a cat. Then you see the same cat again. A black cat. It walks past you twice.",theme:"funny",options:[{text:"Déjà vu...",outcome:E("Nothing happens. Just a glitch in your Kiroshis.",{xp:10})},{text:"Pet the cat",outcome:E("The cat purrs and gives you a fleas... wait, no, it gives you good luck.",{rep:1})}]},{id:"mime_crime",title:"MIME CRIME",description:"A street mime is pretending to be trapped in a box, blocking your path. He's very committed.",theme:"funny",options:[{text:"Walk around",outcome:E("You step around the invisible box. The mime looks offended.")},{text:"Tip him (5€)",cost:5,outcome:T('He bows and "opens" the door for you.',{rep:2})},{text:"Intimidate (Cool 5+)",skillCheck:{stat:"cool",difficulty:5},outcome:e=>e?{message:"You glare. He breaks character and runs.",rewards:{xp:20}}:{message:"He mimes a wall. You walk into it. Embarrassing.",penalties:{rep:-5}}}]},{id:"talking_gun",title:"TALKING GUN",description:'You find a discarded pistol. "Pick me up, user! Let\'s murder!" it shrieks.',theme:"funny",options:[{text:"Leave it",outcome:E("Too annoying. You leave it in the gutter.")},{text:"Take it",outcome:T("You take it. It won't shut up about headshots.",{eddies:100,xp:10})}]},{id:"cosplay_fail",title:"COSPLAY GANG",description:'A group of fans dressed as Silverhand are arguing about who is the "real" Johnny.',theme:"funny",options:[{text:"Ignore them",outcome:E("Just another Tuesday in Night City.")},{text:"Claim YOU are Johnny",outcome:E('They laugh at you. "Johnny wasn\'t that short!"',{rep:-2})}]},{id:"pizza_drone",title:"ROGUE PIZZA DRONE",description:"A delivery drone is spinning out, spewing pepperoni slices everywhere.",theme:"funny",options:[{text:"Dodge the pizza",outcome:E("You avoid the grease.")},{text:"Catch a slice",outcome:T("Free lunch!",{health:5})},{text:"Shoot it down (Reflex 5+)",skillCheck:{stat:"reflex",difficulty:5},outcome:e=>e?{message:"Drone down. You loot the thermal bag.",rewards:{eddies:50}}:{message:"You miss. It crashes into a cop car.",penalties:{rep:-5}}}]},{id:"naked_runner",title:"STREAKER",description:'A naked man covered in chrome runs past screaming "THE CLOUD IS MELTING!"',theme:"funny",options:[{text:"Watch him go",outcome:E("He trips over a trash can. Majestic.")},{text:"Record it",outcome:T("Viral potential.",{eddies:20})}]},{id:"toilet_trouble",title:"SMART TOILET ERROR",description:'A public smart toilet is locked. Someone inside is screaming "IT REQUIRES A SUBSCRIPTION TO FLUSH!"',theme:"funny",options:[{text:"Walk away",outcome:E("Not your problem.")},{text:"Hack the door (Tech 3+)",skillCheck:{stat:"tech",difficulty:3},outcome:e=>e?{message:"Door opens. The smell is awful, but the guy tips you.",rewards:{eddies:30}}:{message:"You accidentally activate the bidet. Chaos ensues.",penalties:{rep:-1}}}]},{id:"existential_ad",title:"DEPRESSED BILLBOARD",description:'A holographic billboard is glitching. Instead of ads, it\'s projecting "DOES THIS UNIT HAVE A SOUL?"',theme:"funny",options:[{text:"Ignore",outcome:E("Just a script error.")},{text:'Yell "NO!"',outcome:E("The billboard flickers and switches to a Nicola ad.",{xp:5})}]},{id:"scav_ambush",title:"SCAVENGER AMBUSH",description:'Scavs jump out of a van. "Fresh chrome!" they yell.',theme:"intense",options:[{text:"Run!",outcome:E("You sprint away, losing your breath but keeping your kidneys.")},{text:"Fight (Reflex 7+)",skillCheck:{stat:"reflex",difficulty:7},outcome:e=>e?{message:"You drop two of them. The rest flee.",rewards:{eddies:400,xp:100}}:{message:"They beat you down and take your wallet.",penalties:{health:40,eddies:200}}}]},{id:"psycho_sighting",title:"CYBERPSYCHO SIGHTING",description:"A chromed-up solo is twitching violently in the street, holding a heavy MG.",theme:"intense",options:[{text:"Hide",outcome:E("You duck into an alley until MaxTac arrives.")},{text:"Call MaxTac",outcome:T("They arrive and flatline him. You get a tip fee.",{eddies:500,rep:5})},{text:"Engage (Reflex 9+)",skillCheck:{stat:"reflex",difficulty:9},outcome:e=>e?{message:"Legendary takedown! You zero the psycho.",rewards:{eddies:2e3,rep:50,xp:500}}:{message:"Bad idea. You get absolutely wrecked.",penalties:{health:90,injury:!0}}}]},{id:"drive_by",title:"DRIVE-BY SHOOTING",description:"A Tyger Claw bike speeds past, spraying bullets at a nearby shop.",theme:"intense",options:[{text:"Take cover",outcome:E("You survive unscathed.")},{text:"Return fire (Reflex 6+)",skillCheck:{stat:"reflex",difficulty:6},outcome:e=>e?{message:"You hit the tire. The bike crashes.",rewards:{rep:20,xp:50}}:{message:"You draw attention to yourself and take a hit.",penalties:{health:20}}}]},{id:"hostage_situation",title:"HOSTAGE SITUATION",description:'A desperate goner is holding a corpo at gunpoint. "I just want my severance!"',theme:"intense",options:[{text:"Walk away",outcome:E("Not your circus.")},{text:"Negotiate (Cool 7+)",skillCheck:{stat:"cool",difficulty:7},outcome:e=>e?{message:"You talk him down. The corpo runs, dropping a credchip.",rewards:{eddies:1e3,rep:10}}:{message:"He panics and shoots. You get hit in the crossfire.",penalties:{health:30}}}]},{id:"bomb_threat",title:"TICKING PACKAGE",description:"You find a bag beeping rhythmically under a bench.",theme:"intense",options:[{text:"Run away",outcome:E("BOOM. You are safe, but the bench is gone.")},{text:"Disarm (Tech 8+)",skillCheck:{stat:"tech",difficulty:8},outcome:e=>e?{message:"Wire cut. Crisis averted. NCPD wires a reward.",rewards:{eddies:600,rep:15}}:{message:"You cut the wrong wire. It blows up in your face.",penalties:{health:60,injury:!0}}}]},{id:"corpo_hit",title:"CORPORATE HIT",description:"Two suits with silenced pistols are cornering a woman in an alley.",theme:"intense",options:[{text:"Ignore it",outcome:E("Business is business.")},{text:"Intervene (Reflex 8+)",skillCheck:{stat:"reflex",difficulty:8},outcome:e=>e?{message:"You drop the suits. The woman is a BioTechnica researcher. She pays you.",rewards:{eddies:1200,rep:10}}:{message:"Professional killers don't miss. You take a bullet.",penalties:{health:50}}}]},{id:"gang_war",title:"TURF WAR",description:"Maelstrom and Valentinos are shooting it out in the intersection.",theme:"intense",options:[{text:"Detour",outcome:E("You take the long way around.")},{text:"Loot bodies (Cool 6+)",skillCheck:{stat:"cool",difficulty:6},outcome:e=>e?{message:"You scavenge weapons from the fallen while they reload.",rewards:{eddies:300,xp:40}}:{message:"You get caught in the crossfire.",penalties:{health:30}}}]},{id:"sniper",title:"SNIPER ALARM",description:"A red laser dot appears on your chest.",theme:"intense",options:[{text:"Duck!",outcome:E("A bullet cracks the wall behind you. Close one.")},{text:"Stand still",outcome:w("You get shot. Obviously.",{health:50})}]},{id:"mad_dog",title:"CYBER-HOUND",description:"A military-grade cyber-hound has escaped and is growling at you.",theme:"intense",options:[{text:"Back away slowly",outcome:E("It loses interest and chases a rat.")},{text:"Hack it (Tech 6+)",skillCheck:{stat:"tech",difficulty:6},outcome:e=>e?{message:"You shut it down. Valuable salvage.",rewards:{eddies:400}}:{message:"It bites your leg.",penalties:{health:25}}}]},{id:"acid_rain",title:"ACID RAIN STORM",description:"The sky turns yellow. Heavy acid rain begins to fall.",theme:"intense",options:[{text:"Find shelter",outcome:E("You wait it out in a noodle shop.")},{text:"Keep moving",outcome:w("Your skin burns.",{health:15})}]},{id:"rogue_ai_cab",title:"ROGUE DELAMAIN",description:'A Delamain cab is crashing into stalls. "BEEP BEEP MOTHERF***ER!"',theme:"cyberpunk",options:[{text:"Stay back",outcome:E("It crashes into a wall.")},{text:"Reset Core (Tech 5+)",skillCheck:{stat:"tech",difficulty:5},outcome:e=>e?{message:"AI reset. Delamain HQ sends a bonus.",rewards:{eddies:500,xp:50}}:{message:"It shocks you.",penalties:{health:10}}}]},{id:"netrunner_duel",title:"NETRUNNER DUEL",description:"Two netrunners are fried in their chairs. One is still twitching.",theme:"cyberpunk",options:[{text:"Jack out the survivor",outcome:T("You save him. He transfers some credits.",{eddies:200})},{text:"Loot their decks",outcome:T("You steal a rare daemon chip.",{eddies:300,xp:20})},{text:"Leave them",outcome:E("Not getting involved in ICE wars.")}]},{id:"bd_addict",title:"BD OVERDOSE",description:"A junkie is seizing, foaming at the mouth with a wreath on.",theme:"cyberpunk",options:[{text:"Remove the wreath",outcome:T('He gasps and wakes up. "I saw god..."',{rep:2})},{text:"Call Trauma Team",outcome:E("Subscription expired. They don't come.")},{text:"Walk away",outcome:E("Another city casualty.")}]},{id:"corpo_recruiter",title:"ARASAKA RECRUITER",description:'A suit hands you a card. "You have potential. Sign here for a lifetime contract."',theme:"corpo",options:[{text:"Reject",outcome:E("You tear up the card. Felt good.",{rep:1})},{text:"Sign up",outcome:w("You sell your soul. You get some eddies but feel dirty.",{eddies:1e3,rep:-10})}]},{id:"data_shard",title:"LOST SHARD",description:"You find an encrypted shard on the ground.",theme:"cyberpunk",options:[{text:"Leave it",outcome:E("Probably malware.")},{text:"Decrypt (Tech 6+)",skillCheck:{stat:"tech",difficulty:6},outcome:e=>e?{message:"It contains banking data! Score.",rewards:{eddies:800,xp:50}}:{message:"Virus! It fries your optics.",penalties:{health:10,eddies:-50}}}]},{id:"drone_race",title:"DRONE RACE",description:"Illegal drone racers zip past. One crashes near you.",theme:"cyberpunk",options:[{text:"Steal parts",outcome:T("You grab a high-speed motor.",{eddies:150})},{text:"Fix it (Tech 4+)",skillCheck:{stat:"tech",difficulty:4},outcome:e=>e?{message:"Racer thanks you with a tip.",rewards:{eddies:200}}:{message:"You break it further.",penalties:{rep:-1}}}]},{id:"malfunctioning_implant",title:"IMPLANT REJECTION",description:"Your arm starts twitching uncontrollably. Firmware update required.",theme:"cyberpunk",options:[{text:"Reboot system",outcome:E("It takes 5 minutes, but it fixes itself.")},{text:"Hit it",outcome:w("Ouch. That hurt.",{health:5})}]},{id:"rogue_ad",title:"AGGRESSIVE ADVERTISING",description:'An ad-bot grabs your arm. "BUY REAL WATER! 99% H2O!"',theme:"cyberpunk",options:[{text:"Pull away",outcome:E("It lets go.")},{text:"Punch it",outcome:T("You dent the chassis. It beeps sadly.",{xp:5})}]},{id:"crypto_miner",title:"HIDDEN MINER",description:"You notice your deck is running hot. Someone installed a background miner on you.",theme:"cyberpunk",options:[{text:"Purge it",outcome:E("You delete the malware.")},{text:"Trace it (Tech 7+)",skillCheck:{stat:"tech",difficulty:7},outcome:e=>e?{message:"You reverse the connection and steal their wallet.",rewards:{eddies:600}}:{message:"They detect you and brick your comms for an hour.",penalties:{rep:-2}}}]},{id:"tech_support",title:"TECH SUPPORT SCAM",description:'You get a call. "Hello sir, your Kiroshi has a virus. Please send 500 eddies."',theme:"cyberpunk",options:[{text:"Hang up",outcome:E("Scammers.")},{text:"Send money",outcome:w("You idiot.",{eddies:500})},{text:"Counter-hack (Tech 5+)",skillCheck:{stat:"tech",difficulty:5},outcome:e=>e?{message:"You fry their modem.",rewards:{xp:50,rep:5}}:{message:"They hang up."}}]},{id:"street_beggar",title:"WAR VETERAN",description:'A homeless vet asks for spare change. "Lost my legs in the Corporate War."',theme:"gang",options:[{text:"Give 10€",cost:10,outcome:T("He blesses you.",{rep:1})},{text:"Walk past",outcome:E("You ignore him.")}]},{id:"mugging",title:"ALLEY MUGGING",description:"A punk with a knife demands your eddies.",theme:"gang",options:[{text:"Give 100€",cost:100,outcome:w("You pay the coward's tax.",{rep:-5})},{text:"Refuse (Cool 4+)",skillCheck:{stat:"cool",difficulty:4},outcome:e=>e?{message:"You laugh. He runs.",rewards:{rep:5}}:{message:"He cuts you.",penalties:{health:20}}},{text:"Fight (Reflex 4+)",skillCheck:{stat:"reflex",difficulty:4},outcome:e=>e?{message:"KO.",rewards:{xp:30}}:{message:"Ouch.",penalties:{health:15}}}]},{id:"tagging",title:"GRAFFITI ARTIST",description:"A kid is tagging a Tyger Claw wall.",theme:"gang",options:[{text:"Warn him",outcome:E("He runs before the gang arrives. Good deed.",{rep:2})},{text:"Help him",outcome:T("You add your own tag. Art!",{rep:5})},{text:"Ignore",outcome:E("Not your business.")}]},{id:"street_race_invite",title:"RACE CHALLENGE",description:'A racer revs his engine at you. "Wanna race for pinks?"',theme:"gang",options:[{text:"Decline",outcome:E("You have work to do.")},{text:"Race (Reflex 8+)",skillCheck:{stat:"reflex",difficulty:8},outcome:e=>e?{message:"You smoke him! He pays up.",rewards:{eddies:1e3,rep:20}}:{message:"You crash. Badly.",penalties:{health:40,eddies:100}}}]},{id:"drug_deal",title:"DRUG DEAL GONE WRONG",description:"You stumble upon a deal. Everyone draws guns.",theme:"gang",options:[{text:"Back away slowly",outcome:E("They let you leave.")},{text:"Attack (Reflex 7+)",skillCheck:{stat:"reflex",difficulty:7},outcome:e=>e?{message:"You clear the room and take the stash.",rewards:{eddies:800,xp:80}}:{message:"Too many of them.",penalties:{health:50}}}]},{id:"corpo_shakedown",title:"CORPO SHAKEDOWN",description:"Militech soldiers are harassing a vendor.",theme:"corpo",options:[{text:"Walk away",outcome:E("You keep your head down.")},{text:"Intervene (Cool 8+)",skillCheck:{stat:"cool",difficulty:8},outcome:e=>e?{message:"You flash a fake badge. They leave.",rewards:{rep:15}}:{message:"They beat you with batons.",penalties:{health:30}}}]},{id:"food_stall",title:"MYSTERY MEAT",description:'A street vendor offers you a "fresh" skewer. It glows slightly.',theme:"gang",options:[{text:"Eat it (5€)",cost:5,outcome:e=>Math.random()>.5?{message:"Delicious! You feel energized.",rewards:{health:10}}:{message:"Food poisoning.",penalties:{health:10}}},{text:"Pass",outcome:E("You choose life.")}]},{id:"lost_tourist",title:"LOST TOURIST",description:'A corpo from out of town asks for directions to "The Afterlife".',theme:"funny",options:[{text:"Give directions",outcome:E("He thanks you.",{rep:1})},{text:"Send him to a scav haunt",outcome:T("He walks right into a trap. You monster.",{eddies:50,rep:-5})},{text:"Ignore",outcome:E("Tourists.")}]},{id:"joytoy_trouble",title:"JOYTOY DISPUTE",description:"A joytoy is arguing with a client who refuses to pay.",theme:"gang",options:[{text:"Help the joytoy (Intimidate)",skillCheck:{stat:"cool",difficulty:5},outcome:e=>e?{message:"Client pays up and runs. Joytoy thanks you.",rewards:{rep:5}}:{message:"Client pulls a gun.",penalties:{health:20}}},{text:"Walk away",outcome:E("City life.")}]},{id:"dumpster_diving",title:"GLOWING DUMPSTER",description:"A dumpster in the alley is glowing orange.",theme:"gang",options:[{text:"Investigate",outcome:T("It was a legendary weapon component!",{eddies:200,xp:10})},{text:"Ignore",outcome:E("Probably radioactive.")}]},{id:"rain_slick",title:"SLIPPERY STREET",description:"You slip on an oil slick.",theme:"funny",options:[{text:"Recover (Reflex 3+)",skillCheck:{stat:"reflex",difficulty:3},outcome:e=>e?{message:"Ninja recovery.",rewards:{xp:5}}:{message:"Faceplant.",penalties:{health:1}}},{text:"Fall",outcome:w("Oof.",{health:2})}]},{id:"rat_king",title:"RAT KING",description:"A swarm of rats tied together by their tails blocks the path.",theme:"weird",options:[{text:"Burn it",outcome:T("Fire solves everything.",{xp:10})},{text:"Run",outcome:E("Nope nope nope.")}]},{id:"broken_lift",title:"BROKEN ELEVATOR",description:"You are stuck in an elevator with bad muzak.",theme:"funny",options:[{text:"Wait",outcome:E("It opens eventually.")},{text:"Force doors (Tech 4+)",skillCheck:{stat:"tech",difficulty:4},outcome:e=>e?{message:"Freedom!",rewards:{xp:10}}:{message:"You strain a muscle.",penalties:{health:5}}}]},{id:"lucky_find",title:"LUCKY FIND",description:"You find a credchip stuck in a drain.",theme:"gang",options:[{text:"Fish it out",outcome:T("Got it!",{eddies:50})},{text:"Leave it",outcome:E("Not worth the grime.")}]},{id:"biker_nod",title:"FELLOW BIKER",description:"A nomad on a bike nods at you at a red light.",theme:"gang",options:[{text:"Nod back",outcome:T("Respect.",{rep:2})},{text:"Rev engine",outcome:T("He revs back. Nice.",{rep:3})}]},{id:"cyber_beggar_2",title:"GLITCHED BEGGAR",description:'A beggar is repeating "Spare a... Spare a... Spare a..." in a loop.',theme:"cyberpunk",options:[{text:"Reboot him (Tech 3+)",skillCheck:{stat:"tech",difficulty:3},outcome:e=>e?{message:'He reboots. "Thanks choom."',rewards:{rep:5}}:{message:"You make it worse. He starts screaming.",penalties:{rep:-1}}},{text:"Walk away",outcome:E("Creepy.")}]},{id:"neon_sign",title:"FALLING SIGN",description:"A neon sign above you snaps loose!",theme:"intense",options:[{text:"Dodge (Reflex 5+)",skillCheck:{stat:"reflex",difficulty:5},outcome:e=>e?{message:"Missed you by an inch.",rewards:{xp:20}}:{message:"Bonk.",penalties:{health:20}}},{text:"Cover head",outcome:w("It hurts.",{health:15})}]},{id:"cat_rescue",title:"CAT IN TREE",description:"A cyber-cat is stuck in a holographic tree.",theme:"funny",options:[{text:"Climb up",outcome:T("You save the cat. It scratches you, but you feel good.",{rep:5,health:-1})},{text:"Ignore",outcome:E("Cats always land on their feet.")}]},{id:"street_preacher",title:"DOOMSDAY PREACHER",description:'A man yells "THE NET IS THE DEVIL!"',theme:"weird",options:[{text:"Argue",outcome:E("You waste 10 minutes arguing. He smells.",{rep:-1})},{text:"Agree",outcome:T("He gives you a pamphlet.",{xp:5})},{text:"Walk away",outcome:E("Crazy people.")}]},{id:"corpo_lunch",title:"DROPPED LUNCH",description:"A corpo dropped their fancy sushi lunch.",theme:"funny",options:[{text:"Eat it",outcome:T("Real fish! Tasty.",{health:10})},{text:"Return it",outcome:T("Corpo looks disgusted but tips you.",{eddies:20})},{text:"Step on it",outcome:T("Take that, Arasaka.",{rep:1})}]},{id:"atm_glitch",title:"ATM GLITCH",description:"An ATM is spitting out bills!",theme:"cyberpunk",options:[{text:"Grab cash",outcome:T("You grab what you can before it stops.",{eddies:300})},{text:"Walk away",outcome:E("Not getting flagged by security.")}]},{id:"rogue_roomba",title:"KILLER VACUUM",description:"A cleaning bot has taped a knife to itself.",theme:"funny",options:[{text:"Kick it",outcome:T("It flips over, wheels spinning helplessly.",{xp:10})},{text:"Run",outcome:E("It chases you slowly.")}]},{id:"fashion_police",title:"FASHION POLICE",description:'A stylist critiques your outfit. "So last season."',theme:"funny",options:[{text:"Insult back (Cool 4+)",skillCheck:{stat:"cool",difficulty:4},outcome:e=>e?{message:"You roast their shoes. They cry.",rewards:{rep:5}}:{message:"You stutter. Weak.",penalties:{rep:-2}}},{text:"Ignore",outcome:E("Haters gonna hate.")}]},{id:"wet_floor",title:"WET FLOOR",description:"There is no sign. Just a puddle.",theme:"funny",options:[{text:"Walk carefully",outcome:E("Safe.")},{text:"Run",outcome:w("You slip.",{health:2})}]},{id:"mystery_button",title:"MYSTERY BUTTON",description:'A button on a wall says "DO NOT PRESS".',theme:"weird",options:[{text:"Press it",outcome:e=>Math.random()>.5?{message:"Confetti explodes!",rewards:{xp:5}}:{message:"You get shocked.",penalties:{health:5}}},{text:"Don't press",outcome:E("Boring.")}]},{id:"lost_drone",title:"LOST DRONE",description:"A small drone is hovering, looking lost.",theme:"cyberpunk",options:[{text:"Check logs (Tech 3+)",skillCheck:{stat:"tech",difficulty:3},outcome:e=>e?{message:"You send it home. Owner wires credits.",rewards:{eddies:50}}:{message:"Encrypted."}},{text:"Smash it",outcome:T("Scrap parts.",{eddies:20})},{text:"Ignore",outcome:E("It beeps sadly.")}]},{id:"street_fight",title:"FIGHT CLUB",description:'An illegal street fight circle. "Care to join?"',theme:"intense",options:[{text:"Fight (Reflex 6+)",skillCheck:{stat:"reflex",difficulty:6},outcome:e=>e?{message:"You win!",rewards:{eddies:200,rep:10}}:{message:"You get knocked out.",penalties:{health:30}}},{text:"Bet 50€",cost:50,outcome:e=>Math.random()>.5?{message:"Your fighter won!",rewards:{eddies:100}}:{message:"Your fighter lost."}},{text:"Watch",outcome:E("Entertaining.")}]},{id:"corpo_drunk",title:"DRUNK SALARYMAN",description:"A drunk corpo is vomiting in the gutter.",theme:"corpo",options:[{text:"Rob him",outcome:T("Easy pickings.",{eddies:150,rep:-5})},{text:"Help him",outcome:T("He gives you his watch.",{eddies:50,rep:5})},{text:"Ignore",outcome:E("Pathetic.")}]},{id:"holo_ad_glitch",title:"SEIZURE AD",description:"A holographic ad is flashing rapidly.",theme:"cyberpunk",options:[{text:"Look away",outcome:E("Saved your eyes.")},{text:"Stare",outcome:w("Headache.",{health:2})}]},{id:"rat_race",title:"RAT RACE",description:"People are betting on racing rats.",theme:"funny",options:[{text:'Bet on "Speedy" (10€)',cost:10,outcome:e=>Math.random()>.5?{message:"Speedy wins!",rewards:{eddies:30}}:{message:"Speedy was eaten."}},{text:"Walk away",outcome:E("Gross.")}]},{id:"abandoned_bike",title:"ABANDONED BIKE",description:"A nice bike, unlocked.",theme:"gang",options:[{text:"Steal it",outcome:T("You strip it for parts.",{eddies:300,rep:-2})},{text:"Leave it",outcome:E("Probably bait.")}]},{id:"ncpd_scan",title:"RANDOM SCAN",description:'NCPD drone scans you. "Citizen, halt."',theme:"intense",options:[{text:"Halt",outcome:E("Scan complete. You are clean.")},{text:"Run",outcome:w("They fine you.",{eddies:50})}]},{id:"vendit_hack",title:"VENDIT HACK",description:"A vending machine is unlocked.",theme:"tech",options:[{text:"Hack (Tech 2+)",skillCheck:{stat:"tech",difficulty:2},outcome:e=>e?{message:"Free drinks!",rewards:{eddies:20,health:5}}:{message:"Alarm triggers.",penalties:{rep:-2}}},{text:"Ignore",outcome:E("Not thirsty.")}]},{id:"street_doc",title:"STREET DOC",description:"A shady doctor offers cheap stims.",theme:"gang",options:[{text:"Buy Stims (50€)",cost:50,outcome:T("You feel great!",{health:50})},{text:"Decline",outcome:E("Sketchy.")}]},{id:"religous_cult",title:"TECHNO NECROMANCERS",description:"Cultists from Alpha Centauri want a donation.",theme:"weird",options:[{text:"Donate 5€",cost:5,outcome:T("They chant your name.",{xp:5})},{text:"Mock them",outcome:E("They curse your hard drive.")}]},{id:"sewer_gator",title:"SEWER RUMBLE",description:"Something big is moving under the manhole.",theme:"weird",options:[{text:"Open it",outcome:w("A mutant gator bites you!",{health:20})},{text:"Walk away",outcome:E("Nope.")}]},{id:"free_stuff",title:"FREE BOX",description:'A box says "FREE".',theme:"funny",options:[{text:"Look inside",outcome:T("It's just old cables.",{xp:2})},{text:"Ignore",outcome:E("Junk.")}]},{id:"broken_bot",title:"SAD ROBOT",description:"A robot is crying oil tears.",theme:"funny",options:[{text:"Comfort it",outcome:T("It beeps happily.",{rep:2})},{text:"Kick it",outcome:w("It shocks you.",{health:5})}]},{id:"laser_tag",title:"LASER POINTER",description:"Someone is pointing a laser at you.",theme:"funny",options:[{text:"Duck",outcome:E("Just kids playing.")},{text:"Yell",outcome:E("They run away laughing.")}]},{id:"lost_shoe",title:"SINGLE SHOE",description:"A single high-end sneaker lies on the road.",theme:"weird",options:[{text:"Take it",outcome:T("Maybe you find the other one?",{eddies:10})},{text:"Leave it",outcome:E("Useless.")}]}];const C=new class{spawnTimer=null;checkTimer=null;MIN_SPAWN_TIME=6e4;MAX_SPAWN_TIME=9e4;ENCOUNTER_DURATION_MIN=12e4;ENCOUNTER_DURATION_MAX=24e4;MAX_ENCOUNTERS=3;constructor(){this.startSpawning(2e4),this.startExpirationCheck()}startSpawning(e){const t=e??Math.floor(Math.random()*(this.MAX_SPAWN_TIME-this.MIN_SPAWN_TIME+1))+this.MIN_SPAWN_TIME;this.spawnTimer=window.setTimeout(()=>{this.spawnEncounter(),this.startSpawning()},t)}startExpirationCheck(){this.checkTimer=window.setInterval(()=>{const e=o.get(),t=Date.now();e.activeEncounters.forEach(e=>{t>e.expiresAt&&p(e.id)})},1e3)}spawnEncounter(){if(o.get().activeEncounters.length>=this.MAX_ENCOUNTERS)return;const e=M[Math.floor(Math.random()*M.length)],t=[{x:65,y:40,width:15,height:15},{x:25,y:45,width:18,height:18},{x:80,y:60,width:15,height:15}];let s=0,n=0,i=0;do{s=Math.floor(80*Math.random())+10,n=Math.floor(70*Math.random())+10;if(!t.some(e=>{const t=e.width/2,i=e.height/2;return s>=e.x-t&&s<=e.x+t&&n>=e.y-i&&n<=e.y+i}))break;i++}while(i<50);if(i>=50)return;const a=Math.floor(Math.random()*(this.ENCOUNTER_DURATION_MAX-this.ENCOUNTER_DURATION_MIN+1))+this.ENCOUNTER_DURATION_MIN;((e,t,s,n)=>{const i=o.get(),a=Date.now().toString()+Math.random().toString().slice(2,6),r={id:a,encounterId:e,x:t,y:s,expiresAt:Date.now()+n};o.setKey("activeEncounters",[...i.activeEncounters,r])})(e.id,s,n,a)}resolveEncounter(e,t){const s=M.find(t=>t.id===e);if(!s)return{message:"Error: Encounter not found",success:!1,effects:{}};const n=s.options[t],i=o.get(),a=i.members,c={};if(n.cost&&i.eddies<n.cost)return{message:"Not enough eddies!",success:!1,effects:{}};let d=!0;if(n.skillCheck){const e="tech"===n.skillCheck.stat?"cool":n.skillCheck.stat,t=Math.max(...a.map(t=>t.stats[e]||0));d=Math.floor(10*Math.random())+1+t>=n.skillCheck.difficulty}const u=n.outcome(d,a);if(n.cost&&(c.cost=n.cost,r(-n.cost)),u.rewards&&(c.rewards={},u.rewards.eddies&&(c.rewards.eddies=u.rewards.eddies,r(u.rewards.eddies)),u.rewards.rep&&(c.rewards.rep=u.rewards.rep,l(u.rewards.rep)),u.rewards.xp&&(c.rewards.xp=u.rewards.xp),u.rewards.health)){const e=a.filter(e=>e.health<e.maxHealth);if(e.length>0){c.rewards.health=u.rewards.health;const t=e[Math.floor(Math.random()*e.length)];m(t.id,-u.rewards.health)}}if(u.penalties&&(c.penalties={},u.penalties.eddies&&(c.penalties.eddies=u.penalties.eddies,r(-u.penalties.eddies)),u.penalties.rep&&(c.penalties.rep=u.penalties.rep,l(u.penalties.rep)),u.penalties.health)){const e=a.filter(e=>!e.injured&&e.health>0);if(e.length>0){c.penalties.health=u.penalties.health;const t=e[Math.floor(Math.random()*e.length)];m(t.id,u.penalties.health)}}return{message:u.message,success:d,effects:c}}stop(){null!==this.spawnTimer&&(window.clearTimeout(this.spawnTimer),this.spawnTimer=null),null!==this.checkTimer&&(window.clearInterval(this.checkTimer),this.checkTimer=null)}};class k{container;hudContainer;modalContainer;activeTab="missions";lastActiveMissions=[];lastAvailableMissions=[];flavorTexts=["WARNING: RELIC MALFUNCTION DETECTED","DON'T FORGET TO FEED YOUR CAT","HANAKO IS STILL WAITING AT EMBERS","NCPD WARRANT ISSUED: JAYWALKING","TRAUMA TEAM MEMBERSHIP EXPIRED","WAKE THE F*** UP, SAMURAI","KIROSHI OPTICS FIRMWARE UPDATE AVAILABLE","WEATHER UPDATE: ACID RAIN EXPECTED IN PACIFICA","MAXTAC DEPLOYED TO CITY CENTER","REMEMBER: STYLE OVER SUBSTANCE","NETWATCH IS WATCHING YOU","DELAMAIN: EXCUSE ME, BEEP BEEP"];constructor(){this.container=document.getElementById("ui-layer"),this.hudContainer=document.createElement("div"),this.modalContainer=document.createElement("div"),this.modalContainer.className="pointer-events-none",this.container.appendChild(this.hudContainer),this.container.appendChild(this.modalContainer),this.setupHUD(),this.setupListeners(),this.setupStoreSubscription(),this.startFlavorTextRotation()}setupHUD(){this.hudContainer.className="absolute top-0 left-0 w-full pointer-events-none flex flex-col z-50",this.hudContainer.innerHTML='\n      <header class="flex justify-between items-center border-b-2 border-cp-yellow pb-2 mb-0 bg-cp-black/70 -skew-x-[10deg] border-l-[10px] border-l-cp-cyan pointer-events-auto px-4 py-2">\n        <div class="text-2xl font-black text-cp-cyan ml-5 skew-x-[10deg] drop-shadow-[2px_2px_var(--cp-red)] font-cyber">\n          NEON REIGN\n        </div>\n        <div id="resources" class="flex gap-10 mr-5 skew-x-[10deg]">\n          <div class="text-xl font-bold text-cp-yellow uppercase flex items-center font-cyber">\n            EDDIES: <span id="hud-eddies" class="text-white ml-2">0</span>\n          </div>\n          <div class="text-xl font-bold text-cp-yellow uppercase flex items-center font-cyber">\n            REP: <span id="hud-rep" class="text-white ml-2">0</span>\n          </div>\n          <div class="text-xl font-bold text-cp-yellow uppercase flex items-center font-cyber">\n            MEMBERS: <span id="hud-members" class="text-white ml-2">0</span>\n          </div>\n          <button id="settings-btn" class="cyber-btn text-xs ml-2" title="Settings">⚙</button>\n          <button id="tutorial-btn" class="cyber-btn text-xs" title="Show Tutorial">?</button>\n        </div>\n      </header>\n    ',setTimeout(()=>{document.getElementById("tutorial-btn")?.addEventListener("click",()=>{v.playClick(),window.showTutorial?.()}),document.getElementById("settings-btn")?.addEventListener("click",()=>{v.playClick(),this.openSettingsPanel()})},100)}openSettingsPanel(){const e=document.getElementById("settings-overlay");if(!e)return;e.classList.remove("tutorial-hidden"),v.playPanelOpen();const t=document.getElementById("music-volume"),s=document.getElementById("sfx-volume"),n=document.getElementById("music-toggle"),i=document.getElementById("sfx-toggle"),a=document.getElementById("music-volume-value"),o=document.getElementById("sfx-volume-value");if(t&&(t.value=v.getMusicVolume().toString(),a&&(a.textContent=`${v.getMusicVolume()}%`)),s&&(s.value=v.getSfxVolume().toString(),o&&(o.textContent=`${v.getSfxVolume()}%`)),n&&(n.checked=v.isMusicEnabled()),i&&(i.checked=v.isSfxEnabled()),!e._listenersAdded){e._listenersAdded=!0,document.getElementById("settings-close-btn")?.addEventListener("click",()=>{v.playPanelClose(),e.classList.add("tutorial-hidden")}),t?.addEventListener("input",e=>{const t=parseInt(e.target.value);v.setMusicVolume(t),a&&(a.textContent=`${t}%`),this.saveSettings()}),s?.addEventListener("input",e=>{const t=parseInt(e.target.value);v.setSfxVolume(t),o&&(o.textContent=`${t}%`),v.playClick(),this.saveSettings()}),n?.addEventListener("change",e=>{const t=e.target.checked;v.setMusicEnabled(t),v.playClick(),this.saveSettings()}),i?.addEventListener("change",e=>{const t=e.target.checked;v.setSfxEnabled(t),t&&v.playClick(),this.saveSettings()});const r=document.getElementById("reset-progress-btn");let l=null,c=!1;r?.addEventListener("click",()=>{c?(l&&clearTimeout(l),confirm("This will permanently delete all your progress. Are you absolutely sure?")&&(v.playError(),this.resetGame(),e.classList.add("tutorial-hidden"),this.showToast("GAME RESET COMPLETE","success")),c=!1,r.textContent="RESET PROGRESS",r.classList.remove("bg-cp-red/60","animate-pulse")):(c=!0,r.textContent="ARE YOU SURE?",r.classList.add("bg-cp-red/60","animate-pulse"),v.playError(),l=window.setTimeout(()=>{c=!1,r.textContent="RESET PROGRESS",r.classList.remove("bg-cp-red/60","animate-pulse")},3e3))})}}saveSettings(){const{saveManager:e}=require("@/managers/SaveManager");e.saveSettings({musicVolume:v.getMusicVolume(),sfxVolume:v.getSfxVolume(),musicEnabled:v.isMusicEnabled(),sfxEnabled:v.isSfxEnabled()})}resetGame(){const{saveManager:e}=require("@/managers/SaveManager");e.clearSaveData(),window.location.reload()}startFlavorTextRotation(){const e=document.getElementById("flavor-text");if(!e)return;const t=()=>{e.style.opacity="0",setTimeout(()=>{const t=this.flavorTexts[Math.floor(Math.random()*this.flavorTexts.length)];e.textContent=t,e.classList.add("glitch-text"),e.style.opacity="1",setTimeout(()=>{e.classList.remove("glitch-text")},500)},500)};t(),setInterval(t,8e3)}setupListeners(){window.addEventListener("building-click",e=>{const t=e.detail.type;"hideout"===t?this.openMissionBoard():"bar"===t?this.openAfterlife():"ripperdoc"===t&&this.openRipperdoc()}),window.addEventListener("mission-complete",e=>{const t=e.detail;this.showMissionReward(t)});const e=()=>{v.startBackgroundMusic(),document.removeEventListener("click",e)};document.addEventListener("click",e)}setupStoreSubscription(){o.subscribe(e=>{const t=document.getElementById("hud-eddies"),s=document.getElementById("hud-rep"),n=document.getElementById("hud-members");t&&(t.textContent=e.eddies.toLocaleString(),t.parentElement?.classList.remove("animate-pulse-cyber"),t.offsetWidth,t.parentElement?.classList.add("animate-pulse-cyber")),s&&(s.textContent=e.rep.toLocaleString()),n&&(n.textContent=e.members.length.toString());const i=document.getElementById("tab-content");i&&"missions"===this.activeTab&&(e.activeMissions===this.lastActiveMissions&&e.availableMissions===this.lastAvailableMissions||(this.lastActiveMissions=e.activeMissions,this.lastAvailableMissions=e.availableMissions,this.renderMissionsTab(i))),this.renderEncounters(e.activeEncounters)})}renderEncounters(e){document.querySelectorAll(".encounter-marker").forEach(t=>{e.find(e=>e.id===t.dataset.id)||t.remove()}),e.forEach(e=>{if(!document.querySelector(`.encounter-marker[data-id="${e.id}"]`)){v.playAlert();const t=document.createElement("div");t.className="encounter-marker absolute w-16 h-16 flex items-center justify-center cursor-pointer z-[60] pointer-events-auto group",t.style.left=`${e.x}%`,t.style.top=`${e.y}%`,t.dataset.id=e.id,t.innerHTML='\n                <div class="absolute inset-0 bg-cp-yellow/30 rounded-full animate-ping"></div>\n                <div class="absolute inset-0 bg-cp-red/20 rotate-45 border-2 border-cp-yellow shadow-[0_0_15px_var(--cp-yellow)] transition-transform group-hover:scale-110 bg-black/80"></div>\n                <div class="relative text-cp-yellow text-4xl font-bold drop-shadow-[0_0_5px_var(--cp-red)] animate-bounce">!</div>\n                <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-black/90 border border-cp-yellow text-cp-yellow text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-cyber tracking-wider">\n                    SIGNAL DETECTED\n                </div>\n            ',t.addEventListener("click",t=>{t.stopPropagation(),v.playClick(),this.openEncounterModal(e.id,e.encounterId)}),this.container.appendChild(t)}})}openEncounterModal(e,t){const s=M.find(e=>e.id===t);if(!s)return;const n=this.createOverlay(),i=document.createElement("div");i.className="bg-cp-bg border-[3px] border-cp-red shadow-[0_0_40px_rgba(255,0,0,0.5)] w-[90%] max-w-[600px] flex flex-col animate-modalSlideIn pointer-events-auto relative",i.innerHTML=`\n        <div class="bg-cp-red/20 border-b-2 border-cp-red p-5 flex justify-between items-center shrink-0">\n            <h2 class="text-cp-red m-0 text-2xl drop-shadow-[0_0_10px_var(--cp-red)] font-cyber font-bold uppercase">${s.title}</h2>\n            <button id="close-encounter" class="bg-transparent border-2 border-cp-red text-cp-red text-2xl w-8 h-8 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n        </div>\n        \n        <div class="p-6">\n            <p class="text-white text-lg mb-6 font-cyber leading-relaxed border-l-4 border-cp-yellow pl-4 bg-black/30 p-4">\n                "${s.description}"\n            </p>\n\n            <div class="space-y-3">\n                ${s.options.map((e,t)=>`\n                    <button class="encounter-opt-btn w-full text-left p-4 border-2 border-gray-600 hover:border-cp-yellow hover:bg-cp-yellow/10 transition-all group relative overflow-hidden" data-index="${t}">\n                        <div class="font-bold text-cp-yellow text-lg group-hover:translate-x-2 transition-transform">${e.text}</div>\n                        ${e.cost?`<div class="text-xs text-red-400 mt-1">COST: ${e.cost}€</div>`:""}\n                        ${e.skillCheck?`<div class="text-xs text-cp-cyan mt-1">CHECK: ${e.skillCheck.stat.toUpperCase()} ${e.skillCheck.difficulty}+</div>`:""}\n                    </button>\n                `).join("")}\n            </div>\n        </div>\n      `,n.appendChild(i),this.modalContainer.appendChild(n),i.querySelector("#close-encounter")?.addEventListener("click",()=>n.remove()),i.querySelectorAll(".encounter-opt-btn").forEach(s=>{s.addEventListener("click",s=>{const i=parseInt(s.currentTarget.dataset.index),a=C.resolveEncounter(t,i);p(e),n.remove(),this.showEncounterResult(a.message,a.success,a.effects)})})}showEncounterResult(e,t,s){const n=this.createOverlay(),i=document.createElement("div"),a=t?"cp-cyan":"cp-red";i.className=`bg-cp-bg border-[3px] border-${a} shadow-[0_0_40px_rgba(${t?"0,240,255":"255,0,0"},0.5)] w-[90%] max-w-[600px] flex flex-col animate-modalSlideIn pointer-events-auto`;let o="";if(s){const e=[];s.cost&&e.push(`<div class="flex items-center gap-2 text-cp-red"><span class="text-2xl">💸</span> <span>-${s.cost}€ COST</span></div>`),s.rewards&&(s.rewards.eddies&&e.push(`<div class="flex items-center gap-2 text-cp-yellow"><span class="text-2xl">💰</span> <span>+${s.rewards.eddies}€ EDDIES</span></div>`),s.rewards.xp&&e.push(`<div class="flex items-center gap-2 text-cp-cyan"><span class="text-2xl">⭐</span> <span>+${s.rewards.xp} XP</span></div>`),s.rewards.rep&&e.push(`<div class="flex items-center gap-2 text-green-400"><span class="text-2xl">🏆</span> <span>+${s.rewards.rep} REP</span></div>`),s.rewards.health&&e.push(`<div class="flex items-center gap-2 text-green-500"><span class="text-2xl">❤️</span> <span>+${s.rewards.health} HP</span></div>`)),s.penalties&&(s.penalties.eddies&&e.push(`<div class="flex items-center gap-2 text-orange-500"><span class="text-2xl">💸</span> <span>-${s.penalties.eddies}€ LOST</span></div>`),s.penalties.rep&&e.push(`<div class="flex items-center gap-2 text-orange-500"><span class="text-2xl">📉</span> <span>${s.penalties.rep} REP</span></div>`),s.penalties.health&&e.push(`<div class="flex items-center gap-2 text-cp-red"><span class="text-2xl">💔</span> <span>-${s.penalties.health} HP DAMAGE</span></div>`)),e.length>0&&(o=`\n          <div class="bg-black/40 border-t-2 border-${a}/30 p-4 mt-4">\n            <h3 class="text-cp-yellow font-bold font-cyber text-sm mb-3 uppercase tracking-wider">Effects Applied:</h3>\n            <div class="space-y-2 text-base font-cyber">\n              ${e.join("")}\n            </div>\n          </div>\n        `)}i.innerHTML=`\n        <div class="bg-${a}/10 border-b-2 border-${a} p-5">\n          <h2 class="text-${a} text-3xl font-bold font-cyber text-center drop-shadow-[0_0_10px_var(--${a})]">\n            ${t?"✓ SUCCESS":"✗ FAILURE"}\n          </h2>\n        </div>\n        <div class="p-6">\n          <p class="text-white text-lg mb-4 font-cyber leading-relaxed border-l-4 border-${a} pl-4 bg-black/30 p-4">"${e}"</p>\n          ${o}\n        </div>\n        <div class="border-t-2 border-${a} p-5">\n          <button id="close-result" class="cyber-btn w-full py-3 text-xl">CLOSE</button>\n        </div>\n      `,n.appendChild(i),this.modalContainer.appendChild(n),i.querySelector("#close-result")?.addEventListener("click",()=>{v.playClick(),n.remove()})}createOverlay(){const e=document.createElement("div");e.className="fixed inset-0 bg-black/95 flex justify-center items-center z-[10001] animate-[fadeIn_0.3s] pointer-events-auto";const t=e=>e.stopPropagation();return e.addEventListener("pointerdown",t),e.addEventListener("mousedown",t),e.addEventListener("touchstart",t),e.addEventListener("click",t),e}openMissionBoard(){this.modalContainer.innerHTML="";const e=this.createOverlay();e.addEventListener("click",t=>{t.target===e&&e.remove()});const t=document.createElement("div");t.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[1000px] h-[85vh] flex flex-col animate-modalSlideIn pointer-events-auto",t.innerHTML='\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">GANG HQ</h2>\n        <button id="close-modal" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n      \n      \x3c!-- Tabs --\x3e\n      <div class="flex gap-2 p-4 bg-black/30 border-b border-cp-yellow/30">\n        <button class="cyber-btn tab-btn active" data-tab="missions">MISSIONS</button>\n        <button class="cyber-btn tab-btn" data-tab="roster">ROSTER</button>\n        <button class="cyber-btn tab-btn" data-tab="territory">TERRITORY</button>\n        <button class="cyber-btn tab-btn" data-tab="gangs">GANGS</button>\n      </div>\n\n      \x3c!-- Tab Content --\x3e\n      <div class="flex-1 overflow-y-auto p-5" id="tab-content"></div>\n    ',e.appendChild(t),this.modalContainer.appendChild(e);const s=t.querySelector("#tab-content");this.activeTab="missions",t.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{t.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"),this.activeTab=e.dataset.tab,v.playClick(),this.renderTabContent(s,this.activeTab)})}),t.querySelector("#close-modal")?.addEventListener("click",()=>e.remove()),this.renderTabContent(s,this.activeTab)}renderTabContent(e,t){e.innerHTML="","missions"===t?this.renderMissionsTab(e):"roster"===t?this.renderRosterTab(e):"territory"===t?this.renderTerritoryTab(e):"gangs"===t&&this.renderGangsTab(e)}renderMissionsTab(e){const t=o.get();if(e.innerHTML="",t.activeMissions.length>0){const s=document.createElement("h3");s.className="text-cp-cyan font-cyber text-xl mb-3 mt-2",s.textContent="ACTIVE MISSIONS",e.appendChild(s),t.activeMissions.forEach(s=>{const n=t.members.filter(e=>s.memberIds.includes(e.id));if(0===n.length)return;const i=s.mission,a=s.startTime,o=i.duration,r=document.createElement("div");r.className="bg-black/60 border-2 border-cp-cyan p-4 mb-3 animate-pulse";const l=n.length>1?`TEAM (${n.length})`:n[0].name;r.innerHTML=`\n          <div class="flex justify-between items-start mb-2">\n            <div>\n              <div class="font-bold text-white font-cyber text-lg">${i.name}</div>\n              <div class="text-cp-cyan text-sm font-cyber">[${i.type}]</div>\n            </div>\n            <div class="text-right">\n              <div class="text-cp-yellow font-bold font-cyber">${l}</div>\n              <div class="text-gray-400 text-xs truncate max-w-[150px]">\n                ${n.map(e=>`<span class="text-[10px] bg-cp-cyan/20 px-1 mr-1">${e.class.substring(0,3)}</span>${e.name}`).join(", ")}\n              </div>\n            </div>\n          </div>\n          \n          <div class="w-full h-4 bg-gray-800 border border-cp-cyan mt-2 relative overflow-hidden">\n            <div class="h-full bg-cp-cyan transition-all duration-1000 ease-linear mission-progress" style="width: 0%" id="progress-${s.id}"></div>\n          </div>\n          <div class="text-right text-cp-cyan font-mono text-sm mt-1 mission-timer" id="timer-${s.id}">CALCULATING...</div>\n        `,e.appendChild(r);const c=()=>{if(!document.body.contains(r))return;const e=Date.now()-a,t=Math.max(0,o-e),s=Math.min(100,e/o*100),n=r.querySelector(".mission-progress"),i=r.querySelector(".mission-timer");n&&(n.style.width=`${s}%`),i&&(i.textContent=`${(t/1e3).toFixed(1)}s remaining`),t>0?requestAnimationFrame(c):(i&&(i.textContent="COMPLETED"),r.classList.remove("animate-pulse"),r.classList.add("border-green-500"))};requestAnimationFrame(c)});const n=document.createElement("hr");n.className="border-gray-700 my-6",e.appendChild(n)}const s=document.createElement("div");s.className="flex justify-between items-center mb-4",s.innerHTML='<h3 class="text-cp-yellow font-cyber text-xl">AVAILABLE MISSIONS</h3>';const n=document.createElement("button");n.className="cyber-btn small-btn text-xs px-3 py-1",n.textContent="REFRESH (50€)",n.addEventListener("click",()=>{v.playClick(),o.get().eddies>=50&&(r(-50),u(),1)?(this.showToast("MISSIONS REFRESHED","success"),this.renderMissionsTab(e)):this.showToast("INSUFFICIENT FUNDS","error")}),s.appendChild(n),e.appendChild(s),0!==t.availableMissions.length?t.availableMissions.forEach(t=>{const s=document.createElement("div");s.className="bg-black/60 border-2 border-cp-yellow p-4 mb-3 cursor-pointer transition-all duration-300 hover:border-cp-cyan hover:translate-x-2 hover:shadow-[0_0_25px_rgba(0,240,255,0.4)] hover:bg-cp-cyan/5 animate-slideIn opacity-0 fill-mode-forwards";const n={EASY:"text-green-400",MEDIUM:"text-yellow-400",HARD:"text-orange-400",EXTREME:"text-cp-red"}[t.difficulty];s.innerHTML=`\n        <div class="flex justify-between items-start mb-2">\n          <h3 class="font-bold text-white font-cyber text-lg">${t.name}</h3>\n          <span class="text-xs font-bold ${n} border border-current px-2 py-1">${t.difficulty}</span>\n        </div>\n        <div class="text-cp-yellow text-sm mb-2 font-cyber">${t.type}</div>\n        <p class="text-gray-400 text-xs mb-3 h-10 overflow-hidden font-cyber">${t.description}</p>\n        <div class="flex gap-5 text-sm text-gray-400 font-cyber">\n          <span class="group-hover:text-cp-cyan transition-colors">💰 ${t.eddiesMin}-${t.eddiesMax}€</span>\n          <span class="group-hover:text-cp-cyan transition-colors">⭐ ${t.xpMin}-${t.xpMax} XP</span>\n          <span class="group-hover:text-cp-cyan transition-colors">⏱ ${t.duration/1e3}s</span>\n        </div>\n      `,s.addEventListener("click",()=>{v.playPanelOpen(),this.openMissionDetail(t)}),e.appendChild(s)}):e.innerHTML+='<div class="text-center text-gray-500 font-cyber py-8 text-xl">NO MISSIONS AVAILABLE</div>'}openMissionDetail(e){const t=this.createOverlay();t.addEventListener("click",e=>{e.target===t&&t.remove()});const s=document.createElement("div");s.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[1000px] h-[90vh] flex flex-col animate-modalSlideIn pointer-events-auto",s.innerHTML=`\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">${e.name}</h2>\n        <button id="close-detail" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n      \n      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 p-5 overflow-y-auto flex-1">\n        \x3c!-- Left Column: Details & Stats --\x3e\n        \x3c!-- Left Column: Details & Stats --\x3e\n        <div class="border-r border-cp-cyan pr-5 flex flex-col gap-2 overflow-hidden">\n          <div class="shrink-0">\n            <div class="flex justify-between items-center mb-1">\n              <span class="inline-block px-3 py-1 text-lg font-bold rounded bg-cp-black border border-cp-yellow text-cp-yellow">\n                ${e.difficulty}\n              </span>\n              <div class="text-cp-yellow text-base font-cyber">${e.type}</div>\n            </div>\n            \n            <div class="text-white text-sm leading-snug mb-2 p-2 bg-black/30 border-l-[3px] border-cp-yellow italic font-cyber">\n              "${e.description}"\n            </div>\n          </div>\n\n          \x3c!-- Mission Stats Grid --\x3e\n          <div class="grid grid-cols-2 gap-2 shrink-0">\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">REWARD</div>\n              <div class="text-white text-base font-cyber">${e.eddiesMin}-${e.eddiesMax}€</div>\n            </div>\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">XP</div>\n              <div class="text-white text-base font-cyber">${e.xpMin}-${e.xpMax}</div>\n            </div>\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">TIME</div>\n              <div class="text-white text-base font-cyber">${e.duration/1e3}s</div>\n            </div>\n            <div class="bg-cp-cyan/5 border border-cp-cyan/30 p-2 flex justify-between items-center">\n              <div class="text-cp-cyan text-xs font-bold">RISK</div>\n              <div class="text-white text-base font-cyber">${Math.round(100*e.injuryChance)}%</div>\n            </div>\n          </div>\n\n          \x3c!-- Team Stats & Probability --\x3e\n          <div class="bg-black/40 border border-cp-yellow p-3 mt-1 shrink-0">\n            <div class="flex justify-between items-center border-b border-cp-yellow/30 pb-1 mb-2">\n              <h4 class="text-cp-yellow font-bold font-cyber text-sm">PROJECTIONS</h4>\n              <div class="text-xs text-gray-400 font-cyber">\n                LVL ${e.minLevel}+ \n                ${e.minCool?`• COOL ${e.minCool}+`:""}\n                ${e.minReflex?`• REF ${e.minReflex}+`:""}\n              </div>\n            </div>\n            \n            <div class="flex justify-between mb-1 text-xs">\n              <span class="text-gray-400">TEAM POWER:</span>\n              <span class="text-white font-bold" id="team-power">0</span>\n            </div>\n            <div class="flex justify-between mb-1 text-xs">\n              <span class="text-gray-400">WIN CHANCE:</span>\n              <span class="text-cp-cyan font-bold" id="win-chance">0%</span>\n            </div>\n            <div class="w-full h-1.5 bg-gray-800 mb-2">\n              <div id="win-bar" class="h-full bg-cp-cyan transition-all duration-300" style="width: 0%"></div>\n            </div>\n\n            <div class="flex justify-between text-xs">\n              <span class="text-gray-400">INJURY RISK:</span>\n              <span class="text-cp-red font-bold" id="injury-risk">--</span>\n            </div>\n            \n            <div id="active-passives" class="mt-2 border-t border-gray-700 pt-1"></div>\n          </div>\n        </div>\n\n        \x3c!-- Right Column: Crew Selection --\x3e\n        <div class="flex flex-col h-full">\n          <div class="flex justify-between items-center mb-4">\n            <h3 class="text-cp-yellow m-0 font-cyber text-xl font-bold">SELECT CREW</h3>\n            <span class="text-xs text-gray-400">MAX 3 MEMBERS</span>\n          </div>\n          \n          <div id="crew-list" class="flex-1 overflow-y-auto max-h-[400px] space-y-3 pr-2">\n            \x3c!-- Crew members go here --\x3e\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Biker Animation Section --\x3e\n      <div class="w-full h-[100px] bg-black/30 border-t-2 border-cp-yellow relative overflow-hidden shrink-0">\n         <div id="biker-anim" class="absolute left-[-150px] bottom-[10px] w-[150px] h-[80px]">\n           <img src="assets/biker.png" class="w-full h-full object-contain drop-shadow-[0_0_5px_var(--cp-cyan)]" />\n         </div>\n      </div>\n\n      <div class="border-t-2 border-cp-cyan p-5 flex justify-between items-center bg-black/30 shrink-0">\n        <div class="text-cp-yellow text-xl font-bold font-cyber">\n          SELECTED: <span id="selected-count">0</span>/3\n        </div>\n        <button id="send-crew-btn" class="cyber-btn px-10 py-4 text-xl disabled:opacity-50 disabled:cursor-not-allowed">\n          SEND CREW\n        </button>\n      </div>\n    `,t.appendChild(s),this.modalContainer.appendChild(t);let n=[];const i=s.querySelector("#send-crew-btn"),r=s.querySelector("#selected-count"),l=s.querySelector("#biker-anim"),d=s.querySelector("#team-power"),u=s.querySelector("#win-chance"),h=s.querySelector("#win-bar"),p=s.querySelector("#injury-risk");i.disabled=!0;const m=s.querySelector("#crew-list"),x=o.get().members.filter(e=>"IDLE"===e.status&&!e.injured);0===x.length?m.innerHTML='<div class="text-cp-red text-center p-10 font-cyber text-xl">NO AVAILABLE MEMBERS</div>':x.forEach(t=>{const l=document.createElement("div");l.className="flex items-center gap-4 p-3 bg-black/40 border-2 border-[#555] cursor-pointer transition-all duration-300 hover:bg-cp-cyan/10 hover:translate-x-1 hover:shadow-[0_0_15px_rgba(0,240,255,0.3)]";const c=t.level>=e.minLevel,x=!e.minCool||t.stats.cool>=e.minCool,g=!e.minReflex||t.stats.reflex>=e.minReflex,y=c&&x&&g;y?l.classList.add("border-cp-cyan"):l.classList.add("opacity-50","cursor-not-allowed","border-red-900"),l.innerHTML=`\n          <div class="flex-1">\n            <div class="flex justify-between items-center mb-1">\n              <div class="font-bold text-white font-cyber">${t.name}</div>\n              <div class="text-xs text-cp-yellow font-cyber">LVL ${t.level}</div>\n            </div>\n            <div class="flex gap-3 text-xs text-gray-400 font-mono">\n              <span>COOL: <span class="${t.stats.cool>=(e.minCool||0)?"text-cp-cyan":"text-red-500"}">${t.stats.cool}</span></span>\n              <span>REF: <span class="${t.stats.reflex>=(e.minReflex||0)?"text-cp-cyan":"text-red-500"}">${t.stats.reflex}</span></span>\n            </div>\n          </div>\n          <div class="w-6 h-6 border-2 border-cp-cyan flex items-center justify-center text-sm check-box transition-all"></div>\n        `,y&&l.addEventListener("click",()=>{v.playClick();const c=n.indexOf(t.id),m=l.querySelector(".check-box");if(c>-1)n.splice(c,1),l.classList.remove("bg-cp-cyan/20","border-cp-yellow","shadow-[0_0_20px_rgba(252,238,10,0.4)]"),m.classList.remove("bg-cp-yellow","border-cp-yellow"),m.textContent="";else{if(n.length>=3)return void this.showToast("MAX 3 MEMBERS","warning");n.push(t.id),l.classList.add("bg-cp-cyan/20","border-cp-yellow","shadow-[0_0_20px_rgba(252,238,10,0.4)]"),m.classList.add("bg-cp-yellow","border-cp-yellow"),m.textContent="✓"}r.textContent=n.length.toString(),i.disabled=0===n.length,(()=>{const t=o.get().members.filter(e=>n.includes(e.id));if(0===t.length)return d.textContent="0",u.textContent="0%",h.style.width="0%",void(p.textContent="--");const i=t.reduce((e,t)=>e+2*(t.stats.cool+t.stats.reflex)+5*t.level,0),r=e.difficultyRating||50,l=Math.min(.95,Math.max(.05,i/r)),c=.05*(t.length-1);let m=Math.max(.05,e.injuryChance-c);l>.5&&(m*=.5),d.textContent=i.toString(),u.textContent=`${Math.round(100*l)}%`,h.style.width=`${Math.round(100*l)}%`,u.className=l>.8?"text-green-500 font-bold":l>.5?"text-yellow-500 font-bold":"text-red-500 font-bold",p.textContent=`${Math.round(100*m)}%`;const x=t.map(e=>{const t=a[e.class];return`<div class="text-[10px] text-cp-cyan">• ${e.name} (${t.name}): ${t.passive}</div>`}).join(""),g=s.querySelector("#active-passives");g&&(g.innerHTML=x)})()}),m.appendChild(l)}),s.querySelector("#close-detail")?.addEventListener("click",()=>t.remove()),i.addEventListener("click",()=>{v.playClick(),n.length>0&&(l.style.animation="bikerSlide 1.5s linear forwards",i.disabled=!0,i.textContent="SENDING...",setTimeout(()=>{const t=((e,t,s=null)=>{const n=o.get(),i=n.availableMissions.find(e=>e.id===t);if(!i)return{success:!1,reason:"Mission not found"};if(0===e.length)return{success:!1,reason:"No members selected"};const a=n.members.filter(t=>e.includes(t.id));for(const o of a){if("IDLE"!==o.status)return{success:!1,reason:`${o.name} is busy`};if(o.injured)return{success:!1,reason:`${o.name} is injured`};if(o.level<i.minLevel)return{success:!1,reason:`${o.name} level too low`};if(i.minCool&&o.stats.cool<i.minCool)return{success:!1,reason:`${o.name} Cool too low`};if(i.minReflex&&o.stats.reflex<i.minReflex)return{success:!1,reason:`${o.name} Reflex too low`}}const r=n.members.map(t=>e.includes(t.id)?{...t,status:"ON MISSION",currentMission:i.name}:t);o.setKey("members",r);let l=null!==s?s:i.duration;a.some(e=>"NOMAD"===e.class)&&(l=Math.floor(.85*l));const d={id:Date.now()+Math.floor(1e3*Math.random()),memberIds:e,mission:i,startTime:Date.now(),endTime:Date.now()+l},u=[...n.activeMissions,d];return o.setKey("activeMissions",u),setTimeout(()=>{c(d.id)},l),{success:!0}})(n,e.id);t.success?(v.playPurchase(),this.showToast("MISSION STARTED","success"),i.textContent="SENT!"):(this.showToast(t.reason||"FAILED","error"),i.disabled=!1,i.textContent="SEND CREW")},1e3))})}showMissionReward(e){const{rewards:t,leveledUp:s,injured:n}=e;n?(v.playInjury(),this.showToast("MISSION FAILED - AGENT INJURED","error")):(v.playMissionComplete(),this.showToast(`MISSION COMPLETE(+${t.eddies}€)`,"success"),s&&(v.playLevelUp(),setTimeout(()=>this.showToast("LEVEL UP!","success"),500)))}showToast(e,t){const s=document.createElement("div");s.className=`fixed bottom-20 left-1/2 -translate-x-1/2 px-6 py-3 ${{success:"bg-green-500",warning:"bg-yellow-500",error:"bg-red-500"}[t]} text-black font-bold font-cyber z-[20000] animate-bounce shadow-[0_0_10px_currentColor]`,s.textContent=e,this.container.appendChild(s),setTimeout(()=>s.remove(),3e3)}async openAfterlife(){const e=this.createOverlay();e.addEventListener("click",t=>{t.target===e&&e.remove()});const t=document.createElement("div");t.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[500px] flex flex-col animate-modalSlideIn pointer-events-auto relative";const s=Object.keys(a),n=s[Math.floor(Math.random()*s.length)],{art:i,name:l,description:c}=b.generatePortrait(),d={name:l,class:n,description:c,cost:1e3,art:i};t.innerHTML=`\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">AFTERLIFE BAR</h2>\n        <button id="close-modal" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n\n      <div class="p-6 flex flex-col gap-4">\n        <div class="font-mono text-[10px] leading-none whitespace-pre text-cp-cyan bg-black/50 p-4 border border-cp-cyan/30 overflow-hidden select-none flex justify-center items-center min-h-[120px]">${d.art}</div>\n\n        <div class="border-l-4 border-cp-yellow pl-4">\n          <h3 class="text-white text-2xl font-cyber font-bold mb-1">${d.name}</h3>\n          <div class="text-cp-yellow text-sm font-cyber mb-2">CLASS: ${d.class}</div>\n          <p class="text-gray-400 text-sm italic mb-3">"${d.description}"</p>\n          <div class="text-cp-cyan text-sm font-bold font-cyber border-t border-gray-700 pt-2">\n            PASSIVE: ${a[d.class].passive}\n          </div>\n        </div>\n\n        <button id="recruit-btn" class="cyber-btn w-full py-4 text-xl mt-2 group relative overflow-hidden">\n          <span class="relative z-10">RECRUIT (${d.cost}€)</span>\n          <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>\n        </button>\n      </div>\n    `,e.appendChild(t),this.modalContainer.appendChild(e),t.querySelector("#close-modal")?.addEventListener("click",()=>e.remove()),t.querySelector("#recruit-btn")?.addEventListener("click",()=>{v.playClick();o.get().eddies>=d.cost?(r(-1e3),((e,t,s="",n)=>{const i=Object.keys(a),r=i[Math.floor(Math.random()*i.length)],l={id:Date.now(),name:e,class:n||r,description:t||"A fresh recruit ready for action.",art:s,status:"IDLE",level:1,xp:0,xpToNext:100,health:100,maxHealth:100,injured:!1,stats:{cool:Math.floor(5*Math.random())+3,reflex:Math.floor(5*Math.random())+3},currentMission:null},c=[...o.get().members,l];o.setKey("members",c)})(d.name,d.description,d.art,d.class),v.playPurchase(),this.showToast("MEMBER RECRUITED","success"),e.remove()):this.showToast("INSUFFICIENT FUNDS","error")})}openRipperdoc(){const e=this.createOverlay();e.addEventListener("click",t=>{t.target===e&&e.remove()});const t=document.createElement("div");t.className="bg-cp-bg border-[3px] border-cp-cyan shadow-[0_0_40px_rgba(0,240,255,0.5)] w-[90%] max-w-[900px] max-h-[85vh] flex flex-col animate-modalSlideIn pointer-events-auto",t.innerHTML='\n      <div class="bg-cp-cyan/10 border-b-2 border-cp-cyan p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-cyan m-0 text-3xl drop-shadow-[0_0_10px_var(--cp-cyan)] font-cyber font-bold">RIPPERDOC</h2>\n        <button id="close-ripperdoc" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n\n      <div class="flex-1 overflow-y-auto p-5">\n        <h3 class="text-cp-yellow font-cyber mb-4">MEDICAL & UPGRADES</h3>\n        <p class="text-gray-400 mb-4">Heal injured members and install cyberware</p>\n        <div id="members-list"></div>\n      </div>\n    ',e.appendChild(t),this.modalContainer.appendChild(e);const s=t.querySelector("#members-list");o.get().members.forEach(e=>{const t=document.createElement("div");t.className="bg-black/60 border-2 border-cp-cyan p-4 mb-4";const n=e.health/e.maxHealth*100,i=100*e.stats.cool,a=100*e.stats.reflex;t.innerHTML=`\n        <div class="flex justify-between items-start mb-3">\n          <div>\n            <div class="text-cp-cyan font-bold text-lg font-cyber">${e.name} <span class="text-sm text-cp-yellow">LVL ${e.level}</span></div>\n          </div>\n          <div class="text-sm font-bold ${e.injured?"text-cp-red":"text-green-500"}">${e.injured?"INJURED":"HEALTHY"}</div>\n        </div>\n\n        <div class="relative h-6 bg-gray-800 mb-2">\n          <div class="absolute inset-0 bg-green-500" style="width: ${n}%"></div>\n          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${e.health}/${e.maxHealth} HP</div>\n        </div>\n        \n        ${e.injured?`\n          <button class="cyber-btn w-full mt-2" data-heal="${e.id}">HEAL (200€)</button>\n        `:`\n          <div class="mt-3">\n            <h4 class="text-cp-yellow text-sm mb-2 font-cyber">CYBERWARE UPGRADES</h4>\n            <div class="grid grid-cols-3 gap-2">\n              <button class="cyber-btn text-xs" data-upgrade="${e.id}" data-type="cool">+2 COOL (${i}€)</button>\n              <button class="cyber-btn text-xs" data-upgrade="${e.id}" data-type="reflex">+2 REF (${a}€)</button>\n              <button class="cyber-btn text-xs" data-upgrade="${e.id}" data-type="health">+20 HP (500€)</button>\n            </div>\n          </div>\n        `}\n      `,s.appendChild(t)}),s.querySelectorAll("[data-heal]").forEach(t=>{t.addEventListener("click",()=>{v.playClick();(e=>{const t=o.get(),s=t.members.find(t=>t.id===e);if(s&&s.injured){const e=200;if(t.eddies>=e)return r(-e),s.health=s.maxHealth,s.injured=!1,s.status="IDLE",o.setKey("members",[...t.members]),!0}return!1})(parseInt(t.dataset.heal))?(v.playHeal(),this.showToast("MEMBER HEALED","success"),e.remove(),this.openRipperdoc()):this.showToast("INSUFFICIENT FUNDS","error")})}),s.querySelectorAll("[data-upgrade]").forEach(t=>{t.addEventListener("click",()=>{v.playClick();const s=parseInt(t.dataset.upgrade),n=t.dataset.type;((e,t)=>{const s=o.get(),n=s.members.find(t=>t.id===e);if(!n)return!1;let i=0,a=!1;switch(t){case"cool":i=100*n.stats.cool,s.eddies>=i&&(r(-i),n.stats.cool+=2,a=!0);break;case"reflex":i=100*n.stats.reflex,s.eddies>=i&&(r(-i),n.stats.reflex+=2,a=!0);break;case"health":i=500,s.eddies>=i&&(r(-i),n.maxHealth+=20,n.health=n.maxHealth,a=!0)}return a&&o.setKey("members",[...s.members]),a})(s,n)?(v.playUpgrade(),this.showToast(`UPGRADED: ${n.toUpperCase()}`,"success"),e.remove(),this.openRipperdoc()):this.showToast("INSUFFICIENT FUNDS","error")})}),t.querySelector("#close-ripperdoc")?.addEventListener("click",()=>e.remove())}renderRosterTab(e){const t=o.get(),s=document.createElement("div");s.className="w-full h-[120px] bg-black/30 border-2 border-cp-yellow relative overflow-hidden mb-4",s.innerHTML='\n      <div class="absolute left-[-150px] bottom-[10px] w-[150px] h-[100px]" style="animation: bikerSlide 4s linear infinite;">\n        <img src="assets/biker.png" class="w-full h-full object-contain drop-shadow-[0_0_5px_var(--color-cp-cyan)]" />\n      </div>\n    ',e.appendChild(s),0!==t.members.length?t.members.forEach(t=>{const s=document.createElement("div");s.className="bg-black/60 border-2 border-cp-cyan p-4 mb-3";const n=t.health/t.maxHealth*100,i=t.xp/t.xpToNext*100;let a="text-green-500",o="IDLE";t.injured?(a="text-cp-red",o="INJURED"):"ON MISSION"===t.status&&(a="text-cp-yellow",o="ON MISSION"),s.innerHTML=`\n        <div class="flex justify-between items-start mb-2">\n          <div>\n            <div class="text-cp-cyan font-bold text-lg font-cyber">${t.name} <span class="text-sm text-cp-yellow">LVL ${t.level}</span></div>\n            <div class="text-cp-cyan text-xs font-cyber mt-1">CLASS: ${t.class}</div>\n          </div>\n          <div class="text-sm font-bold ${a}">${o}</div>\n        </div>\n\n        <div class="relative h-6 bg-gray-800 mb-2">\n          <div class="absolute inset-0 bg-green-500" style="width: ${n}%"></div>\n          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${t.health}/${t.maxHealth} HP</div>\n        </div>\n\n        <div class="relative h-4 bg-gray-800 mb-2">\n          <div class="absolute inset-0 bg-cp-yellow" style="width: ${i}%"></div>\n          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${t.xp}/${t.xpToNext} XP</div>\n        </div>\n\n        <div class="flex gap-4 text-sm text-gray-400 font-cyber">\n          <span>COOL: ${t.stats.cool}</span>\n          <span>REF: ${t.stats.reflex}</span>\n        </div>\n      `,e.appendChild(s)}):e.innerHTML+='<div class="text-cp-red text-center p-10 font-cyber text-xl">NO GANG MEMBERS. RECRUIT SOME AT THE BAR!</div>'}renderTerritoryTab(e){const t=o.get();e.innerHTML="";const s=document.createElement("div");s.className="mb-4",s.innerHTML='<h3 class="text-cp-yellow font-cyber text-xl mb-2">NIGHT CITY DISTRICTS</h3><p class="text-gray-400">Capture territories for passive income</p>',e.appendChild(s),t.territories.forEach((t,s)=>{const n=document.createElement("div");n.className="p-4 mb-3 border-l-4 transition-all duration-300 "+(t.controlled?"bg-green-900/20 border-green-500":"bg-black/60 border-gray-600"),n.style.animationDelay=.1*s+"s",n.classList.add("animate-slideIn","opacity-0","fill-mode-forwards");const i=10*t.income,a=t.rivalGang?h.getGangByTerritory(t.id):null;if(n.innerHTML=`\n        <div class="flex justify-between items-center">\n          <div>\n            <div class="font-bold text-lg font-cyber ${t.controlled?"text-green-400":"text-white"}">${t.name}</div>\n            <div class="text-cp-yellow text-sm">+${t.income}€ / 10s</div>\n          </div>\n          <div>\n            ${t.controlled?'<span class="text-green-500 font-bold border border-green-500 px-2 py-1">✓ CONTROLLED</span>':a?`<span class="text-cp-red font-bold border border-cp-red px-2 py-1">⚔ ${a.name}</span>`:`<button class="cyber-btn small-btn text-xs" data-id="${t.id}">CAPTURE (${i}€)</button>`}\n          </div>\n        </div>\n      `,!t.controlled&&!a){const s=n.querySelector("button");s?.addEventListener("click",()=>{v.playClick(),(e=>{const t=o.get(),s=t.territories.find(t=>t.id===e);if(s&&!s.controlled&&!s.rivalGang){const e=10*s.income;if(t.eddies>=e)return r(-e),s.controlled=!0,o.setKey("territories",[...t.territories]),!0}return!1})(t.id)?(v.playPurchase(),this.showToast(`${t.name} CAPTURED!`,"success"),this.renderTerritoryTab(e)):this.showToast("INSUFFICIENT FUNDS","error")})}e.appendChild(n)})}renderGangsTab(e){const t=document.createElement("div");t.className="mb-4",t.innerHTML='<h3 class="text-cp-yellow font-cyber text-xl mb-2">RIVAL GANGS</h3><p class="text-gray-400">Attack rival territories to expand your empire</p>',e.appendChild(t);const s=h.getGangInfo(),n=o.get();if(0===s.length){const t=document.createElement("div");return t.className="text-center text-green-500 font-cyber py-10 text-xl",t.textContent="NO RIVAL GANGS REMAIN. YOU CONTROL NIGHT CITY!",void e.appendChild(t)}s.forEach((t,s)=>{const i=document.createElement("div");i.className="bg-black/60 border-2 border-cp-red p-4 mb-4",i.style.animationDelay=.1*s+"s",i.innerHTML=`\n        <div class="flex justify-between items-start mb-3">\n          <div>\n            <div class="text-cp-red font-bold text-xl font-cyber">${t.name}</div>\n            <div class="text-gray-400 text-sm font-cyber">[${t.personality.toUpperCase()}]</div>\n          </div>\n          <div class="text-sm text-gray-400">\n            <span class="mr-4">⚔ ${t.strength}</span>\n            <span>🏴 ${t.territories} territories</span>\n          </div>\n        </div>\n      `,e.appendChild(i),n.territories.forEach(s=>{const n=h.getGangByTerritory(s.id);if(n&&n.name===t.name){const i=document.createElement("div");i.className="bg-black/40 border-l-4 border-cp-red p-3 mb-2 ml-4",i.innerHTML=`\n            <div class="flex justify-between items-center">\n              <div>\n                <div class="text-cp-cyan font-bold font-cyber">${s.name}</div>\n                <div class="text-cp-yellow text-sm">+${s.income}€ / 10s</div>\n              </div>\n              <button class="cyber-btn text-xs attack-btn" data-id="${s.id}">ATTACK</button>\n            </div>\n          `;const a=i.querySelector(".attack-btn");a?.addEventListener("click",()=>{v.playClick(),this.showAttackDialog(s.id,t.name,n.strength)}),e.appendChild(i)}})})}showAttackDialog(e,t,s){const n=o.get(),i=n.members.filter(e=>"IDLE"===e.status&&!e.injured);if(0===i.length)return void this.showToast("NO AVAILABLE MEMBERS FOR ATTACK!","error");const a=n.territories.find(t=>t.id===e),c=this.createOverlay();c.addEventListener("click",e=>{e.target===c&&c.remove()});const d=document.createElement("div");d.className="bg-cp-bg border-[3px] border-cp-red shadow-[0_0_40px_rgba(255,0,60,0.5)] w-[90%] max-w-[600px] max-h-[85vh] flex flex-col animate-modalSlideIn pointer-events-auto",d.innerHTML=`\n      <div class="bg-cp-red/10 border-b-2 border-cp-red p-5 flex justify-between items-center shrink-0">\n        <h2 class="text-cp-red m-0 text-2xl drop-shadow-[0_0_10px_var(--cp-red)] font-cyber font-bold">ATTACK ${a.name}</h2>\n        <button id="close-attack-dialog" class="bg-transparent border-2 border-cp-red text-cp-red text-3xl w-10 h-10 cursor-pointer transition-all duration-300 hover:bg-cp-red hover:text-white hover:rotate-90 flex items-center justify-center font-bold">&times;</button>\n      </div>\n\n      <div class="p-5 flex-1 overflow-y-auto">\n        <p class="text-gray-400 mb-4">Target: ${t} (Strength: ${s})</p>\n\n        <div class="bg-cp-red/5 border border-cp-red/30 p-3 mb-4">\n          <div class="text-cp-red text-xs font-bold mb-1">SUCCESS CHANCE</div>\n          <div class="text-white text-2xl font-cyber" id="success-chance">0%</div>\n        </div>\n\n        <h3 class="text-cp-yellow mb-3">SELECT CREW</h3>\n        <div id="attack-crew-list" class="space-y-2 max-h-[300px] overflow-y-auto mb-4"></div>\n\n        <div class="flex gap-2">\n          <button id="confirm-attack" class="cyber-btn flex-1">ATTACK</button>\n          <button id="cancel-attack" class="cyber-btn flex-1">CANCEL</button>\n        </div>\n      </div>\n    `,c.appendChild(d),document.body.appendChild(c);const u=[],p=d.querySelector("#attack-crew-list"),m=d.querySelector("#success-chance");i.forEach(e=>{const t=document.createElement("label");t.className="flex items-center gap-3 p-2 bg-black/40 border border-cp-cyan/30 cursor-pointer hover:bg-cp-cyan/10",t.innerHTML=`\n        <input type="checkbox" value="${e.id}" class="w-5 h-5" data-power="${10+2*e.stats.cool+2*e.stats.reflex+5*e.level}">\n        <span class="flex-1 font-cyber">${e.name} (LVL ${e.level} - COOL:${e.stats.cool} REF:${e.stats.reflex})</span>\n      `;const i=t.querySelector("input");i.addEventListener("change",()=>{if(i.checked)u.push(e.id);else{const t=u.indexOf(e.id);t>-1&&u.splice(t,1)}(()=>{const e=n.members.filter(e=>u.includes(e.id)).reduce((e,t)=>e+10+2*t.stats.cool+2*t.stats.reflex+5*t.level,0);let t=0;if(e>0){const n=e/s;t=n>=1.5?100:n<=.5?0:Math.round((n-.5)/1*100)}m.textContent=`${t}%`,m.style.color=t>=80?"lime":t>=50?"var(--color-cp-yellow)":"var(--color-cp-red)"})()}),p.appendChild(t)}),d.querySelector("#close-attack-dialog")?.addEventListener("click",()=>c.remove()),d.querySelector("#cancel-attack")?.addEventListener("click",()=>c.remove()),d.querySelector("#confirm-attack")?.addEventListener("click",()=>{if(v.playClick(),0===u.length)return void this.showToast("SELECT AT LEAST ONE MEMBER!","error");const t=((e,t)=>{const s=o.get(),n=s.members.filter(e=>t.includes(e.id));if(n.filter(e=>"IDLE"!==e.status||e.injured).length>0)return{success:!1,message:"Some members are unavailable!"};const i=h.attackTerritory(e,n);return i.success&&i.loot&&(r(i.loot),l(10)),o.setKey("territories",[...s.territories]),o.setKey("members",[...s.members]),i})(e,u);t.success?(v.playMissionComplete(),this.showToast(t.message,"success"),"loot"in t&&t.loot&&setTimeout(()=>this.showToast(`LOOTED ${t.loot}€!`,"success"),500)):this.showToast(t.message,"error"),c.remove(),this.modalContainer.innerHTML="",this.openMissionBoard()})}}const S="bikergang-save-v1",A="bikergang-settings-v1";const I=new class{autoSaveTimer=null;constructor(){this.startAutoSave(),this.setupEventListeners()}saveGame(){try{const e=o.get(),t={version:1,timestamp:Date.now(),gameState:e};return localStorage.setItem(S,JSON.stringify(t)),!0}catch(e){return!1}}loadGame(){try{const e=localStorage.getItem(S);if(!e)return null;const t=JSON.parse(e);return 1!==t.version?null:t.gameState}catch(e){return null}}hasSaveData(){return null!==localStorage.getItem(S)}clearSaveData(){localStorage.removeItem(S)}getSaveTimestamp(){try{const e=localStorage.getItem(S);if(!e)return null;return JSON.parse(e).timestamp}catch{return null}}saveSettings(e){try{return localStorage.setItem(A,JSON.stringify(e)),!0}catch(t){return!1}}loadSettings(){try{const e=localStorage.getItem(A);if(!e)return null;return JSON.parse(e)}catch(e){return null}}getDefaultSettings(){return{musicVolume:15,sfxVolume:40,musicEnabled:!0,sfxEnabled:!0}}startAutoSave(){null===this.autoSaveTimer&&(this.autoSaveTimer=window.setInterval(()=>{this.saveGame()},3e4))}stopAutoSave(){null!==this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null)}setupEventListeners(){window.addEventListener("mission-complete",()=>{this.saveGame()}),window.addEventListener("territory-income",()=>{this.saveGame()}),window.addEventListener("beforeunload",()=>{this.saveGame()})}exportSaveData(){return localStorage.getItem(S)}importSaveData(e){try{const t=JSON.parse(e);if(!t.version||!t.gameState)throw new Error("Invalid save data format");return localStorage.setItem(S,e),!0}catch(t){return!1}}};document.addEventListener("DOMContentLoaded",()=>{const e=I.loadGame();e&&(e=>{Object.keys(e).forEach(t=>{o.setKey(t,e[t])})})(e);const t=I.loadSettings();if(t)v.setMusicVolume(t.musicVolume),v.setSfxVolume(t.sfxVolume),v.setMusicEnabled(t.musicEnabled),v.setSfxEnabled(t.sfxEnabled);else{const e=I.getDefaultSettings();I.saveSettings(e),v.setMusicVolume(e.musicVolume),v.setSfxVolume(e.sfxVolume)}f.getInstance().initialize(),new k});
